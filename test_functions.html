<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>功能测试</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .result { margin: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>功能测试页面</h1>
    
    <h2>1. 语言切换测试</h2>
    <button onclick="testSetLanguage('zh')">中文</button>
    <button onclick="testSetLanguage('en')">English</button>
    <div class="result" id="lang-result">当前语言: 未设置</div>
    
    <h2>2. Chat切换测试</h2>
    <button onclick="testToggleChat()">Toggle Chat</button>
    <div class="result" id="chat-result">Chat状态: 未测试</div>
    
    <h2>3. AI生成预览测试</h2>
    <button onclick="testApplyCustomization()">AI Generate</button>
    <div class="result" id="ai-result">AI状态: 未测试</div>
    
    <h2>控制台日志</h2>
    <div class="result" id="console-log" style="max-height: 300px; overflow-y: auto;"></div>
    
    <script>
        // 拦截console.log
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDiv.innerHTML += '<div style="color: blue;">LOG: ' + args.join(' ') + '</div>';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logDiv.innerHTML += '<div style="color: red;">ERROR: ' + args.join(' ') + '</div>';
            logDiv.scrollHeight;
        };
        
        // 测试函数
        function testSetLanguage(lang) {
            console.log('测试 setLanguage:', lang);
            try {
                if (typeof setLanguage === 'function') {
                    setLanguage(lang);
                    document.getElementById('lang-result').textContent = '当前语言: ' + lang + ' ✅';
                } else {
                    document.getElementById('lang-result').textContent = '错误: setLanguage 函数不存在 ❌';
                    console.error('setLanguage is not a function');
                }
            } catch (e) {
                document.getElementById('lang-result').textContent = '错误: ' + e.message;
                console.error('setLanguage error:', e);
            }
        }
        
        function testToggleChat() {
            console.log('测试 toggleEmbeddedChat');
            try {
                if (typeof toggleEmbeddedChat === 'function') {
                    toggleEmbeddedChat(true);
                    document.getElementById('chat-result').textContent = 'Chat切换成功 ✅';
                } else {
                    document.getElementById('chat-result').textContent = '错误: toggleEmbeddedChat 函数不存在 ❌';
                    console.error('toggleEmbeddedChat is not a function');
                }
            } catch (e) {
                document.getElementById('chat-result').textContent = '错误: ' + e.message;
                console.error('toggleEmbeddedChat error:', e);
            }
        }
        
        function testApplyCustomization() {
            console.log('测试 applyCustomization');
            try {
                if (typeof applyCustomization === 'function') {
                    applyCustomization();
                    document.getElementById('ai-result').textContent = 'AI生成预览启动成功 ✅';
                } else {
                    document.getElementById('ai-result').textContent = '错误: applyCustomization 函数不存在 ❌';
                    console.error('applyCustomization is not a function');
                }
            } catch (e) {
                document.getElementById('ai-result').textContent = '错误: ' + e.message;
                console.error('applyCustomization error:', e);
            }
        }
        
        // 在iframe中加载主页面
        console.log('测试页面加载完成');
        console.log('尝试从主页面检测函数...');
        
        // 5秒后检查主页面是否已加载
        setTimeout(() => {
            console.log('--- 5秒后检查 ---');
            console.log('setLanguage存在?', typeof setLanguage !== 'undefined');
            console.log('toggleEmbeddedChat存在?', typeof toggleEmbeddedChat !== 'undefined');
            console.log('applyCustomization存在?', typeof applyCustomization !== 'undefined');
        }, 5000);
    </script>
    
    <hr>
    <h2>主页面iframe</h2>
    <iframe src="AIGreenExhibtion.html" style="width: 100%; height: 600px; border: 1px solid #ccc;"></iframe>
</body>
</html>
