<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰ΩçËá™Âä©Âπ≥Âè∞ - MVPÂéüÂûã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(90deg, #2c3e50 0%, #34495e 100%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.3rem;
            color: #fff !important;
        }

        .nav-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #27ae60;
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 24px;
            margin-right: 8px;
            font-weight: bold;
            font-size: 12px;
        }

        .lang-toggle {
            display: flex;
            gap: 8px;
            margin-left: 20px;
        }

        .lang-btn {
            padding: 6px 12px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: white;
            color: #2c3e50;
        }

        .lang-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .en { display: none; }
        .en.show { display: inline; }
        .zh { display: inline; }
        .zh.hide { display: none; }

        .process-container {
            max-width: 1200px;
            margin: 40px auto;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #ddd;
            z-index: 0;
        }

        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .step-number {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: white;
            border: 3px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .step-number.active {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.3);
        }

        .step-number.completed {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .step-label {
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            color: #666;
        }

        .step-label.active {
            color: #27ae60;
            font-weight: 700;
        }

        .content-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            border-left: 4px solid #27ae60;
            padding-left: 15px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            background: #fafafa;
            border-radius: 8px;
        }

        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .template-card:hover {
            border-color: #27ae60;
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.25);
            transform: scale(1.05);
            z-index: 10;
        }

        .template-card.selected {
            border-color: #27ae60;
            background: #e8f8f5;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .template-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 6px;
            background: #f5f5f5;
            transition: all 0.3s;
        }

        .template-card:hover .template-image {
            transform: scale(1.1);
        }

        .template-title {
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 4px;
            color: #2c3e50;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .template-spec {
            font-size: 10px;
            color: #7f8c8d;
            line-height: 1.4;
        }
        
        .template-spec > div {
            margin: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Áº©Áï•ÂõæÊîæÂ§ßÈ¢ÑËßàÊïàÊûú */
        .template-card::after {
            content: 'üîç';
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255,255,255,0.9);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .template-card:hover::after {
            opacity: 1;
        }
        
        /* Â±ï‰ΩçÁªüËÆ°‰ø°ÊÅØ */
        .booth-stats {
            display: flex;
            gap: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            margin-bottom: 15px;
            color: white;
            font-size: 13px;
            align-items: center;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .booth-stat-item {
            text-align: center;
            min-width: 80px;
        }
        
        .booth-stat-number {
            font-size: 20px;
            font-weight: 700;
            display: block;
        }
        
        .booth-stat-label {
            font-size: 11px;
            opacity: 0.9;
        }

        .sample-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .sample-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #fff;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sample-card:hover { border-color: #27ae60; box-shadow: 0 4px 12px rgba(39,174,96,0.2); }
        .sample-card.selected { border-color: #27ae60; }

        .sample-thumb {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background: #eee;
        }

        .sample-meta { padding: 10px 12px; font-size: 12px; color: #7f8c8d; }
        .sample-title { font-weight: 600; color: #2c3e50; font-size: 14px; }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-control {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 14px;
        }

        .form-control:focus {
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .compliance-alert {
            margin: 16px 0;
            padding: 16px;
            border-radius: 8px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .compliance-alert.success {
            background: #e8f8f5;
            border-left: 4px solid #27ae60;
            color: #27ae60;
        }

        .compliance-alert.warning {
            background: #fff3cd;
            border-left: 4px solid #ff9800;
            color: #856404;
        }

        .compliance-alert.error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .compliance-alert .icon {
            font-size: 20px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .compliance-report {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-size: 13px;
            line-height: 1.8;
        }

        .quote-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .quote-table th {
            background: #ecf0f1;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #ddd;
            font-size: 13px;
        }

        .quote-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        .quote-table tr:hover {
            background: #f9f9f9;
        }

        .quote-summary {
            background: #e8f8f5;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }

        .summary-row.total {
            border-top: 2px solid #27ae60;
            padding-top: 12px;
            margin-top: 12px;
            font-weight: 700;
            font-size: 16px;
            color: #27ae60;
        }

        .summary-label {
            color: #7f8c8d;
        }

        .summary-value {
            font-weight: 600;
            color: #2c3e50;
        }

        .order-summary {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .order-summary h5 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .order-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            font-size: 13px;
        }

        .order-info-item {
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .order-info-label {
            color: #7f8c8d;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .order-info-value {
            color: #2c3e50;
            font-weight: 600;
        }

        .btn-custom {
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary-custom {
            background: #27ae60;
            color: white;
        }

        .btn-primary-custom:hover {
            background: #229954;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
            transform: translateY(-2px);
        }

        .btn-secondary-custom {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .btn-secondary-custom:hover {
            background: #d5dbdd;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .success-message {
            background: #e8f8f5;
            border-left: 4px solid #27ae60;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: #27ae60;
            margin: 20px 0;
        }

        .success-message h4 {
            margin-bottom: 10px;
            color: #229954;
        }

        .success-message .order-id {
            font-family: monospace;
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 700;
            color: #27ae60;
        }

        .material-list {
            margin: 20px 0;
        }

        .material-item {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            border-left: 3px solid #27ae60;
        }

        .material-info {
            flex: 1;
        }

        .material-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .material-spec {
            color: #7f8c8d;
            font-size: 12px;
        }

        .material-qty {
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #27ae60;
        }

        .toggle-section {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
            margin-bottom: 12px;
            user-select: none;
            transition: all 0.3s;
        }

        .toggle-section:hover {
            background: #eee;
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .toggle-icon.open {
            transform: rotate(180deg);
        }

        .hidden {
            display: none;
        }

        /* ‰∏™ÊÄßÂåñ‰∏éAIÈ¢ÑËßà */
        .custom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .custom-card {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 12px;
        }

        .custom-title {
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .preview-canvas {
            width: 100%;
            height: 180px;
            border: 1px solid #eee;
            border-radius: 6px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .preview-canvas:hover {
            border-color: #7c3aed;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
            transform: scale(1.02);
        }
        
        .preview-canvas.active {
            border: 3px solid #7c3aed;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }
        
        .template-card.preview-card {
            position: relative;
        }
        
        .template-card.preview-card.active::before {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            background: #7c3aed;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
        }

        .artifact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .artifact-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border: 1px solid #eee;
            border-radius: 6px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e0e0e0;
            border-top: 2px solid #27ae60;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar-custom {
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .feature-badge {
            display: inline-block;
            background: #e8f8f5;
            color: #27ae60;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .process-container {
                margin: 20px;
            }

            .content-card {
                padding: 20px;
            }

            .template-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .order-info {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .step-label {
                font-size: 11px;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.3s ease;
        }

        /* ÂõæÁâáÈ¢ÑËßàÊµÆÁ™óÊ†∑Âºè */
        .image-preview-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s ease;
        }

        .image-preview-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-preview-content {
            background: white;
            border-radius: 16px;
            padding: 0;
            max-width: 85vw;
            max-height: 90vh;
            width: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: zoomIn 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .image-preview-content img {
            max-width: 100%;
            max-height: calc(90vh - 50px);
            width: auto;
            height: auto;
            display: block;
            border-radius: 12px 12px 0 0;
        }

        .image-preview-caption {
            padding: 16px;
            text-align: center;
            font-size: 14px;
            color: #2c3e50;
            font-weight: 600;
            background: white;
            border-top: 1px solid #ecf0f1;
        }

        .image-preview-close {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 10;
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            font-size: 28px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }

        .image-preview-close:hover {
            background: white;
            color: #e74c3c;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* 3DËßÜÂõæÊåâÈíÆÊ†∑Âºè */
        .view-3d-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            padding: 12px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-3d-button:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .view-3d-button:active {
            transform: translateX(-50%) translateY(0);
        }

        /* 3DÂÆπÂô®Ê†∑Âºè */
        .preview-3d-container {
            display: none;
            width: 100%;
            height: 100%;
            perspective: 1500px;
            position: absolute;
            top: 0;
            left: 0;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .preview-3d-container.active {
            display: flex;
        }

        .preview-3d-card {
            width: 80%;
            max-width: 800px;
            height: 70%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .preview-3d-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .preview-3d-face img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Ê≠£Èù¢ */
        .preview-3d-face.front {
            transform: translateZ(0px);
        }

        /* Â∑¶‰æß */
        .preview-3d-face.left {
            transform: rotateY(-120deg) translateZ(400px);
        }

        /* Âè≥‰æß */
        .preview-3d-face.right {
            transform: rotateY(120deg) translateZ(400px);
        }

        /* 3DÊéßÂà∂ÊåâÈíÆ */
        .preview-3d-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .preview-3d-control-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .preview-3d-control-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .preview-3d-control-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .preview-3d-exit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 24px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            color: #e74c3c;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .preview-3d-exit-btn:hover {
            background: white;
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #95a5a6;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #27ae60;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .modal-section-title i {
            margin-right: 8px;
        }

        .optional-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .optional-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: #f9f9f9;
        }

        .optional-card:hover {
            border-color: #27ae60;
            background: #e8f8f5;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.15);
        }

        .optional-card.selected {
            border-color: #27ae60;
            background: #d5efda;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }

        .optional-card-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .optional-card-name {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .optional-card-price {
            font-size: 12px;
            color: #27ae60;
            font-weight: 700;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid #ecf0f1;
        }

        .modal-footer button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-footer .btn-primary {
            background: #27ae60;
            color: white;
        }

        .modal-footer .btn-primary:hover {
            background: #229954;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }

        .modal-footer .btn-cancel {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .modal-footer .btn-cancel:hover {
            background: #d5d8dc;
        }

        /* AI Assistant Styles */
        .ai-assistant {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-left: 4px solid #7c3aed;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .ai-assistant.show {
            display: block;
        }

        .ai-assistant-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 700;
            color: #7c3aed;
            font-size: 14px;
        }

        .ai-assistant-header i {
            margin-right: 8px;
            font-size: 18px;
        }

        /* ÈöêËóèÊóßÁöÑAIÂä©ÁêÜÂØπËØùÂäüËÉΩÔºåÁªü‰∏Ä‰ΩøÁî®Âè≥‰æßÊÇ¨ÊµÆÈù¢Êùø */
        .ai-assistant-header .ai-action-btn,
        .ai-chat-container,
        .ai-input-container,
        .ai-quick-actions {
            display: none !important;
        }

        .ai-chat-container {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }

        .ai-message {
            margin-bottom: 12px;
            animation: fadeInUp 0.3s ease;
        }

        .ai-message.user {
            text-align: right;
        }

        .ai-message-content {
            display: inline-block;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 13px;
            line-height: 1.5;
            max-width: 80%;
        }

        .ai-message.assistant .ai-message-content {
            background: #f0f0f0;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .ai-message.user .ai-message-content {
            background: #7c3aed;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message-avatar {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #7c3aed;
            color: white;
            text-align: center;
            line-height: 24px;
            font-size: 12px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .ai-message.user .ai-message-avatar {
            background: #27ae60;
            margin-right: 0;
            margin-left: 8px;
        }

        .ai-input-container {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .ai-input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            font-size: 13px;
            outline: none;
            transition: all 0.3s;
        }

        .ai-input:focus {
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .ai-send-btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .ai-send-btn:hover {
            background: #6d28d9;
            transform: scale(1.05);
        }

        .ai-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .ai-quick-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .ai-quick-btn {
            background: white;
            border: 1px solid #7c3aed;
            color: #7c3aed;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ai-quick-btn:hover {
            background: #7c3aed;
            color: white;
        }

        .ai-assistant-content {
            font-size: 13px;
            color: #555;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .ai-checklist {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .ai-checklist li {
            padding: 6px 0;
            padding-left: 24px;
            position: relative;
            font-size: 13px;
            color: #666;
        }

        .ai-checklist li::before {
            content: '‚ñ¢';
            position: absolute;
            left: 0;
            color: #999;
            font-weight: bold;
        }

        .ai-checklist li.completed::before {
            content: '‚úì';
            color: #27ae60;
            font-weight: bold;
        }

        .ai-checklist li.completed {
            color: #27ae60;
        }

        .ai-action-btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
        }

        .ai-action-btn:hover {
            background: #6d28d9;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }

        .ai-preview-section {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }

        .ai-preview-image {
            width: 100%;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            margin-top: 8px;
        }

        .ai-typing-indicator {
            display: inline-flex;
            align-items: center;
            padding: 10px 14px;
            background: #f0f0f0;
            border-radius: 12px;
            border-bottom-left-radius: 4px;
        }

        .ai-typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .ai-typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Âè≥‰æßÊÇ¨ÊµÆËÅäÂ§©Èù¢Êùø - Êîπ‰∏∫ÂµåÂÖ•Âºè */
        .chat-toggle-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 16px;
        }

        .chat-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }

        .chat-toggle-btn i {
            font-size: 16px;
        }

        /* ÈöêËóèÂéüÊù•ÁöÑÊÇ¨ÊµÆÊåâÈíÆ */
        .floating-chat-toggle {
            display: none !important;
        }

        .embedded-chat-panel {
            max-width: 1200px;
            margin: 0 auto 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: visible;
            display: none;
            animation: slideIn 0.4s ease;
            position: relative;
            z-index: 5;
            transition: all 0.3s ease;
        }

        .embedded-chat-panel.active {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 0;
            min-height: 600px;
            max-height: 70vh;
        }
        
        /* ÂΩìËÅäÂ§©Èù¢ÊùøÂ§Ñ‰∫éÂè≥ÂØπÈΩêÊ®°ÂºèÊó∂ */
        .embedded-chat-panel.right-aligned {
            position: fixed;
            right: 0;
            top: 84px;
            max-width: 40%;
            width: 500px;
            height: calc(100vh - 84px);
            max-height: calc(100vh - 84px);
            margin: 0;
            border-radius: 0;
            z-index: 1000;
            grid-template-columns: 1fr;
        }
        
        .embedded-chat-panel.right-aligned .chat-main-content {
            display: none;
        }
        
        /* ÂΩìËÅäÂ§©Èù¢ÊùøÂè≥ÂØπÈΩêÊó∂Ôºå‰∏ªÂÜÖÂÆπÂå∫ÂüüÈúÄË¶ÅÁªôËÅäÂ§©Èù¢ÊùøÁïôÂá∫Á©∫Èó¥ */
        .process-container.chat-right-mode {
            margin-right: 500px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Â∑¶‰æß‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .chat-main-content {
            padding: 30px;
            background: #f8f9fa;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }

        .chat-info-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .chat-info-card h4 {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-info-card p {
            font-size: 14px;
            line-height: 1.8;
            color: #555;
            margin-bottom: 12px;
        }

        .chat-info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .chat-info-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            color: #555;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-info-list li:last-child {
            border-bottom: none;
        }

        .chat-info-list li i {
            color: #7c3aed;
            font-size: 16px;
        }

        /* Âè≥‰æßËÅäÂ§©Èù¢Êùø */
        .floating-chat-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 600px;
            border-left: 1px solid #e5e7eb;
            position: relative;
            z-index: 10;
            background: white;
            /* Keep chat visible and above any left content stacking contexts */
            align-self: start;
            position: sticky;
            top: 84px;
        }

        .floating-chat-header {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .floating-chat-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .floating-chat-header .step-info {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .floating-chat-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 20px;
        }

        .floating-chat-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .floating-chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            position: relative;
            z-index: 10;
        }

        .floating-chat-messages {
            display: flex;
            flex-direction: column;
            gap: 16px;
            position: relative;
            z-index: 10;
        }

        .floating-chat-message {
            display: flex;
            gap: 12px;
            animation: fadeInUp 0.3s ease;
        }

        .floating-chat-message.user {
            flex-direction: row-reverse;
        }

        .floating-message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .floating-chat-message.assistant .floating-message-avatar {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
        }

        .floating-chat-message.user .floating-message-avatar {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }

        .floating-message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
            word-wrap: break-word;
        }

        .floating-chat-message.assistant .floating-message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .floating-chat-message.user .floating-message-content {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            border-bottom-right-radius: 4px;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }

        .floating-chat-footer {
            padding: 20px;
            background: white;
            border-top: 1px solid #e5e7eb;
            position: relative;
            z-index: 20;
        }

        .floating-chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
            position: relative;
            z-index: 20;
        }

        .floating-chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
            position: relative;
            z-index: 20;
        }

        .floating-chat-input:focus {
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .floating-chat-send {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 18px;
        }

        .floating-chat-send:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
        }

        .floating-chat-send:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .floating-quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
            position: relative;
            z-index: 20;
        }

        .floating-quick-btn {
            background: white;
            border: 1px solid #7c3aed;
            color: #7c3aed;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
            z-index: 20;
        }

        .floating-quick-btn:hover {
            background: #7c3aed;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .floating-typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .floating-typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #7c3aed;
            animation: typing 1.4s infinite;
        }

        .floating-typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .floating-typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* ÂìçÂ∫îÂºèÈÄÇÈÖç */
        @media (max-width: 968px) {
            .embedded-chat-panel.active {
                grid-template-columns: 1fr;
                grid-template-rows: auto 500px;
            }

            .chat-main-content {
                max-height: 400px;
            }

            .floating-chat-panel {
                border-left: none;
                border-top: 1px solid #e5e7eb;
            }
        }

        @media (max-width: 768px) {
            .floating-chat-toggle {
                right: 20px;
                bottom: 20px;
                width: 56px;
                height: 56px;
                font-size: 22px;
            }

            .chat-toggle-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .embedded-chat-panel.active {
                min-height: auto;
            }
        }

        /* ÁôªÂΩïÈ°µÈù¢Ê†∑Âºè */
        .login-container {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            margin: auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            max-width: 900px;
            width: 90%;
            display: flex;
        }

        .login-left {
            flex: 1;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 60px 40px;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-left h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .login-left .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 40px;
        }

        .login-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .login-features li {
            padding: 12px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .login-features li i {
            color: #27ae60;
            margin-right: 12px;
            font-size: 18px;
        }

        .login-right {
            flex: 1;
            padding: 60px 40px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .login-form {
            max-width: 360px;
            margin: 0 auto;
        }

        .form-group-login {
            margin-bottom: 24px;
        }

        .form-group-login label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .form-group-login input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            outline: none;
        }

        .form-group-login input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            background: #fee;
            color: #c33;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid #c33;
        }

        .login-error.show {
            display: block;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .login-footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            color: #95a5a6;
        }

        .demo-info {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 13px;
            color: #555;
        }

        .demo-info strong {
            color: #667eea;
        }

        /* ËßíËâ≤ÈÄâÊã©Ê†∑Âºè */
        .role-selection {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .role-option {
            flex: 1;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: white;
        }

        .role-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .role-option input[type="radio"] {
            display: none;
        }

        .role-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .role-icon {
            font-size: 32px;
            margin-bottom: 8px;
            color: #667eea;
        }

        .role-option.selected .role-icon {
            animation: bounceIn 0.5s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .role-label {
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .role-desc {
            font-size: 11px;
            color: #7f8c8d;
        }

        .main-app {
            display: none;
        }

        .main-app.show {
            display: block;
        }

        /* Áî®Êà∑‰ø°ÊÅØÊòæÁ§∫ */
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 20px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-name {
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        .role-badge {
            background: rgba(255, 255, 255, 0.25);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            color: white;
            font-weight: 600;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .role-badge.contractor {
            background: rgba(52, 152, 219, 0.3);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .login-box {
                flex-direction: column;
            }
            
            .login-left {
                padding: 40px 30px;
            }
            
            .login-right {
                padding: 40px 30px;
            }
        }
    </style>
</head>
<body>
    <!-- ÁôªÂΩïÈ°µÈù¢ -->
    <div class="login-container" id="login-page">
        <div class="login-box">
            <div class="login-left">
                <h1>
                    <span class="zh">Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰Ωç<br>Ëá™Âä©Âπ≥Âè∞</span>
                    <span class="en">Canton Fair<br>Green Booth Platform</span>
                </h1>
                <p class="subtitle">
                    <span class="zh">Êô∫ËÉΩÂåñÂ±ï‰ΩçÊê≠Âª∫Ëß£ÂÜ≥ÊñπÊ°à</span>
                    <span class="en">Intelligent Booth Solution</span>
                </p>
                <ul class="login-features">
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span class="zh">AI Êô∫ËÉΩÊé®ËçêÂ±ï‰ΩçÊ®°Êùø</span>
                        <span class="en">AI-powered booth recommendations</span>
                    </li>
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span class="zh">Ëá™Âä®ÂåñÂêàËßÑÊ†°È™å</span>
                        <span class="en">Automated compliance check</span>
                    </li>
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span class="zh">ÂÆûÊó∂Êä•‰ª∑‰∏é BOM</span>
                        <span class="en">Real-time quote & BOM</span>
                    </li>
                    <li>
                        <i class="bi bi-check-circle-fill"></i>
                        <span class="zh">ÁªøËâ≤ÁéØ‰øùÂèØÂ§çÁî®ËÆæËÆ°</span>
                        <span class="en">Eco-friendly reusable design</span>
                    </li>
                </ul>
            </div>
            <div class="login-right">
                <div class="login-header">
                    <h2>
                        <span class="zh">ÂèÇÂ±ïÂïÜÁôªÂΩï</span>
                        <span class="en">Exhibitor Login</span>
                    </h2>
                    <p>
                        <span class="zh">ÁôªÂΩïÂêéÂºÄÂßãÊÇ®ÁöÑÊô∫ËÉΩÂ±ï‰ΩçÂÆöÂà∂‰πãÊóÖ</span>
                        <span class="en">Start your smart booth customization journey</span>
                    </p>
                </div>

                <div class="login-form">
                    <div class="login-error" id="login-error">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <span class="zh">Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ</span>
                        <span class="en">Invalid username or password</span>
                    </div>

                    <form onsubmit="handleLogin(event)">
                        <!-- ËßíËâ≤ÈÄâÊã© -->
                        <div class="form-group-login">
                            <label style="margin-bottom: 12px;">
                                <i class="bi bi-person-badge"></i>
                                <span class="zh">ÈÄâÊã©ËßíËâ≤</span>
                                <span class="en">Select Role</span>
                            </label>
                            <div class="role-selection">
                                <label class="role-option selected" id="role-exhibitor">
                                    <input type="radio" name="role" value="exhibitor" checked onchange="selectRole('exhibitor')">
                                    <div class="role-icon">üè¢</div>
                                    <div class="role-label">
                                        <span class="zh">ÂèÇÂ±ïÂïÜ</span>
                                        <span class="en">Exhibitor</span>
                                    </div>
                                    <div class="role-desc">
                                        <span class="zh">Â±ï‰ΩçÈúÄÊ±ÇÊñπ</span>
                                        <span class="en">Booth demander</span>
                                    </div>
                                </label>
                                <label class="role-option" id="role-contractor">
                                    <input type="radio" name="role" value="contractor" onchange="selectRole('contractor')">
                                    <div class="role-icon">üèóÔ∏è</div>
                                    <div class="role-label">
                                        <span class="zh">Â∏ÉÂ±ïÂÖ¨Âè∏</span>
                                        <span class="en">Contractor</span>
                                    </div>
                                    <div class="role-desc">
                                        <span class="zh">Â±ï‰ΩçÊê≠Âª∫Êñπ</span>
                                        <span class="en">Booth builder</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="form-group-login">
                            <label>
                                <i class="bi bi-person"></i>
                                <span class="zh">Áî®Êà∑Âêç</span>
                                <span class="en">Username</span>
                            </label>
                            <input 
                                type="text" 
                                id="username" 
                                placeholder="Demo"
                                value="Demo"
                                required
                            />
                        </div>

                        <div class="form-group-login">
                            <label>
                                <i class="bi bi-lock"></i>
                                <span class="zh">ÂØÜÁ†Å</span>
                                <span class="en">Password</span>
                            </label>
                            <input 
                                type="password" 
                                id="password" 
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                value="Demo_123"
                                required
                            />
                        </div>

                        <button type="submit" class="login-btn">
                            <i class="bi bi-box-arrow-in-right"></i>
                            <span class="zh">ÁôªÂΩï</span>
                            <span class="en">Login</span>
                        </button>
                    </form>

                    <div class="demo-info">
                        <i class="bi bi-info-circle"></i>
                        <span class="zh"><strong>ÊºîÁ§∫Ë¥¶Âè∑Ôºö</strong>Áî®Êà∑Âêç: Demo / ÂØÜÁ†Å: Demo_123</span>
                        <span class="en"><strong>Demo Account:</strong> Username: Demo / Password: Demo_123</span>
                    </div>

                    <div class="login-footer">
                        <span class="zh">¬© 2026 Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰ΩçÂπ≥Âè∞ - MVP ÂéüÂûã</span>
                        <span class="en">¬© 2026 Canton Fair Green Booth Platform - MVP Prototype</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏ªÂ∫îÁî®ÔºàÁôªÂΩïÂêéÊòæÁ§∫Ôºâ -->
    <div class="main-app" id="main-app">
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand">
                <span class="nav-icon">‚ôª</span> <span class="zh">Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰ΩçËá™Âä©Âπ≥Âè∞</span><span class="en show">Canton Fair Green Booth Platform</span>
            </span>
            <div class="ms-auto" style="display: flex; align-items: center;">
                <div class="lang-toggle">
                    <button class="lang-btn active" id="lang-zh" onclick="setLanguage('zh')">‰∏≠Êñá</button>
                    <button class="lang-btn" id="lang-en" onclick="setLanguage('en')">English</button>
                </div>
                
                <!-- Chat AI ÊåâÈíÆ -->
                <button class="chat-toggle-btn" onclick="toggleEmbeddedChat(true)">
                    <i class="bi bi-chat-dots-fill"></i>
                    <span class="zh">Chat AI</span>
                    <span class="en">Chat AI</span>
                </button>
                
                <span style="color: white; font-size: 13px; margin-left: 20px;"><span class="zh">ÂèÇÂ±ïÂïÜÁ´Ø</span><span class="en show">Exhibitor Portal</span></span>
                
                <!-- Áî®Êà∑‰ø°ÊÅØ -->
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">D</div>
                    <div style="display: flex; flex-direction: column; align-items: flex-start;">
                        <span class="user-name" id="user-name">Demo</span>
                        <span class="role-badge" id="role-badge">
                            <span>üè¢</span>
                            <span class="zh">ÂèÇÂ±ïÂïÜ</span>
                            <span class="en">Exhibitor</span>
                        </span>
                    </div>
                    <button class="logout-btn" onclick="handleLogout()">
                        <i class="bi bi-box-arrow-right"></i>
                        <span class="zh">ÈÄÄÂá∫</span>
                        <span class="en">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªÂÆπÂô® -->
    <div class="process-container">
        <!-- ÂµåÂÖ•ÂºèËÅäÂ§©Èù¢Êùø -->
        <div class="embedded-chat-panel" id="embedded-chat-panel">
            <!-- Â∑¶‰æß‰∏ªÂÜÖÂÆπÂå∫Âüü -->
            <div class="chat-main-content">
                <div class="chat-info-card">
                    <h4>
                        <i class="bi bi-lightbulb-fill" style="color: #f39c12;"></i>
                        <span class="zh">AI Âä©ÁêÜËÉΩ‰∏∫ÊÇ®ÂÅö‰ªÄ‰πàÔºü</span>
                        <span class="en">What can AI Assistant do for you?</span>
                    </h4>
                    <p>
                        <span class="zh">ÊàëÊòØÊÇ®ÁöÑÊô∫ËÉΩÂ±ï‰ΩçÈ°æÈóÆÔºåÂèØ‰ª•Â∏ÆÂä©ÊÇ®ÂÆåÊàêÊï¥‰∏™Â±ï‰ΩçÂÆöÂà∂ÊµÅÁ®ã„ÄÇÊó†ËÆ∫ÊòØÈÄâÊã©Ê®°Êùø„ÄÅ‰∫ÜËß£ÂêàËßÑË¶ÅÊ±ÇÔºåËøòÊòØÂàÜÊûêÊä•‰ª∑ÔºåÊàëÈÉΩËÉΩ‰∏∫ÊÇ®Êèê‰æõ‰∏ì‰∏öÂª∫ËÆÆ„ÄÇ</span>
                        <span class="en">I'm your intelligent booth consultant, helping you through the entire booth customization process. Whether choosing templates, understanding compliance, or analyzing quotes, I provide professional advice.</span>
                    </p>
                </div>

                <div class="chat-info-card">
                    <h4>
                        <i class="bi bi-stars" style="color: #7c3aed;"></i>
                        <span class="zh">Ê†∏ÂøÉÂäüËÉΩ</span>
                        <span class="en">Core Features</span>
                    </h4>
                    <ul class="chat-info-list">
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span class="zh">Êô∫ËÉΩÊé®ËçêÂ±ï‰ΩçÊ®°ÊùøÔºåÊ†πÊçÆÊÇ®ÁöÑÈúÄÊ±ÇÂåπÈÖçÊúÄ‰Ω≥ÊñπÊ°à</span>
                            <span class="en">Smart booth template recommendations based on your needs</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span class="zh">ÂÆûÊó∂Ëß£Á≠îÂêàËßÑÈóÆÈ¢òÔºåÁ°Æ‰øùÂ±ï‰ΩçÁ¨¶ÂêàÂπø‰∫§‰ºöÊ†áÂáÜ</span>
                            <span class="en">Real-time compliance Q&A, ensuring Canton Fair standards</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span class="zh">ËØ¶ÁªÜÊä•‰ª∑ÂàÜÊûêÔºåÂ∏ÆÂä©ÊÇ®‰∫ÜËß£ÊØè‰∏ÄÈ°πË¥πÁî®</span>
                            <span class="en">Detailed quote analysis for every cost item</span>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill"></i>
                            <span class="zh">ÁéØ‰øùÊñπÊ°àÂí®ËØ¢ÔºåÊèê‰æõÂèØÊåÅÁª≠ÂèëÂ±ïÂª∫ËÆÆ</span>
                            <span class="en">Eco-friendly solutions and sustainability advice</span>
                        </li>
                    </ul>
                </div>

                <div class="chat-info-card">
                    <h4>
                        <i class="bi bi-question-circle-fill" style="color: #27ae60;"></i>
                        <span class="zh">Â∏∏ËßÅÈóÆÈ¢òÁ§∫‰æã</span>
                        <span class="en">Common Questions</span>
                    </h4>
                    <ul class="chat-info-list">
                        <li>
                            <i class="bi bi-chat-quote"></i>
                            <span class="zh">"Â¶Ç‰ΩïÈÄâÊã©ÈÄÇÂêàÊàëÁöÑÂ±ï‰ΩçÂ∞∫ÂØ∏Ôºü"</span>
                            <span class="en">"How to choose the right booth size?"</span>
                        </li>
                        <li>
                            <i class="bi bi-chat-quote"></i>
                            <span class="zh">"‰ªÄ‰πàÊòØÂèØÂ§çÁî®ÁéáÔºüÂØπÊàëÊúâ‰ªÄ‰πàÂ•ΩÂ§ÑÔºü"</span>
                            <span class="en">"What is reusability rate and its benefits?"</span>
                        </li>
                        <li>
                            <i class="bi bi-chat-quote"></i>
                            <span class="zh">"‰∏çÂêåÊ®°ÊùøÁöÑ‰ª∑Ê†ºÂ∑ÆÂºÇÂú®Âì™ÈáåÔºü"</span>
                            <span class="en">"What are the price differences between templates?"</span>
                        </li>
                        <li>
                            <i class="bi bi-chat-quote"></i>
                            <span class="zh">"Â±ï‰ΩçÊê≠Âª∫ÈúÄË¶ÅÂ§öÈïøÊó∂Èó¥Ôºü"</span>
                            <span class="en">"How long does booth construction take?"</span>
                        </li>
                    </ul>
                </div>

                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white; text-align: center;">
                    <i class="bi bi-arrow-right-circle" style="font-size: 32px; margin-bottom: 10px;"></i>
                    <p style="margin: 0; font-size: 14px; opacity: 0.95;">
                        <span class="zh">üëâ Âú®Âè≥‰æßËÅäÂ§©Á™óÂè£ÂºÄÂßãÂØπËØùÔºåÈöèÊó∂ÂêëÊàëÊèêÈóÆ</span>
                        <span class="en">üëâ Start chatting in the right panel, ask me anytime</span>
                    </p>
                </div>
            </div>

            <!-- Âè≥‰æßËÅäÂ§©Èù¢Êùø -->
            <div class="floating-chat-panel">
                <div class="floating-chat-header">
                    <div>
                        <h3><i class="bi bi-robot"></i> <span class="zh">AI ÂØπËØù</span><span class="en">AI Chat</span></h3>
                        <div class="step-info" id="chat-step-info">
                            <span class="zh">Á¨¨1Ê≠•ÔºöÈÄâÊã©Â±ï‰ΩçÊ®°Êùø</span><span class="en">Step 1: Select Booth Template</span>
                        </div>
                    </div>
                    <button class="floating-chat-close" onclick="toggleEmbeddedChat()">
                        <i class="bi bi-x"></i>
                    </button>
                </div>

                <div class="floating-chat-body" id="floating-chat-body">
                    <div class="floating-chat-messages" id="floating-chat-messages">
                        <!-- Ê¨¢ËøéÊ∂àÊÅØ -->
                        <div class="floating-chat-message assistant">
                            <div class="floating-message-avatar">
                                <i class="bi bi-robot"></i>
                            </div>
                            <div class="floating-message-content">
                                <span class="zh">üëã Ê¨¢Ëøé‰ΩøÁî®Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰ΩçËá™Âä©Âπ≥Âè∞ÔºÅÊàëÊòØÊÇ®ÁöÑAIÂä©ÁêÜ„ÄÇ<br><br>ÊàëÂèØ‰ª•Â∏ÆÊÇ®Ôºö<br>‚Ä¢ ‰∫ÜËß£‰∏çÂêåÊ®°ÊùøÁöÑÁâπÁÇπ<br>‚Ä¢ ÊØîËæÉ‰ª∑Ê†ºÂíåÊÄß‰ª∑ÊØî<br>‚Ä¢ ÈÄâÊã©ÂêàÈÄÇÁöÑÂ∞∫ÂØ∏<br>‚Ä¢ Ëß£ÈáäÂèØÂ§çÁî®ÁéáÁöÑÊÑè‰πâ<br><br>ËØ∑ÈöèÊó∂ÂêëÊàëÊèêÈóÆÔºÅ</span>
                                <span class="en">üëã Welcome to Canton Fair Green Booth Platform! I'm your AI assistant.<br><br>I can help with:<br>‚Ä¢ Understanding template features<br>‚Ä¢ Comparing prices and value<br>‚Ä¢ Selecting the right size<br>‚Ä¢ Explaining reusability<br><br>Feel free to ask!</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ËæìÂÖ•ÊèêÁ§∫ -->
                    <div id="floating-typing" style="display: none;">
                        <div class="floating-chat-message assistant">
                            <div class="floating-message-avatar">
                                <i class="bi bi-robot"></i>
                            </div>
                            <div class="floating-message-content">
                                <div class="floating-typing-indicator">
                                    <span></span><span></span><span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="floating-chat-footer">
                    <!-- Âø´Êç∑Êìç‰ΩúÊåâÈíÆ -->
                    <div class="floating-quick-actions" id="floating-quick-actions">
                        <button class="floating-quick-btn" onclick="sendFloatingQuickMessage('‰ªãÁªç‰∏Ä‰∏ãÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç')">
                            <span class="zh">‰ªãÁªçÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç</span><span class="en">About Green Booth</span>
                        </button>
                        <button class="floating-quick-btn" onclick="sendFloatingQuickMessage('Â¶Ç‰ΩïÈÄâÊã©ÂêàÈÄÇÁöÑÂ∞∫ÂØ∏Ôºü')">
                            <span class="zh">Â¶Ç‰ΩïÈÄâÂ∞∫ÂØ∏Ôºü</span><span class="en">Size Guide</span>
                        </button>
                        <button class="floating-quick-btn" onclick="sendFloatingQuickMessage('ÂèØÂ§çÁî®ÁéáÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü')">
                            <span class="zh">ÂèØÂ§çÁî®ÁéáÔºü</span><span class="en">Reusability?</span>
                        </button>
                    </div>
                    
                    <div class="floating-chat-input-wrapper">
                        <input 
                            type="text" 
                            class="floating-chat-input" 
                            id="floating-chat-input"
                            placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢ò..."
                            onkeypress="if(event.key==='Enter') sendFloatingMessage()"
                        />
                        <button class="floating-chat-send" onclick="sendFloatingMessage()" id="floating-send-btn">
                            <i class="bi bi-send-fill"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊµÅÁ®ãÊåáÁ§∫Âô® -->
        <div class="step-indicator">
            <div class="step-item">
                <div class="step-number active" onclick="goToStep(1)">1</div>
                <div class="step-label active">ÈÄâÊã©Ê®°Êùø</div>
            </div>
            <div class="step-item">
                <div class="step-number" onclick="goToStep(2)" id="step-2">2</div>
                <div class="step-label">ÂêàËßÑÊ†°È™å</div>
            </div>
            <div class="step-item">
                <div class="step-number" onclick="goToStep(3)" id="step-3">3</div>
                <div class="step-label">Ëé∑ÂèñÊä•‰ª∑</div>
            </div>
            <div class="step-item">
                <div class="step-number" onclick="goToStep(4)" id="step-4">4</div>
                <div class="step-label">Á°ÆËÆ§‰∏ãÂçï</div>
            </div>
        </div>

        <!-- Á¨¨‰∏ÄÊ≠•ÔºöÈÄâÊã©Ê®°Êùø -->
        <div id="step-1-content" class="content-card">
            <div class="section-title"><i class="bi bi-bookmark"></i> <span class="zh">Ê≠•È™§ 1ÔºöÈÄâÊã©Â±ï‰ΩçÊ®°Êùø</span><span class="en show">Step 1: Select Booth Template</span></div>

            <div class="toggle-section" onclick="toggleSection('gallery-section')">
                <div><strong><span class="zh">ÊñπÊ°àÂ∫ìÁ¥†ÊùêÈ¢ÑËßà</span><span class="en show">Template Gallery Preview</span></strong><br><small><span class="zh">Êù•Ëá™ÁªøËâ≤ÁéØ‰øùÊñπÊ°àÂ∫ìÔºöÁé∞Âú∫ÁÖß„ÄÅÊñΩÂ∑•Âõæ„ÄÅÂìÅÁâåÊõøÊç¢Á§∫‰æã</span><span class="en show">From the Green Booth Library: On-site photos, construction drawings, brand replacement examples</span></small></div>
                <div class="toggle-icon" id="gallery-toggle">‚ñº</div>
            </div>
            <div id="gallery-section" class="hidden">
                <div class="template-grid">
                    <div class="template-card">
                        <img id="gallery-site" class="template-image" src="https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/Êê≠Âª∫ÂÆåÊØïÁé∞Âú∫ÁÖß.png" alt="Áé∞Âú∫/ÂÆåÂ∑•ÁÖß" onclick="previewImage('https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/Êê≠Âª∫ÂÆåÊØïÁé∞Âú∫ÁÖß.png', 'ÊñπÊ°à‰∏ÄÔºöÊê≠Âª∫ÂÆåÊØïÁé∞Âú∫ÁÖß')">
                        <div class="template-title">Áé∞Âú∫/ÂÆåÂ∑•ÁÖß</div>
                        <div class="template-spec">Êù•Ëá™ÊñπÊ°àÂ∫ìÔºàÁ§∫‰æãÔºâ<br><small style="color: #7c3aed;">üí° ÁÇπÂáªÊîæÂ§ßÊü•Áúã</small></div>
                    </div>
                    <div class="template-card">
                        <img id="gallery-drawing" class="template-image" src="https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊñΩÂ∑•Âõæ.png" alt="ÊñΩÂ∑•Âõæ" onclick="previewImage('https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊñΩÂ∑•Âõæ.png', 'ÊñπÊ°à‰∏ÄÔºöÊñΩÂ∑•Âõæ')">
                        <div class="template-title">ÊñΩÂ∑•Âõæ</div>
                        <div class="template-spec">ÁªìÊûÑ‰∏éÂ∞∫ÂØ∏ÂèÇËÄÉ<br><small style="color: #7c3aed;">üí° ÁÇπÂáªÊîæÂ§ßÊü•Áúã</small></div>
                    </div>
                    <div class="template-card">
                        <img id="gallery-logo" class="template-image" src="https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊõøÊç¢Â±ïÂïÜlogoÊïàÊûúÂõæ.png" alt="LogoÊõøÊç¢ÊïàÊûúÂõæ" onclick="previewImage('https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊõøÊç¢Â±ïÂïÜlogoÊïàÊûúÂõæ.png', 'ÊñπÊ°à‰∏ÄÔºöÊõøÊç¢Â±ïÂïÜLogoÊïàÊûúÂõæ')">
                        <div class="template-title">LogoÊõøÊç¢ÊïàÊûú</div>
                        <div class="template-spec">ÂìÅÁâå‰∏™ÊÄßÂåñÁ§∫‰æã<br><small style="color: #7c3aed;">üí° ÁÇπÂáªÊîæÂ§ßÊü•Áúã</small></div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>Â±ï‰ΩçÂ∞∫ÂØ∏</label>
                <select class="form-control" id="template-size" onchange="filterTemplates()">
                    <option value="">-- ÂÖ®ÈÉ®Â∞∫ÂØ∏ --</option>
                    <option value="9">9„é° (3m √ó 3m)</option>
                    <option value="18">18„é° (6m √ó 3m)</option>
                    <option value="27">27„é° (9m √ó 3m)</option>
                    <option value="36">36„é° (6m √ó 6m)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Â±ïÁ§∫È£éÊ†º</label>
                <select class="form-control" id="template-style" onchange="filterTemplates()">
                    <option value="">-- ÂÖ®ÈÉ®È£éÊ†º --</option>
                    <option value="modern">Áé∞‰ª£ÁÆÄÁ∫¶</option>
                    <option value="nature">Ëá™ÁÑ∂ÁéØ‰øù</option>
                    <option value="tech">ÁßëÊäÄÊÑü</option>
                    <option value="premium">È´òÁ´ØÂìÅÁâå</option>
                </select>
            </div>

            <div class="section-title" style="margin-top: 30px; border-left: 4px solid #27ae60;"><span class="zh">ÁªøËâ≤ÁéØ‰øùÊñπÊ°àÂ∫ì</span><span class="en show">Green Solution Library</span></div>
            
            <!-- Â±ï‰ΩçÁªüËÆ°‰ø°ÊÅØ -->
            <div class="booth-stats" id="booth-stats">
                <div class="booth-stat-item">
                    <span class="booth-stat-number" id="total-booths">48</span>
                    <span class="booth-stat-label">ÊÄªÊñπÊ°àÊï∞</span>
                </div>
                <div class="booth-stat-item">
                    <span class="booth-stat-number" id="displayed-booths">48</span>
                    <span class="booth-stat-label">ÂΩìÂâçÊòæÁ§∫</span>
                </div>
                <div class="booth-stat-item">
                    <span class="booth-stat-number">16</span>
                    <span class="booth-stat-label">18„é°ÊñπÊ°à</span>
                </div>
                <div class="booth-stat-item">
                    <span class="booth-stat-number">15</span>
                    <span class="booth-stat-label">27„é°ÊñπÊ°à</span>
                </div>
                <div class="booth-stat-item">
                    <span class="booth-stat-number">17</span>
                    <span class="booth-stat-label">36„é°ÊñπÊ°à</span>
                </div>
            </div>
            
            <p style="color: #7f8c8d; font-size: 12px; margin-bottom: 12px; line-height: 1.5;">
                <span class="zh">üí° <strong>‰ΩøÁî®ÊäÄÂ∑ß</strong>ÔºöÈÄâÊã©Â∞∫ÂØ∏/È£éÊ†ºËá™Âä®Á≠õÈÄâ | Èº†Ê†áÊÇ¨ÂÅúÊîæÂ§ßÈ¢ÑËßà | ÁÇπÂáªÂç°ÁâáÊü•ÁúãËØ¶ÊÉÖ | ÁÇπÂáªÂõæÁâáÂÖ®Â±èÊü•Áúã</span>
                <span class="en show">üí° <strong>Tips</strong>: Filter by size/style | Hover to zoom | Click card for details | Click image for fullscreen</span>
            </p>
            <div class="template-grid" id="template-gallery"></div>

            <!-- ‰∏™ÊÄßÂåñ‰∏éAIÁîüÊàêÈ¢ÑËßà -->
            <div class="toggle-section" onclick="toggleSection('custom-section')" style="margin-top: 20px;">
                <div><strong><span class="zh">‰∏™ÊÄßÂåñ‰∏éAIÁîüÊàêÈ¢ÑËßà</span><span class="en show">Customization & AI Preview</span></strong><br><small><span class="zh">ÈÄâÊã©È¢úËâ≤ / ‰∏ä‰º†Logo / ËæìÂÖ•Ëá™ÁÑ∂ËØ≠Ë®ÄÔºåËá™Âä®ÁîüÊàêÊïàÊûúÂõæÔºàÂ§öËßíÂ∫¶Ôºâ</span><span class="en show">Choose colors / Upload logo / Enter natural language to auto-generate renderings (multiple angles)</span></small></div>
                <div class="toggle-icon" id="custom-toggle">‚ñº</div>
            </div>
            <div id="custom-section" class="hidden">
                <div class="custom-grid">
                    <div class="custom-card">
                        <div class="custom-title">Logo‰∏ä‰º†</div>
                        <input type="file" id="logo-upload" accept="image/*" class="form-control" onchange="syncLogoColors()">
                        <div style="margin-top: 8px; font-size: 11px; color: #666;">
                            <i class="bi bi-info-circle"></i> LogoÈ¢úËâ≤Â∞ÜËá™Âä®Áî®‰∫éÈÖçËâ≤Âª∫ËÆÆ
                        </div>
                    </div>
                    <div class="custom-card">
                        <div class="custom-title">Â±ïÂè∞ÈÖçËâ≤ÔºàÂü∫‰∫éLogoÈ¢úËâ≤Ôºâ</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div>
                                <label style="font-size: 11px; color: #666;">‰∏ªËâ≤</label>
                                <input type="color" id="color-primary" value="#27ae60" class="form-control">
                            </div>
                            <div>
                                <label style="font-size: 11px; color: #666;">ËæÖËâ≤</label>
                                <input type="color" id="color-secondary" value="#2c3e50" class="form-control">
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 11px; color: #666;">
                            <i class="bi bi-lightbulb"></i> ‰∏ä‰º†LogoÂêéËá™Âä®ÂåπÈÖçÈÖçËâ≤ÊñπÊ°à
                        </div>
                    </div>
                    <div class="custom-card">
                        <div class="custom-title">ÁÖßÊòéÈÖçÁΩÆ</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div>
                                <label style="font-size: 11px; color: #666;">Â∞ÑÁÅØÊï∞Èáè</label>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <button class="btn-custom btn-secondary-custom" style="padding: 4px 10px; font-size: 14px;" onclick="adjustLighting('spotlight', -1)">-</button>
                                    <input type="number" id="spotlight-count" value="4" min="0" max="12" class="form-control" style="text-align: center;">
                                    <button class="btn-custom btn-secondary-custom" style="padding: 4px 10px; font-size: 14px;" onclick="adjustLighting('spotlight', 1)">+</button>
                                </div>
                            </div>
                            <div>
                                <label style="font-size: 11px; color: #666;">ÁôΩÁÅØÊï∞Èáè</label>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <button class="btn-custom btn-secondary-custom" style="padding: 4px 10px; font-size: 14px;" onclick="adjustLighting('whitelight', -1)">-</button>
                                    <input type="number" id="whitelight-count" value="2" min="0" max="12" class="form-control" style="text-align: center;">
                                    <button class="btn-custom btn-secondary-custom" style="padding: 4px 10px; font-size: 14px;" onclick="adjustLighting('whitelight', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 11px; color: #666;">
                            <i class="bi bi-info-circle"></i> Âü∫Á°ÄÊñπÊ°àÔºö4‰∏™Â∞ÑÁÅØ + 2‰∏™ÁôΩÁÅØ
                        </div>
                    </div>
                    <div class="custom-card">
                        <div class="custom-title">ÊùêÊñôÁ≠âÁ∫ß</div>
                        <select id="material-grade" class="form-control">
                            <option value="B1" selected>B1Á∫ßÈò≤ÁÅ´ÊùêÊñôÔºàÊ†áÂáÜÔºâ</option>
                            <option value="A">AÁ∫ßÈò≤ÁÅ´ÊùêÊñôÔºàÈ´òÁ∫ßÔºâ</option>
                            <option value="B2">B2Á∫ßÊùêÊñôÔºàÂü∫Á°ÄÔºâ</option>
                        </select>
                        <div style="margin-top: 8px; font-size: 11px; color: #27ae60;">
                            <i class="bi bi-shield-check"></i> Êé®Ëçê‰ΩøÁî®B1Á∫ß‰ª•‰∏äÈò≤ÁÅ´ÊùêÊñô
                        </div>
                    </div>
                    <div class="custom-card" style="grid-column: span 2;">
                        <div class="custom-title">‰∏™ÊÄßÂåñÂÆöÂà∂ÊúçÂä°ÔºàËá™ÁÑ∂ËØ≠Ë®ÄÊèèËø∞Ôºâ</div>
                        <textarea id="prompt-text" rows="4" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂÆöÂà∂ÈúÄÊ±ÇÔºå‰æãÂ¶ÇÔºöÊñ∞Â¢ûÊé•ÂæÖÂè∞„ÄÅÈôàÂàóÂè∞„ÄÅË∞ÉÊï¥ÁÖßÊòéÁ≠â"></textarea>
                        
                        <!-- Âø´Êç∑ÊúçÂä°ÈÄâÈ°π -->
                        <div style="margin-top: 12px; margin-bottom: 12px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px;">üí° Âø´Êç∑ÂÆöÂà∂ÈÄâÈ°πÔºàÁÇπÂáªËá™Âä®Â°´ÂÖÖÔºâÔºö</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn-custom btn-secondary-custom" style="font-size: 11px; padding: 6px 12px;" onclick="fillPrompt('Â¢ûÂä†Êé•ÂæÖÂè∞')">
                                    + Â¢ûÂä†Êé•ÂæÖÂè∞
                                </button>
                                <button class="btn-custom btn-secondary-custom" style="font-size: 11px; padding: 6px 12px;" onclick="fillPrompt('Â¢ûÂä†ÈôàÂàóÂè∞')">
                                    + Â¢ûÂä†ÈôàÂàóÂè∞
                                </button>
                                <button class="btn-custom btn-secondary-custom" style="font-size: 11px; padding: 6px 12px;" onclick="fillPrompt('ÂÆåÊï¥ÈÖçÁΩÆ')">
                                    Êé•ÂæÖÂè∞+ÈôàÂàóÂè∞
                                </button>
                                <button class="btn-custom btn-secondary-custom" style="font-size: 11px; padding: 6px 12px;" onclick="fillPrompt('Ë∞ÉÊï¥ÁÖßÊòé')">
                                    Ë∞ÉÊï¥ÁÖßÊòé
                                </button>
                            </div>
                        </div>
                        
                        <div class="button-group" style="justify-content:flex-start;">
                            <button class="btn-custom btn-primary-custom" onclick="applyCustomization(event)">
                                <i class="bi bi-magic"></i> <span class="zh">AIÁîüÊàêÈ¢ÑËßà</span><span class="en show">AI Generate</span>
                            </button>
                            <button class="btn-custom btn-secondary-custom" onclick="saveSnapshot()">
                                <i class="bi bi-save"></i> <span class="zh">‰øùÂ≠òÂΩìÂâçÈ¢ÑËßà</span><span class="en show">Save Preview</span>
                            </button>
                            <button class="btn-custom btn-secondary-custom" onclick="exportAdjustments()">
                                <i class="bi bi-file-earmark-arrow-down"></i> <span class="zh">ÂØºÂá∫Ë∞ÉÊï¥ËÆ∞ÂΩï</span><span class="en show">Export Log</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="template-grid" style="margin-top: 12px;">
                    <div class="template-card preview-card" data-preview="front">
                        <div class="template-title">Ê≠£Èù¢È¢ÑËßà</div>
                        <canvas id="preview-front" class="preview-canvas" data-index="0"></canvas>
                    </div>
                    <div class="template-card preview-card" data-preview="left">
                        <div class="template-title">Â∑¶ÂâçËßíÈ¢ÑËßà</div>
                        <canvas id="preview-left" class="preview-canvas" data-index="1"></canvas>
                    </div>
                    <div class="template-card preview-card" data-preview="right">
                        <div class="template-title">Âè≥ÂâçËßíÈ¢ÑËßà</div>
                        <canvas id="preview-right" class="preview-canvas" data-index="2"></canvas>
                    </div>
                </div>

                <!-- AIËæìÂá∫ÊïàÊûúÂõæ -->
                <div id="ai-output-section" style="display: none; margin-top: 20px;">
                    <div class="section-title" style="font-size:16px; border:none; padding:0; margin-bottom: 12px;">ü§ñ <span class="zh">AIÁîüÊàêÊïàÊûúÔºàÊõøÊç¢Â±ïÂïÜLogoÔºâ</span><span class="en show">AI Generated Result (Logo Replaced)</span></div>
                    <div style="background: white; border-radius: 8px; padding: 12px; border: 2px solid #7c3aed;">
                        <p style="font-size: 12px; color: #666; margin-bottom: 12px;">
                            <span class="zh">AIÂ∑≤‰∏∫ÊÇ®ÁîüÊàê‰∫ÜÊõøÊç¢Â±ïÂïÜLogoÂêéÁöÑÂ±ï‰ΩçÊïàÊûúÈ¢ÑËßà„ÄÇËøôÊòØÂü∫‰∫éÊÇ®ÈÄâÊã©ÁöÑÊ®°ÊùøÂíåËá™ÂÆö‰πâÂèÇÊï∞ÁöÑ‰∏ì‰∏öÊïàÊûúÂõæÔºö</span>
                            <span class="en show">AI has generated a booth preview with your logo. This is based on your selected template and customization parameters:</span>
                        </p>
                        <img id="ai-output-image" class="ai-preview-image clickable-image" src="" alt="AIÊïàÊûúÂõæ" onclick="previewImage(this.src, 'AIÁîüÊàêÊïàÊûúÂõæ - ÊõøÊç¢Â±ïÂïÜLogo')">
                        <div style="margin-top: 8px; font-size: 11px; color: #999; text-align: center;">
                            <span class="zh">üí° ÊèêÁ§∫ÔºöÁÇπÂáªÂõæÁâáÂèØÊîæÂ§ßÊü•ÁúãËØ¶ÊÉÖ</span>
                            <span class="en show">üí° Tip: This is an intelligent preview based on your selected scheme and configuration</span>
                        </div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 20px; font-size:16px; border:none; padding:0;">üìÅ ÁîüÊàêÁöÑÊàêÊûúÁâ©</div>
                <div id="artifact-list" class="artifact-grid"></div>
            </div>

            <!-- Step 1 AIÂä©ÁêÜ -->
            <div class="ai-assistant" id="step1-ai-assistant">
                <div class="ai-assistant-header">
                    <div>
                        <i class="bi bi-robot"></i> <span class="zh">AIÂä©ÁêÜÔºöÊ®°ÊùøÈÄâÊã©ÊåáÂçó</span><span class="en show">AI Assistant: Template Selection Guide</span>
                    </div>
                    <button class="ai-action-btn" onclick="toggleAIChat('step1')" style="margin: 0;">
                        <i class="bi bi-chat-dots"></i> <span class="zh">ÂØπËØù</span><span class="en show">Chat</span>
                    </button>
                </div>
                
                <!-- AI Chat Container -->
                <div id="step1-chat" class="ai-chat-container" style="display: none;">
                    <div id="step1-messages"></div>
                    <div id="step1-typing" style="display: none;">
                        <div class="ai-typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
                
                <div class="ai-input-container" id="step1-input" style="display: none;">
                    <input type="text" class="ai-input" id="step1-input-field" placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºöÂ¶Ç‰ΩïÈÄâÊã©ÂêàÈÄÇÁöÑÊ®°ÊùøÔºü" />
                    <button class="ai-send-btn" onclick="sendAIMessage('step1')">
                        <i class="bi bi-send"></i> <span class="zh">ÂèëÈÄÅ</span><span class="en show">Send</span>
                    </button>
                </div>
                
                <div class="ai-quick-actions" id="step1-quick" style="display: none;">
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step1', 'Â¶Ç‰ΩïÈÄâÊã©ÂêàÈÄÇÁöÑÊ®°ÊùøÔºü')">Â¶Ç‰ΩïÈÄâÊã©Ê®°ÊùøÔºü</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step1', '‰ªÄ‰πàÊòØÂèØÂ§çÁî®ÁéáÔºü')">ÂèØÂ§çÁî®ÁéáÊòØ‰ªÄ‰πàÔºü</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step1', 'ÊàëÊÉ≥ÁúãAIÁîüÊàêÁöÑÊïàÊûúÂõæ')">Êü•ÁúãAIÊïàÊûúÂõæ</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step1', '‰∏çÂêåÂ∞∫ÂØ∏ÁöÑ‰ª∑Ê†ºÂ∑ÆÂºÇÔºü')">‰ª∑Ê†ºÂ∑ÆÂºÇÔºü</button>
                </div>
                
                <div class="ai-assistant-content" id="step1-summary">
                    <span class="zh">
                        üëã Ê¨¢Ëøé‰ΩøÁî®Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰ΩçËá™Âä©Âπ≥Âè∞ÔºÅÊàëÊòØÊÇ®ÁöÑAIÂä©ÁêÜ„ÄÇ
                        <br>ÁÇπÂáª‰∏äÊñπ"ÂØπËØù"ÊåâÈíÆÔºåÈöèÊó∂ÂêëÊàëÊèêÈóÆ„ÄÇ
                    </span>
                    <span class="en show">
                        üëã Welcome to the Canton Fair Green Booth Self-Service Platform! I'm your AI assistant.
                        <br>Click "Chat" button above to ask me anything.
                    </span>
                </div>
                <ul class="ai-checklist">
                    <li id="check-template"><span class="zh">Â∑≤ÈÄâÊã©Ê®°Êùø</span><span class="en show">Template selected</span></li>
                    <li id="check-size"><span class="zh">Â∑≤ÈÄâÊã©Â∞∫ÂØ∏</span><span class="en show">Size selected</span></li>
                    <li id="check-style"><span class="zh">Â∑≤ÈÄâÊã©Â±ïÁ§∫È£éÊ†º</span><span class="en show">Style selected</span></li>
                </ul>
            </div>

            </div>
        </div>

        <!-- Á¨¨‰∫åÊ≠•ÔºöÂêàËßÑÊ†°È™å -->
        <div id="step-2-content" class="content-card hidden">
            <div class="section-title"><i class="bi bi-check-circle"></i> Ê≠•È™§ 2ÔºöÂêàËßÑÊ†°È™å</div>
            
                <div class="compliance-alert success">
                <div class="icon"><i class="bi bi-check-circle-fill"></i></div>
                <div>
                        <strong>‚úì Âü∫Á°Ä‰ø°ÊÅØÊ£ÄÊü•ÈÄöËøá</strong><br>
                        <small>Ê®°ÊùøÂêçÁß∞: <strong id="selected-template-label">ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç</strong> | Â∞∫ÂØ∏: <strong>6m √ó 3m</strong></small>
                </div>
            </div>

            <div class="form-group">
                <label>Â±ï‰ΩçÂÆûÈôÖÂ∞∫ÂØ∏ÔºàËØ∑Á°ÆËÆ§Ôºâ</label>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>
                            <label style="font-size: 12px; font-weight: normal;">ÈïøÂ∫¶(m)</label>
                            <input type="number" class="form-control" value="6" step="0.1">
                    </div>
                    <div>
                        <label style="font-size: 12px; font-weight: normal;">ÂÆΩÂ∫¶(m)</label>
                        <input type="number" class="form-control" value="3" step="0.1">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Â±ï‰ΩçÈ´òÂ∫¶(m)</label>
                <input type="number" class="form-control" value="2.5" step="0.1">
            </div>

            <div class="form-group">
                <label>‰∏ªË¶ÅÂ±ïÁ§∫ÊùêÊñô</label>
                <select class="form-control">
                    <option value="aluminum">ÈìùÂêàÈáëÊ°ÜÊû∂</option>
                    <option value="wood">Êú®Ë¥®Ê°ÜÊû∂</option>
                    <option value="steel">Èí¢ÈìÅÊ°ÜÊû∂</option>
                </select>
            </div>

            <button class="btn-custom btn-secondary-custom" style="width: 100%; margin-bottom: 20px;" onclick="runCompliance()">
                <i class="bi bi-play-circle"></i> Á´ãÂç≥Ê†°È™å
            </button>

            <div id="compliance-results" class="hidden">
                <div class="compliance-alert success">
                    <div class="icon"><i class="bi bi-check-circle-fill"></i></div>
                    <div>
                        <strong>‚úì Â∞∫ÂØ∏Ê†°È™åÈÄöËøá</strong><br>
                        <small>Â±ï‰ΩçÂ∞∫ÂØ∏Á¨¶ÂêàÂπø‰∫§‰ºöËßÑËåÉ (6m ‚â§ 18mÔºåÈ´òÂ∫¶ 2.5m ‚â§ 3.2m)</small>
                    </div>
                </div>

                <div class="compliance-alert success">
                    <div class="icon"><i class="bi bi-check-circle-fill"></i></div>
                    <div>
                        <strong>‚úì ÊùêÊñôÂêàËßÑ</strong><br>
                        <small>ÈìùÂêàÈáëÊ°ÜÊû∂Á¨¶ÂêàÂÆâÂÖ®Ê†áÂáÜÔºåÂèØÂõûÊî∂Áéá‚â•80%</small>
                    </div>
                </div>

                <div class="compliance-alert warning">
                    <div class="icon"><i class="bi bi-exclamation-circle-fill"></i></div>
                    <div>
                        <strong>‚ö† Ê∂àÈò≤ÁñèÊï£</strong><br>
                        <small>Âª∫ËÆÆÔºöÁ°Æ‰øùÂ±ï‰ΩçÂÜÖÁñèÊï£ÈÄöÈÅìÂÆΩÂ∫¶ ‚â•1.2m„ÄÇ<strong>È¢ÑÊ°àÔºöË∞ÉÊï¥Â±ïÂìÅÂ∏ÉÁΩÆÊñπÊ°à</strong></small>
                    </div>
                </div>

                <div class="compliance-alert success">
                    <div class="icon"><i class="bi bi-check-circle-fill"></i></div>
                    <div>
                        <strong>‚úì ÈáçÂøÉÁ®≥ÂÆöÊÄß</strong><br>
                        <small>Â±ï‰ΩçÁªìÊûÑÁ®≥ÂÆöÔºåÂèØÊâøËΩΩÊúÄÂ§ßË¥üËç∑ 150kg/„é°</small>
                    </div>
                </div>

                <div class="progress-bar-custom">
                    <div class="progress-fill" style="width: 92%;"></div>
                </div>
                <div style="text-align: center; font-weight: 600; color: #27ae60; margin-top: 8px;">ÂêàËßÑÈÄöËøáÁéá: 92% <span class="feature-badge">ÂèØËøõË°å‰∏ã‰∏ÄÊ≠•</span></div>
            </div>

            <div class="button-group">
                <button class="btn-custom btn-secondary-custom" onclick="goToStep(1)">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn-custom btn-primary-custom" onclick="goToStep(3)">‰∏ã‰∏ÄÊ≠•ÔºöËé∑ÂèñÊä•‰ª∑ ‚Üí</button>
            </div>

            <!-- Step 2 AIÂä©ÁêÜ -->
            <div class="ai-assistant show" id="step2-ai-assistant" style="margin-top: 30px;">
                <div class="ai-assistant-header">
                    <div>
                        <i class="bi bi-shield-check"></i> <span class="zh">AIÂä©ÁêÜÔºöÂêàËßÑÊ†°È™åÊåáÂçó</span><span class="en show">AI Assistant: Compliance Guide</span>
                    </div>
                    <button class="ai-action-btn" onclick="toggleAIChat('step2')" style="margin: 0;">
                        <i class="bi bi-chat-dots"></i> <span class="zh">ÂØπËØù</span><span class="en show">Chat</span>
                    </button>
                </div>
                
                <!-- AI Chat Container -->
                <div id="step2-chat" class="ai-chat-container" style="display: none;">
                    <div id="step2-messages"></div>
                    <div id="step2-typing" style="display: none;">
                        <div class="ai-typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
                
                <div class="ai-input-container" id="step2-input" style="display: none;">
                    <input type="text" class="ai-input" id="step2-input-field" placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºöÊ∂àÈò≤Ë¶ÅÊ±ÇÊòØ‰ªÄ‰πàÔºü" />
                    <button class="ai-send-btn" onclick="sendAIMessage('step2')">
                        <i class="bi bi-send"></i> <span class="zh">ÂèëÈÄÅ</span><span class="en show">Send</span>
                    </button>
                </div>
                
                <div class="ai-quick-actions" id="step2-quick" style="display: none;">
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step2', 'ÂêàËßÑ‰∏çÈÄöËøáÊÄé‰πàÂäûÔºü')">Â¶Ç‰ΩïËß£ÂÜ≥ÂêàËßÑÈóÆÈ¢òÔºü</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step2', 'Ê∂àÈò≤Ë¶ÅÊ±ÇÊúâÂì™‰∫õÔºü')">Ê∂àÈò≤Ë¶ÅÊ±Ç</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step2', 'ÊùêÊñôÈúÄË¶ÅÁéØ‰øùËÆ§ËØÅÂêóÔºü')">ÊùêÊñôËÆ§ËØÅ</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step2', 'ÁñèÊï£ÈÄöÈÅìÂÆΩÂ∫¶Ê†áÂáÜÔºü')">ÁñèÊï£ÈÄöÈÅì</button>
                </div>
                
                <div class="ai-assistant-content" id="step2-summary">
                    <span class="zh">
                        üîç ÊàëÂ∑≤ÁªèÂÆåÊàê‰∫ÜÂØπÊÇ®Â±ï‰ΩçÊñπÊ°àÁöÑ‰∏ì‰∏öÂêàËßÑÂÆ°Ê†∏„ÄÇÂπø‰∫§‰ºöÂØπÊâÄÊúâÂ±ï‰ΩçÊúâ‰∏•Ê†ºÁöÑÂÆâÂÖ®ÂíåÁéØ‰øùÊ†áÂáÜ„ÄÇ
                    </span>
                    <span class="en show">
                        üîç I have completed a professional compliance review of your booth design.
                    </span>
                </div>
                <ul class="ai-checklist">
                    <li class="completed"><span class="zh">‚úì Â∞∫ÂØ∏Ê†°È™åÈÄöËøá</span><span class="en show">‚úì Size compliant</span></li>
                    <li class="completed"><span class="zh">‚úì ÊùêÊñôÂêàËßÑÊ£ÄÊü•</span><span class="en show">‚úì Materials approved</span></li>
                    <li><span class="zh">‚ö† Ê∂àÈò≤ÁñèÊï£ - ÈúÄË∞ÉÊï¥</span><span class="en show">‚ö† Fire safety - Action needed</span></li>
                    <li class="completed"><span class="zh">‚úì ÁªìÊûÑÁ®≥ÂÆöÊÄß</span><span class="en show">‚úì Structure stable</span></li>
                </ul>
                <div style="margin-top: 12px; padding: 10px; background: #fff9e6; border-radius: 6px; font-size: 12px; color: #666;">
                    <span class="zh"><strong>Âª∫ËÆÆÔºö</strong> Á°Æ‰øùÂ±ï‰ΩçÂÜÖÁñèÊï£ÈÄöÈÅìÂÆΩÂ∫¶ ‚â• 1.2m„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∏ÆÊÇ®Ë∞ÉÊï¥Â±ïÂìÅÂ∏ÉÁΩÆÊñπÊ°à„ÄÇ</span>
                    <span class="en show"><strong>Recommendation:</strong> Ensure the evacuation aisle width ‚â• 1.2m. We can help adjust the display layout.</span>
                </div>
            </div>
        </div>

        <!-- Á¨¨‰∏âÊ≠•ÔºöËé∑ÂèñÊä•‰ª∑ -->
        <div id="step-3-content" class="content-card hidden">
            <div class="section-title"><i class="bi bi-calculator"></i> Ê≠•È™§ 3ÔºöËé∑ÂèñÊä•‰ª∑</div>
            
            <div class="progress-bar-custom">
                <div class="progress-fill" style="width: 100%;"></div>
            </div>
            <div style="text-align: center; color: #27ae60; font-weight: 600; margin-bottom: 20px;">Ê≠£Âú®ËÆ°ÁÆóÊàêÊú¨...</div>

            <div class="section-title" style="margin-top: 30px; font-size: 16px; border: none; padding: 0;">üì¶ Áâ©ÊñôÊ∏ÖÂçï (BOM)</div>

            <div class="material-list">
                <div class="material-item">
                    <div class="material-info">
                        <div class="material-name">ÈìùÂêàÈáëÊ°ÜÊû∂ (40x40mm)</div>
                        <div class="material-spec">ÂèØÂ§çÁî®ÔºåÈòªÁáÉÁ≠âÁ∫ß B1</div>
                    </div>
                    <div class="material-qty">48m</div>
                </div>

                <div class="material-item">
                    <div class="material-info">
                        <div class="material-name">ÁéØ‰øù‰∫öÂÖãÂäõÊùø (3mm)</div>
                        <div class="material-spec">ÁôΩËâ≤ÔºåÂèØÂÆöÂà∂ÊâìÂç∞</div>
                    </div>
                    <div class="material-qty">18„é°</div>
                </div>

                <div class="material-item">
                    <div class="material-info">
                        <div class="material-name">LEDÁÖßÊòéÊ®°ÁªÑ</div>
                        <div class="material-spec">ËäÇËÉΩÔºåËâ≤Ê∏©ÂèØË∞É</div>
                    </div>
                    <div class="material-qty">8‰∏™</div>
                </div>

                <div class="material-item">
                    <div class="material-info">
                        <div class="material-name">Âê∏Èü≥Ê£âÂû´</div>
                        <div class="material-spec">ÁéØ‰øùÊó†Áî≤ÈÜõ</div>
                    </div>
                    <div class="material-qty">12„é°</div>
                </div>
            </div>

            <div class="toggle-section" onclick="toggleSection('bom-image-section')">
                <div><strong>Êü•ÁúãÊ†∑‰æãÊ∏ÖÂçïÂõæÁâá</strong><br><small>ÊñπÊ°à‰∏ÄÔºöÊùêÊñôÊ∏ÖÂçï.pngÔºõÊñπÊ°à‰∫åÔºöBOM.png</small></div>
                <div class="toggle-icon" id="bom-toggle">‚ñº</div>
            </div>
            <div id="bom-image-section" class="hidden">
                <img id="bom-image" src="https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊùêÊñôÊ∏ÖÂçï.png" alt="Ê†∑‰æãÊ∏ÖÂçï" class="clickable-image" style="width:100%; border-radius:8px; border:1px solid #eee;" onclick="previewImage(this.src, 'ÊùêÊñôÊ∏ÖÂçï / BOM')">
                <p style="text-align: center; margin-top: 8px; font-size: 12px; color: #7c3aed;">üí° ÁÇπÂáªÂõæÁâáÂèØÊîæÂ§ßÊü•ÁúãËØ¶ÊÉÖ</p>
            </div>

            <div class="section-title" style="margin-top: 30px; font-size: 16px; border: none; padding: 0;">üí∞ Ë¥πÁî®ÊòéÁªÜ</div>

            <table class="quote-table">
                <thead>
                    <tr>
                        <th>Ë¥πÁî®È°πÁõÆ</th>
                        <th style="text-align: right;">ÈáëÈ¢ù (¬•)</th>
                        <th style="text-align: right;">ËØ¥Êòé</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ÊùêÊñôË¥πÁî®</strong></td>
                        <td style="text-align: right;"><strong id="cost-materials">28,500</strong></td>
                        <td style="text-align: right; font-size: 12px;">Ê°ÜÊû∂„ÄÅÊùøÊùê„ÄÅÈÖç‰ª∂</td>
                    </tr>
                    <tr>
                        <td><strong>Êê≠Âª∫‰∫∫Â∑•Ë¥π</strong></td>
                        <td style="text-align: right;"><strong id="cost-labor">12,000</strong></td>
                        <td style="text-align: right; font-size: 12px;">2Â§©, 4‰∫∫Âõ¢Èòü</td>
                    </tr>
                    <tr>
                        <td><strong>ËøêËæìÈÖçÈÄÅË¥π</strong></td>
                        <td style="text-align: right;"><strong id="cost-logistics">3,500</strong></td>
                        <td style="text-align: right; font-size: 12px;">ÂæÄËøîÈÖçÈÄÅ</td>
                    </tr>
                    <tr>
                        <td><strong>ËÆæËÆ°ÂÆöÂà∂Ë¥π</strong></td>
                        <td style="text-align: right;"><strong id="cost-design">2,000</strong></td>
                        <td style="text-align: right; font-size: 12px;">logoÊõøÊç¢„ÄÅÈÖçËâ≤Ë∞ÉÊï¥</td>
                    </tr>
                    <tr>
                        <td><strong><span class="zh">ÂèØÈÄâÊúçÂä°Ë¥π</span><span class="en show">Optional Services</span></strong></td>
                        <td style="text-align: right;"><strong id="cost-optionals" style="color: #e74c3c;">0</strong></td>
                        <td style="text-align: right; font-size: 12px;"><span class="zh">ÈÖçËâ≤„ÄÅÁÖßÊòé„ÄÅÊùêÊñôÂçáÁ∫ßÁ≠â</span><span class="en show">Colors, lighting, materials upgrade, etc.</span></td>
                    </tr>
                    <tr>
                        <td colspan="3" style="padding: 0;"><hr style="margin: 0; border: none; border-top: 2px solid #27ae60;"></td>
                    </tr>
                    <tr>
                        <td><strong>Â∞èËÆ°</strong></td>
                        <td style="text-align: right; color: #27ae60; font-weight: 700;"><span id="subtotal">46,000</span></td>
                        <td style="text-align: right;"></td>
                    </tr>
                </tbody>
            </table>

            <div class="quote-summary">
                <div class="summary-row">
                    <span class="summary-label">Âü∫Á°Ä‰ª∑Ê†º</span>
                    <span class="summary-value"><span id="base-price">46,000</span> ¬•</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">ËøêËê•ÊúçÂä°Ë¥π (7%)</span>
                    <span class="summary-value">+ <span id="op-fee">3,220</span> ¬•</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Âπ≥Âè∞ÊäÄÊúØË¥π (3%)</span>
                    <span class="summary-value">+ <span id="tech-fee">1,380</span> ¬•</span>
                </div>
                <div class="summary-row total">
                    <span class="summary-label">ÊÄªËÆ° (Âê´ÊúçÂä°)</span>
                    <span class="summary-value"><span id="total-price">50,600</span> ¬•</span>
                </div>
            </div>

            <div style="background: #f0f8ff; border-left: 4px solid #17a2b8; padding: 12px; margin-top: 20px; border-radius: 4px; font-size: 13px;">
                <i class="bi bi-info-circle"></i> <strong>Êä•‰ª∑ÊúâÊïàÊúüÔºö7Â§©</strong> | Âê´Êê≠Âª∫„ÄÅÊãÜÂç∏„ÄÅÊ∏ÖËøê | ÂèØÈÄâÂ¢ûÂÄºÊúçÂä°ÔºöÂ∏ÉÊôØËÆæËÆ°„ÄÅÁÅØÂÖâÊñπÊ°àÁ≠â
            </div>

            <div class="button-group">
                <button class="btn-custom btn-secondary-custom" onclick="goToStep(2)">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn-custom btn-primary-custom" onclick="goToStep(4)">‰∏ã‰∏ÄÊ≠•ÔºöÁ°ÆËÆ§‰∏ãÂçï ‚Üí</button>
            </div>

            <!-- Step 3 AIÂä©ÁêÜ -->
            <div class="ai-assistant show" id="step3-ai-assistant" style="margin-top: 30px;">
                <div class="ai-assistant-header">
                    <div>
                        <i class="bi bi-currency-exchange"></i> <span class="zh">AIÂä©ÁêÜÔºöÊä•‰ª∑ÂàÜÊûê</span><span class="en show">AI Assistant: Price Analysis</span>
                    </div>
                    <button class="ai-action-btn" onclick="toggleAIChat('step3')" style="margin: 0;">
                        <i class="bi bi-chat-dots"></i> <span class="zh">ÂØπËØù</span><span class="en show">Chat</span>
                    </button>
                </div>
                
                <!-- AI Chat Container -->
                <div id="step3-chat" class="ai-chat-container" style="display: none;">
                    <div id="step3-messages"></div>
                    <div id="step3-typing" style="display: none;">
                        <div class="ai-typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
                
                <div class="ai-input-container" id="step3-input" style="display: none;">
                    <input type="text" class="ai-input" id="step3-input-field" placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºö‰∏∫‰ªÄ‰πàÈúÄË¶ÅÊúçÂä°Ë¥πÔºü" />
                    <button class="ai-send-btn" onclick="sendAIMessage('step3')">
                        <i class="bi bi-send"></i> <span class="zh">ÂèëÈÄÅ</span><span class="en show">Send</span>
                    </button>
                </div>
                
                <div class="ai-quick-actions" id="step3-quick" style="display: none;">
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step3', 'ÊúçÂä°Ë¥πÊòØ‰ªÄ‰πàÔºü')">ÊúçÂä°Ë¥πËØ¥Êòé</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step3', 'Êé®Ëçê‰ªÄ‰πàÂèØÈÄâÊúçÂä°Ôºü')">Êé®ËçêÂ¢ûÂÄºÊúçÂä°</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step3', '‰ª∑Ê†ºÂèØ‰ª•‰ºòÊÉ†ÂêóÔºü')">‰ºòÊÉ†ÊîøÁ≠ñ</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step3', 'Â¶Ç‰ΩïÈôç‰ΩéÊàêÊú¨Ôºü')">ÊàêÊú¨‰ºòÂåñ</button>
                </div>
                
                <div class="ai-assistant-content" id="step3-summary">
                    <span class="zh">
                        üí∞ Ê†πÊçÆÊÇ®ÁöÑÈÄâÊã©ÔºåÊàë‰∏∫ÊÇ®Á≤æÁ°ÆËÆ°ÁÆó‰∫ÜÂ±ï‰ΩçÁöÑÂÆåÊï¥Êä•‰ª∑„ÄÇ
                    </span>
                    <span class="en show">
                        üí∞ Based on your selections, I have calculated a detailed price quote.
                    </span>
                </div>
                <ul class="ai-checklist" style="font-size: 12px;">
                    <li class="completed"><span class="zh">‚úì ÊùêÊñôË¥πÁî®Â∑≤ËÆ°ÁÆó</span><span class="en show">‚úì Materials calculated</span></li>
                    <li class="completed"><span class="zh">‚úì ‰∫∫Â∑•Ë¥πÂ∑≤ËØÑ‰º∞</span><span class="en show">‚úì Labor estimated</span></li>
                    <li class="completed"><span class="zh">‚úì ÈÖçÈÄÅË¥πÂ∑≤Á°ÆËÆ§</span><span class="en show">‚úì Logistics confirmed</span></li>
                    <li><span class="zh">üí° ÂèØÈÄâÊúçÂä°Âª∫ËÆÆ - ÊèêÂçáÂìÅË¥®</span><span class="en show">üí° Add-ons suggested - Enhance quality</span></li>
                </ul>
                <div style="margin-top: 12px; padding: 10px; background: #e8f5e9; border-radius: 6px; font-size: 12px; color: #666;">
                    <span class="zh"><strong>AIÂª∫ËÆÆÔºö</strong> Ê†πÊçÆÊÇ®ÁöÑÂìÅÁâåÂÆö‰ΩçÔºåÊàëÂª∫ËÆÆÊ∑ªÂä† \"Âº∫ÂåñLEDÁÖßÊòé\" Âíå \"24Â∞èÊó∂Âú®Á∫øÊîØÊåÅ\"ÔºåÂèØÊèêÂçáÂ±ï‰Ωç‰∏ì‰∏öÂ∫¶ÔºåÊèêÈ´òËÆøÂÆ¢ÂÅúÁïôÊó∂Èó¥„ÄÇ</span>
                    <span class="en show"><strong>AI Suggestion:</strong> Based on your brand positioning, I recommend adding \"Enhanced LED lighting\" and \"24/7 Support\" to elevate booth professionalism and extend visitor engagement.</span>
                </div>
            </div>
        </div>

        <!-- Á¨¨ÂõõÊ≠•ÔºöÁ°ÆËÆ§‰∏ãÂçï -->
        <div id="step-4-content" class="content-card hidden">
            <div class="section-title"><i class="bi bi-receipt"></i> Ê≠•È™§ 4ÔºöÁ°ÆËÆ§ËÆ¢Âçï</div>
            
            <div class="order-summary">
                <h5>üìã ËÆ¢ÂçïÊëòË¶Å</h5>
                <div class="order-info">
                    <div class="order-info-item">
                        <div class="order-info-label">ÈÄâÊã©Ê®°Êùø</div>
                        <div class="order-info-value" id="order-template-label">ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Â±ï‰ΩçÂ∞∫ÂØ∏</div>
                        <div class="order-info-value">6m √ó 3m</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">ÂêàËßÑÁä∂ÊÄÅ</div>
                        <div class="order-info-value" style="color: #27ae60;">‚úì ÈÄöËøá (92%)</div>
                    </div>
                    <div class="order-info-item">
                        <div class="order-info-label">Êä•‰ª∑ÈáëÈ¢ù</div>
                        <div class="order-info-value"><span id="order-total">50,600</span> ¬•</div>
                    </div>
                </div>

                <!-- ÂèØÈÄâÊúçÂä°ÈÄâÊã©ÊëòË¶Å -->
                <div id="order-optionals-summary" style="margin-top: 16px; padding: 12px; background: #e8f8f5; border-radius: 6px; border-left: 4px solid #27ae60; display: none;">
                    <div style="font-weight: 600; color: #27ae60; margin-bottom: 10px;"><i class="bi bi-plus-circle"></i> <span class="zh">Â∑≤ÈÄâÊã©ÁöÑÂ¢ûÂÄºÊúçÂä°</span><span class="en show">Selected Add-ons</span></div>
                    <ul id="order-optionals-list" style="list-style: none; padding: 0; margin: 0; font-size: 13px;">
                        <li style="color: #666; padding: 4px 0;"><span class="zh">ÊöÇÊó†ÈÄâÊã©</span><span class="en show">None selected</span></li>
                    </ul>
                </div>
            </div>

            <div class="toggle-section" onclick="toggleSection('confirm-image-section')">
                <div><strong>ÊñπÊ°àÊïàÊûúÂõæ / Áé∞Âú∫ÁÖß</strong><br><small>Áî®‰∫éËÆ¢ÂçïÁ°ÆËÆ§Â±ïÁ§∫</small></div>
                <div class="toggle-icon" id="confirm-toggle">‚ñº</div>
            </div>
            <div id="confirm-image-section" class="hidden">
                <img id="confirm-image" src="https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÂØπÂ§ñÊïàÊûúÂõæ.png" alt="ÊñπÊ°àÊïàÊûúÂõæ" class="clickable-image" style="width:100%; border-radius:8px; border:1px solid #eee;" onclick="previewImage(this.src, 'ÊñπÊ°àÊïàÊûúÂõæ / Áé∞Âú∫ÁÖß')">
                <p style="text-align: center; margin-top: 8px; font-size: 12px; color: #7c3aed;">üí° ÁÇπÂáªÂõæÁâáÂèØÊîæÂ§ßÊü•ÁúãËØ¶ÊÉÖ</p>
            </div>

            <div class="toggle-section" onclick="toggleSection('confirm-artifacts')" style="margin-top:12px;">
                <div><strong>AIÁîüÊàêÈ¢ÑËßàÔºàÂ§öËßíÂ∫¶Ôºâ</strong><br><small>Â±ïÁ§∫ÂÆ¢Êà∑Á°ÆËÆ§ÂâçÁöÑ‰∏™ÊÄßÂåñÈ¢ÑËßàÊàêÊûú</small></div>
                <div class="toggle-icon" id="confirm-artifacts-toggle">‚ñº</div>
            </div>
            <div id="confirm-artifacts" class="hidden">
                <div id="confirm-artifacts-list" class="artifact-grid"></div>
            </div>

            <div class="form-group">
                <label>ÂèÇÂ±ïÂïÜÂêçÁß∞ *</label>
                <input type="text" class="form-control" placeholder="ËØ∑ËæìÂÖ•‰ºÅ‰∏öÊàñÂìÅÁâåÂêçÁß∞">
            </div>

            <div class="form-group">
                <label>ËÅîÁ≥ª‰∫∫ *</label>
                <input type="text" class="form-control" placeholder="ËÅîÁ≥ª‰∫∫ÂêçÁß∞">
            </div>

            <div class="form-group">
                <label>ËÅîÁ≥ªÁîµËØù *</label>
                <input type="tel" class="form-control" placeholder="020-XXXX-XXXX">
            </div>

            <div class="form-group">
                <label>ÁîµÂ≠êÈÇÆÁÆ± *</label>
                <input type="email" class="form-control" placeholder="contact@example.com">
            </div>

            <div class="form-group">
                <label>ÈÄâÊã©ÊîØ‰ªòÊñπÂºè *</label>
                <select class="form-control">
                    <option value="">-- ËØ∑ÈÄâÊã© --</option>
                    <option value="wechat">ÂæÆ‰ø°ÊîØ‰ªò</option>
                    <option value="alipay">ÊîØ‰ªòÂÆù</option>
                    <option value="transfer">Èì∂Ë°åËΩ¨Ë¥¶</option>
                    <option value="invoice">ÂºÄÂÖ∑ÂèëÁ•®ÂêéÊîØ‰ªò</option>
                </select>
            </div>

            <div style="background: #fff3cd; border-left: 4px solid #ff9800; padding: 12px; margin: 20px 0; border-radius: 4px; font-size: 13px;">
                <strong><i class="bi bi-exclamation-circle"></i> ÈáçË¶ÅÊèêÁ§∫</strong><br>
                ‚Ä¢ ËÆ¢ÂçïÁ°ÆËÆ§ÂêéÔºåÊàë‰ª¨Â∞ÜÂú®24Â∞èÊó∂ÂÜÖ‰∏éÊÇ®ËÅîÁ≥ªËøõË°åÊñπÊ°àÁ°ÆËÆ§<br>
                ‚Ä¢ ÊîØ‰ªòÂêéÔºåÊê≠Âª∫ÊñπÊ°àÂ∞ÜËøõÂÖ•Áîü‰∫ßÊéíÊúü<br>
                ‚Ä¢ Â±ï‰ºöÂâç7Â§©ÂÆåÊàêÊê≠Âª∫Âπ∂‰∫§‰ªò
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px; font-size: 13px;">
                <input type="checkbox" id="agree-terms">
                <label for="agree-terms">ÊàëÂ∑≤ÈòÖËØªÂπ∂ÂêåÊÑè <a href="#" style="color: #27ae60; text-decoration: none;">„ÄäÊúçÂä°Êù°Ê¨æ„Äã</a> Âíå <a href="#" style="color: #27ae60; text-decoration: none;">„ÄäÈöêÁßÅÊîøÁ≠ñ„Äã</a></label>
            </div>

            <div class="button-group">
                <button class="btn-custom btn-secondary-custom" onclick="goToStep(3)">‚Üê ‰∏ä‰∏ÄÊ≠•</button>
                <button class="btn-custom btn-primary-custom" onclick="submitOrder()">Á°ÆËÆ§‰∏ãÂçïÂπ∂ÊîØ‰ªò ‚Üí</button>
            </div>

            <!-- Step 4 AIÂä©ÁêÜ -->
            <div class="ai-assistant show" id="step4-ai-assistant" style="margin-top: 30px;">
                <div class="ai-assistant-header">
                    <div>
                        <i class="bi bi-clipboard-check"></i> <span class="zh">AIÂä©ÁêÜÔºöËÆ¢ÂçïÊúÄÁªàÁ°ÆËÆ§</span><span class="en show">AI Assistant: Final Order Confirmation</span>
                    </div>
                    <button class="ai-action-btn" onclick="toggleAIChat('step4')" style="margin: 0;">
                        <i class="bi bi-chat-dots"></i> <span class="zh">ÂØπËØù</span><span class="en show">Chat</span>
                    </button>
                </div>
                
                <!-- AI Chat Container -->
                <div id="step4-chat" class="ai-chat-container" style="display: none;">
                    <div id="step4-messages"></div>
                    <div id="step4-typing" style="display: none;">
                        <div class="ai-typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
                
                <div class="ai-input-container" id="step4-input" style="display: none;">
                    <input type="text" class="ai-input" id="step4-input-field" placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºöÊîØ‰ªòÊñπÂºèÊúâÂì™‰∫õÔºü" />
                    <button class="ai-send-btn" onclick="sendAIMessage('step4')">
                        <i class="bi bi-send"></i> <span class="zh">ÂèëÈÄÅ</span><span class="en show">Send</span>
                    </button>
                </div>
                
                <div class="ai-quick-actions" id="step4-quick" style="display: none;">
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step4', 'ÊîØ‰ªòÊñπÂºèÊúâÂì™‰∫õÔºü')">ÊîØ‰ªòÊñπÂºè</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step4', 'ËÆ¢ÂçïÁ°ÆËÆ§ÂêéÂ§ö‰πÖ‰∫§‰ªòÔºü')">‰∫§‰ªòÊó∂Èó¥</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step4', 'ÂèØ‰ª•‰øÆÊîπËÆ¢ÂçïÂêóÔºü')">ËÆ¢Âçï‰øÆÊîπ</button>
                    <button class="ai-quick-btn" onclick="sendQuickMessage('step4', 'Êúâ‰ªÄ‰πàÂîÆÂêéÊúçÂä°Ôºü')">ÂîÆÂêéÊúçÂä°</button>
                </div>
                
                <div class="ai-assistant-content" id="step4-summary">
                    <span class="zh">
                        ‚úÖ ÊÇ®Â∑≤ÂÆåÊàê‰∫ÜÊâÄÊúâÊ≠•È™§ÔºÅÁé∞Âú®Âè™ÈúÄÁ°ÆËÆ§‰ª•‰∏ã‰ø°ÊÅØÔºåÂ∞±ÂèØ‰ª•Êèê‰∫§ËÆ¢Âçï„ÄÇ
                    </span>
                    <span class="en show">
                        ‚úÖ You have completed all steps! Just confirm the information and submit your order.
                    </span>
                </div>
                <ul class="ai-checklist">
                    <li><span class="zh">‚úì Â±ï‰ΩçÊ®°ÊùøÂ∑≤ÈÄâÊã©</span><span class="en show">‚úì Booth template selected</span></li>
                    <li><span class="zh">‚úì ÂêàËßÑÊ†°È™åÂ∑≤ÈÄöËøá</span><span class="en show">‚úì Compliance verified</span></li>
                    <li><span class="zh">‚úì Êä•‰ª∑Â∑≤Á°ÆËÆ§</span><span class="en show">‚úì Price confirmed</span></li>
                    <li><span class="zh">ÂæÖÂÆåÊàêÔºöÂ°´ÂÜô‰ºÅ‰∏öÂíåËÅîÁ≥ª‰ø°ÊÅØ</span><span class="en show">Pending: Complete company & contact info</span></li>
                    <li><span class="zh">ÂæÖÂÆåÊàêÔºöÂêåÊÑèÊúçÂä°Êù°Ê¨æ</span><span class="en show">Pending: Agree to terms</span></li>
                </ul>
                <div style="margin-top: 12px; padding: 10px; background: #c8e6c9; border-radius: 6px; font-size: 12px; color: #2e7d32;">
                    <span class="zh"><strong>‚ú® ËÆ¢ÂçïÁ°ÆËÆ§ÂêéÁöÑÊµÅÁ®ãÔºö</strong> 1) Êàë‰ª¨Âú®24Â∞èÊó∂ÂÜÖ‰∏éÊÇ®ËÅîÁ≥ªÁ°ÆËÆ§ ‚Üí 2) 3-5Â§©ÂÜÖÂÆåÊàêËÆæËÆ°‰ºòÂåñ ‚Üí 3) Â±ï‰ºöÂâç7Â§©ÂÆåÊàêÊê≠Âª∫‰∫§‰ªò</span>
                    <span class="en show"><strong>‚ú® Process after confirmation:</strong> 1) We'll contact you within 24 hours ‚Üí 2) Design optimization in 3-5 days ‚Üí 3) Booth delivery 7 days before the fair</span>
                </div>
            </div>
        </div>

        <!-- ËÆ¢ÂçïÊàêÂäü -->
        <div id="success-content" class="content-card hidden">
            <div class="success-message">
                <h4><i class="bi bi-check-circle"></i> ËÆ¢ÂçïÂàõÂª∫ÊàêÂäüÔºÅ</h4>
                <p style="margin-bottom: 0;">ÊÇ®ÁöÑÂ±ï‰ΩçÊñπÊ°àÂ∑≤Êèê‰∫§ÔºåÊàë‰ª¨Â∞ÜÂ∞ΩÂø´‰∏∫ÊÇ®ÊúçÂä°„ÄÇ</p>
                
                <div class="order-id">
                    ËÆ¢ÂçïÂè∑: ORD20241221-A82B4C
                </div>

                <div style="background: white; padding: 16px; border-radius: 6px; margin-top: 16px; text-align: left; font-size: 13px; line-height: 1.8; color: #2c3e50;">
                    <div style="font-weight: 600; margin-bottom: 12px;">üìÖ ÂêéÁª≠Ê≠•È™§</div>
                    <div style="display: grid; gap: 12px;">
                        <div><strong>24Â∞èÊó∂ÂÜÖ:</strong> Êê≠Âª∫ÊñπÂõ¢ÈòüÂ∞Ü‰∏éÊÇ®ÁîµËØùÁ°ÆËÆ§Ôºà020-1234-5678Ôºâ</div>
                        <div><strong>3-5Â§©ÂÜÖ:</strong> ÂÆåÊàêÊñπÊ°àËÆæËÆ°‰∏é‰ºòÂåñÁ°ÆËÆ§</div>
                        <div><strong>7Â§©Ââç:</strong> ÂÆåÊàêÂ±ï‰ΩçÊê≠Âª∫Âπ∂‰∫§‰ªòÈ™åÊî∂</div>
                        <div><strong>Â±ï‰ºöÂêé:</strong> ËøõË°åÊãÜÂç∏‰∏éÂõûÊî∂ÔºåÂÆåÊï¥Èó≠ÁéØ</div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <button class="btn-custom btn-primary-custom" onclick="resetForm()" style="width: 100%;">
                        <i class="bi bi-plus-circle"></i> ËøîÂõûÈ¶ñÈ°µ / ÁªßÁª≠‰∏ãÂçï
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Â∫ïÈÉ® -->
    <div style="text-align: center; padding: 40px 20px; color: #7f8c8d; font-size: 13px; background: white; margin-top: 40px; border-top: 1px solid #eee;">
        <p>Âπø‰∫§‰ºöÁªøËâ≤ÁéØ‰øùÂ±ï‰ΩçËá™Âä©Âπ≥Âè∞ ¬∑ MVPÂéüÂûã v1.0 | 
            <a href="#" style="color: #27ae60; text-decoration: none;">ÂÖ≥‰∫éÊàë‰ª¨</a> ¬∑ 
            <a href="#" style="color: #27ae60; text-decoration: none;">ËÅîÁ≥ªÊàë‰ª¨</a> ¬∑ 
            <a href="#" style="color: #27ae60; text-decoration: none;">Â∏ÆÂä©‰∏≠ÂøÉ</a></p>
        <p style="margin: 0;">¬© 2026 Âπø‰∫§‰ºö ¬∑ ‰∏ñÁ¶èÂÖ¨Âè∏ ¬∑ TBÊäÄÊúØÂπ≥Âè∞ | ‰øùÊä§ÁéØÂ¢ÉÔºåÂÖ±Âª∫Êú™Êù•</p>
    </div>

    <script>
        // ============= ÂÖ®Â±ÄÂèòÈáèÂ£∞Êòé =============
        let currentUser = null;
        let embeddedChatOpen = false;
        let chatRightAligned = false;
        let currentLanguage = 'zh';
        let currentGeminiImages = []; // Â≠òÂÇ®ÂΩìÂâçÂä†ËΩΩÁöÑGeminiÂéüÂõæURL

        // ============= ÁôªÂΩïÂäüËÉΩ =============
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
        function checkLogin() {
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        }

        // ËßíËâ≤ÈÄâÊã©ÂàáÊç¢
        function selectRole(role) {
            // ÁßªÈô§ÊâÄÊúâÈÄâ‰∏≠Áä∂ÊÄÅ
            document.getElementById('role-exhibitor').classList.remove('selected');
            document.getElementById('role-contractor').classList.remove('selected');
            
            // Ê∑ªÂä†ÈÄâ‰∏≠Áä∂ÊÄÅ
            if (role === 'exhibitor') {
                document.getElementById('role-exhibitor').classList.add('selected');
            } else {
                document.getElementById('role-contractor').classList.add('selected');
            }
        }

        // Â§ÑÁêÜÁôªÂΩï
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.querySelector('input[name="role"]:checked').value;
            const errorDiv = document.getElementById('login-error');
            
            // È™åËØÅÁî®Êà∑ÂêçÂíåÂØÜÁ†Å
            if (username === 'Demo' && password === 'Demo_123') {
                currentUser = {
                    username: username,
                    role: role,
                    roleLabel: role === 'exhibitor' ? 'ÂèÇÂ±ïÂïÜ' : 'Â∏ÉÂ±ïÂÖ¨Âè∏',
                    roleLabelEn: role === 'exhibitor' ? 'Exhibitor' : 'Contractor',
                    loginTime: new Date().toISOString()
                };
                
                // ‰øùÂ≠òÂà∞ sessionStorage
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // ÈöêËóèÈîôËØØÊèêÁ§∫
                errorDiv.classList.remove('show');
                
                // ÊòæÁ§∫‰∏ªÂ∫îÁî®
                showMainApp();
            } else {
                // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                errorDiv.classList.add('show');
                
                // 3ÁßíÂêéËá™Âä®ÈöêËóè
                setTimeout(() => {
                    errorDiv.classList.remove('show');
                }, 3000);
            }
        }

        // ÊòæÁ§∫‰∏ªÂ∫îÁî®
        function showMainApp() {
            const loginPage = document.getElementById('login-page');
            const mainApp = document.getElementById('main-app');
            
            // ÈöêËóèÁôªÂΩïÈ°µÈù¢
            loginPage.style.display = 'none';
            
            // ÊòæÁ§∫‰∏ªÂ∫îÁî®
            mainApp.classList.add('show');
            
            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÊòæÁ§∫
            if (currentUser) {
                const userNameEl = document.getElementById('user-name');
                const userAvatarEl = document.getElementById('user-avatar');
                const roleBadgeEl = document.getElementById('role-badge');
                
                userNameEl.textContent = currentUser.username;
                userAvatarEl.textContent = currentUser.username.charAt(0).toUpperCase();
                
                // Ê†πÊçÆËßíËâ≤Êõ¥Êñ∞ÊòæÁ§∫
                if (currentUser.role === 'contractor') {
                    // Â∏ÉÂ±ïÂÖ¨Âè∏
                    userAvatarEl.style.background = 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';
                    roleBadgeEl.className = 'role-badge contractor';
                    roleBadgeEl.innerHTML = `
                        <span>üèóÔ∏è</span>
                        <span class="zh">${currentUser.roleLabel}</span>
                        <span class="en">${currentUser.roleLabelEn}</span>
                    `;
                } else {
                    // ÂèÇÂ±ïÂïÜ
                    userAvatarEl.style.background = 'linear-gradient(135deg, #27ae60 0%, #229954 100%)';
                    roleBadgeEl.className = 'role-badge';
                    roleBadgeEl.innerHTML = `
                        <span>üè¢</span>
                        <span class="zh">${currentUser.roleLabel}</span>
                        <span class="en">${currentUser.roleLabelEn}</span>
                    `;
                }
            }
        }

        // Â§ÑÁêÜÁôªÂá∫
        function handleLogout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü / Are you sure you want to logout?')) {
                // Ê∏ÖÈô§Áî®Êà∑‰ø°ÊÅØ
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                
                // ÈöêËóè‰∏ªÂ∫îÁî®
                const mainApp = document.getElementById('main-app');
                mainApp.classList.remove('show');
                
                // ÊòæÁ§∫ÁôªÂΩïÈ°µÈù¢
                const loginPage = document.getElementById('login-page');
                loginPage.style.display = 'flex';
                
                // Ê∏ÖÁ©∫ÁôªÂΩïË°®Âçï
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÊ≠•
                goToStep(1);
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
        window.addEventListener('DOMContentLoaded', function() {
            checkLogin();
        });

        // ============= ‰∏ªÂ∫îÁî®ÂäüËÉΩ =============
        // Á°Æ‰øùÈ°µÈù¢ÂèØ‰ª•ÊªöÂä®
        document.body.style.overflow = 'auto';
        document.documentElement.style.overflow = 'auto';
        let currentStep = 1;
        let selectedTemplate = null;
        let selectedTemplateName = 'ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç';
        let currentScenario = 'A';
        let customizationLogs = [];
        let artifactImages = [];

        const scenarios = {
            A: {
                name: 'ÊñπÊ°à‰∏Ä',
                effectImage: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÂØπÂ§ñÊïàÊûúÂõæ.png',
                effect: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÂØπÂ§ñÊïàÊûúÂõæ.png',
                site: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/Êê≠Âª∫ÂÆåÊØïÁé∞Âú∫ÁÖß.png',
                drawing: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊñΩÂ∑•Âõæ.png',
                logo: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊõøÊç¢Â±ïÂïÜlogoÊïàÊûúÂõæ.png',
                bomOrMaterials: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÊùêÊñôÊ∏ÖÂçï.png',
                base: 46000,
                costs: { materials: 28500, labor: 12000, logistics: 3500, design: 2000 }
            },
            B: {
                name: 'ÊñπÊ°à‰∫å',
                effectImage: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/ÂØπÂ§ñÊïàÊûúÂõæ.png',
                effect: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/ÂØπÂ§ñÊïàÊûúÂõæ.png',
                site: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/ÂÆåÂ∑•ÁÖß.png',
                drawing: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/ÊñΩÂ∑•Âõæ.png',
                logo: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/ÊõøÊç¢Â±ïÂïÜlogoÊïàÊûúÂõæ.png',
                bomOrMaterials: 'ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/BOM.png',
                base: 48000,
                costs: { materials: 30000, labor: 13000, logistics: 3800, design: 2000 }
            }
        };

        function goToStep(step) {
            // ÈöêËóèÊâÄÊúâÂÜÖÂÆπ
            for (let i = 1; i <= 4; i++) {
                const content = document.getElementById(`step-${i}-content`);
                if (content) content.classList.add('hidden');
            }
            document.getElementById('success-content').classList.add('hidden');

            // ÊòæÁ§∫ÁõÆÊ†áÊ≠•È™§
            const targetContent = document.getElementById(`step-${step}-content`);
            if (targetContent) targetContent.classList.remove('hidden');

            // Êõ¥Êñ∞ÊåáÁ§∫Âô®
            updateStepIndicator(step);
            currentStep = step;

            // Êõ¥Êñ∞ÊÇ¨ÊµÆËÅäÂ§©Èù¢ÊùøÁöÑÊ≠•È™§‰ø°ÊÅØ
            updateFloatingChatStep(step);

            // ÊªöÂä®Âà∞È°∂ÈÉ®
            window.scrollTo(0, 0);

            // ËøõÂÖ•Êä•‰ª∑Ê≠•È™§Êó∂Êõ¥Êñ∞Êä•‰ª∑‰∏éBOMÂõæÁâá
            if (step === 3) {
                updateQuote();
                updateBomImage();
            }

            // ËøõÂÖ•‰∏ãÂçïÊ≠•È™§Êó∂Êõ¥Êñ∞Á°ÆËÆ§ÂõæÁâá
            if (step === 4) {
                const img = document.getElementById('confirm-image');
                img.src = scenarios[currentScenario].site || scenarios[currentScenario].effect;
                // Êõ¥Êñ∞ËÆ¢ÂçïÊëòË¶ÅÂ±ïÁ§∫
                document.getElementById('order-template-label').textContent = selectedTemplateName;
                document.getElementById('order-total').textContent = document.getElementById('total-price').textContent;
                // Â±ïÁ§∫AIÁîüÊàêÁöÑÊàêÊûúÁâ©
                renderConfirmArtifacts();
            }
        }

        function updateStepIndicator(activeStep) {
            for (let i = 1; i <= 4; i++) {
                const stepNum = document.querySelector(`.step-item:nth-child(${i}) .step-number`);
                const stepLabel = document.querySelector(`.step-item:nth-child(${i}) .step-label`);
                
                if (i < activeStep) {
                    stepNum.classList.add('completed');
                    stepNum.classList.remove('active');
                    stepLabel.classList.remove('active');
                } else if (i === activeStep) {
                    stepNum.classList.add('active');
                    stepNum.classList.remove('completed');
                    stepLabel.classList.add('active');
                } else {
                    stepNum.classList.remove('active', 'completed');
                    stepLabel.classList.remove('active');
                }
            }
        }

        function selectTemplate(element, templateId, templateName) {
            // ÁßªÈô§ÂÖ∂‰ªñÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Ê∑ªÂä†ÈÄâ‰∏≠Áä∂ÊÄÅ
            element.classList.add('selected');
            selectedTemplate = templateId;
            selectedTemplateName = templateName;
            document.getElementById('selected-template-label').textContent = selectedTemplateName;
            // ‰æùÊçÆÊ®°ÊùøÊò†Â∞ÑÈÄâÊã©ÂØπÂ∫îÊñπÊ°àÂ∫ìÁ¥†Êùê
            const map = { T001: 'A', T002: 'B', T003: 'A' };
            currentScenario = map[templateId] || 'A';
            // Êõ¥Êñ∞Á¥†ÊùêÈ¢ÑËßà
            document.getElementById('gallery-site').src = scenarios[currentScenario].site;
            document.getElementById('gallery-drawing').src = scenarios[currentScenario].drawing;
            document.getElementById('gallery-logo').src = scenarios[currentScenario].logo;
            
            // ÊòæÁ§∫AIÂä©ÁêÜÂíåÊõ¥Êñ∞Ê£ÄÊü•È°π
            updateStep1Assistant();
        }

        function updateStep1Assistant() {
            document.getElementById('step1-ai-assistant').classList.add('show');
            const template = document.getElementById('template-size').value ? '‚úì' : '';
            const size = document.getElementById('template-size').value ? '‚úì' : '';
            const style = document.getElementById('template-style').value ? '‚úì' : '';
            
            // Êõ¥Êñ∞Ê£ÄÊü•È°π
            document.getElementById('check-template').className = selectedTemplate ? 'completed' : '';
            document.getElementById('check-size').className = size ? 'completed' : '';
            document.getElementById('check-style').className = style ? 'completed' : '';
        }

        // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºåÂú®Ë°®ÂçïÂèòÂåñÊó∂Êõ¥Êñ∞AIÂä©ÁêÜÊ£ÄÊü•È°π
        document.addEventListener('DOMContentLoaded', function() {
            const templateSizeEl = document.getElementById('template-size');
            const templateStyleEl = document.getElementById('template-style');
            if (templateSizeEl) templateSizeEl.addEventListener('change', updateStep1Assistant);
            if (templateStyleEl) templateStyleEl.addEventListener('change', updateStep1Assistant);
            
            // Âä®ÊÄÅÁîüÊàê45‰∏™Â±ï‰ΩçÂç°Áâá
            loadBoothTemplates();
        });
        
        // Âä®ÊÄÅÂä†ËΩΩÂ±ï‰ΩçÂç°Áâá
        function loadBoothTemplates() {
            const gallery = document.getElementById('template-gallery');
            if (!gallery) return;
            
            // Â±ï‰ΩçÊï∞ÊçÆÈÖçÁΩÆ
            const booths = [];
            const styles = ['nature', 'tech', 'premium', 'modern'];
            const styleNames = ['Ëá™ÁÑ∂ÁéØ‰øù', 'ÁßëÊäÄÊô∫ËÉΩ', 'È´òÁ´ØÂìÅÁâå', 'Áé∞‰ª£ÁÆÄÁ∫¶'];
            const sizes = [
                { sqm: 18, dim: '6m √ó 3m', count: 15, start: 1 },
                { sqm: 27, dim: '9m √ó 3m', count: 15, start: 16 },
                { sqm: 36, dim: '6m √ó 6m', count: 15, start: 31 }
            ];
            
            // ÁîüÊàê45‰∏™Â±ï‰ΩçÈÖçÁΩÆ
            sizes.forEach(sizeConfig => {
                for (let i = 0; i < sizeConfig.count; i++) {
                    const pageNum = sizeConfig.start + i;
                    const boothNum = pageNum;
                    const styleIndex = i % 4;
                    const reusability = 85 + (i % 8);
                    
                    booths.push({
                        id: `T${String(boothNum).padStart(3, '0')}`,
                        name: `ÁéØ‰øùÂ±ï‰ΩçÊñπÊ°à ${boothNum}`,
                        size: sizeConfig.sqm,
                        dim: sizeConfig.dim,
                        style: styles[styleIndex],
                        styleName: styleNames[styleIndex],
                        reusability: reusability,
                        image: `https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/Â±ï‰ΩçÊñπÊ°àÈõÜ/page_${String(pageNum).padStart(3, '0')}.png`
                    });
                }
            });
            
            // ‰øùÁïôÂéüÊúâÁöÑ3‰∏™Â±ï‰ΩçÔºàÊîπ‰∏∫T046-T048ÈÅøÂÖçÂÜ≤Á™ÅÔºâ
            const originalBooths = [
                {
                    id: 'T046',
                    name: 'ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç',
                    size: 18,
                    dim: '6m √ó 3m',
                    style: 'modern',
                    styleName: 'Áé∞‰ª£ÁÆÄÁ∫¶',
                    reusability: 92,
                    image: 'https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/ÂØπÂ§ñÊïàÊûúÂõæ.png'
                },
                {
                    id: 'T047',
                    name: 'ÁîüÊÄÅ‰∫íÂä®Â±ï‰Ωç',
                    size: 36,
                    dim: '6m √ó 6m',
                    style: 'nature',
                    styleName: 'Ëá™ÁÑ∂ÁéØ‰øù',
                    reusability: 88,
                    image: 'https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/ÂØπÂ§ñÊïàÊûúÂõæ.png'
                },
                {
                    id: 'T048',
                    name: 'È´òÁ´ØÂìÅÁâåÂ±ï‰Ωç',
                    size: 36,
                    dim: '6m √ó 6m',
                    style: 'premium',
                    styleName: 'È´òÁ´ØÂìÅÁâå',
                    reusability: 85,
                    image: 'https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∏Ä/Êê≠Âª∫ÂÆåÊØïÁé∞Âú∫ÁÖß.png'
                }
            ];
            
            // ÂêàÂπ∂ÊâÄÊúâÂ±ï‰ΩçÔºàPDFÁöÑ45‰∏™ + ÂéüÊúâ3‰∏™ = 48‰∏™Ôºâ
            const allBooths = [...booths, ...originalBooths];
            
            // ÁîüÊàêHTML
            allBooths.forEach(booth => {
                const card = document.createElement('div');
                card.className = 'template-card';
                card.setAttribute('data-size', booth.size);
                card.setAttribute('data-style', booth.style);
                card.onclick = function() {
                    selectTemplate(this, booth.id, booth.name);
                    openModal(booth.id);
                };
                
                card.innerHTML = `
                    <img class="template-image clickable-image" 
                         src="${booth.image}" 
                         alt="${booth.name}"
                         onclick="event.stopPropagation(); previewImage('${booth.image}', '${booth.name} - ${booth.size}„é° (${booth.dim})')">
                    <div class="template-title">${booth.name}</div>
                    <div class="template-spec">
                        <div><strong>${booth.size}„é°</strong></div>
                        <div>${booth.styleName}</div>
                    </div>
                `;
                
                gallery.appendChild(card);
            });
            
            // ÂàùÂßãÂåñÁªüËÆ°‰ø°ÊÅØ
            const totalElement = document.getElementById('total-booths');
            const displayedElement = document.getElementById('displayed-booths');
            if (totalElement) totalElement.textContent = allBooths.length;
            if (displayedElement) displayedElement.textContent = allBooths.length;
        }

        // Ê®°ÊùøÈÄâÊã©‰ºöËá™Âä®Êõ¥Êñ∞ currentScenarioÔºåÊó†ÈúÄÊòæÂºèÂàáÊç¢

        function runCompliance() {
            const resultsDiv = document.getElementById('compliance-results');
            resultsDiv.classList.remove('hidden');
            
            // Âä®ÁîªÊïàÊûú
            setTimeout(() => {
                const progressFill = resultsDiv.querySelector('.progress-fill');
                progressFill.style.width = '92%';
            }, 300);
        }

        function updateQuote() {
            const data = scenarios[currentScenario];
            document.getElementById('cost-materials').textContent = formatNumber(data.costs.materials);
            document.getElementById('cost-labor').textContent = formatNumber(data.costs.labor);
            document.getElementById('cost-logistics').textContent = formatNumber(data.costs.logistics);
            document.getElementById('cost-design').textContent = formatNumber(data.costs.design);
            const subtotal = data.costs.materials + data.costs.labor + data.costs.logistics + data.costs.design;
            document.getElementById('subtotal').textContent = formatNumber(subtotal);
            
            // Ê∑ªÂä†ÂèØÈÄâÊúçÂä°Ë¥πÁî®
            const optionalsCost = Object.values(selectedOptionals).reduce((a, b) => a + b, 0);
            document.getElementById('cost-optionals') && (document.getElementById('cost-optionals').textContent = formatNumber(optionalsCost));
            
            const basePrice = subtotal + optionalsCost;
            document.getElementById('base-price').textContent = formatNumber(basePrice);
            
            const opFee = Math.round(basePrice * 0.07);
            const techFee = Math.round(basePrice * 0.03);
            const total = basePrice + opFee + techFee;
            document.getElementById('op-fee').textContent = formatNumber(opFee);
            document.getElementById('tech-fee').textContent = formatNumber(techFee);
            document.getElementById('total-price').textContent = formatNumber(total);
            document.getElementById('order-total') && (document.getElementById('order-total').textContent = formatNumber(total));
        }

        function updateBomImage() {
            const img = document.getElementById('bom-image');
            img.src = scenarios[currentScenario].bomOrMaterials;
        }

        function toggleSection(id) {
            console.log('toggleSection called with id:', id);
            const el = document.getElementById(id);
            console.log('Found element:', el);
            if (!el) {
                console.error('Element not found:', id);
                return;
            }
            el.classList.toggle('hidden');
            console.log('After toggle, hidden?', el.classList.contains('hidden'));
            const iconId = id === 'gallery-section' ? 'gallery-toggle' : id === 'bom-image-section' ? 'bom-toggle' : id === 'confirm-image-section' ? 'confirm-toggle' : id === 'custom-section' ? 'custom-toggle' : null;
            if (iconId) {
                const icon = document.getElementById(iconId);
                if (icon) {
                    icon.classList.toggle('open');
                }
            }
        }

        function formatNumber(n) {
            return n.toLocaleString('zh-CN');
        }

        function submitOrder() {
            const agreeCheckbox = document.getElementById('agree-terms');
            if (!agreeCheckbox.checked) {
                alert('ËØ∑ÂÖàÂêåÊÑèÊúçÂä°Êù°Ê¨æÂíåÈöêÁßÅÊîøÁ≠ñ');
                return;
            }

            // ÈöêËóèËÆ¢ÂçïË°®ÂçïÔºåÊòæÁ§∫ÊàêÂäüÈ°µÈù¢
            document.getElementById('step-4-content').classList.add('hidden');
            document.getElementById('success-content').classList.remove('hidden');

            // Êõ¥Êñ∞ÊåáÁ§∫Âô®‰∏∫Â∑≤ÂÆåÊàê
            for (let i = 1; i <= 4; i++) {
                const stepNum = document.querySelector(`.step-item:nth-child(${i}) .step-number`);
                stepNum.classList.add('completed');
                stepNum.classList.remove('active');
            }

            window.scrollTo(0, 0);
        }

        function resetForm() {
            goToStep(1);
            document.getElementById('step-1-content').classList.remove('hidden');
            document.getElementById('template-size').value = '';
            document.getElementById('template-style').value = '';
            
            // ÈáçÁΩÆÊåáÁ§∫Âô®
            document.querySelectorAll('.step-number').forEach(num => {
                num.classList.remove('active', 'completed');
            });
            document.querySelectorAll('.step-label').forEach(label => {
                label.classList.remove('active');
            });
            
            // ÈáçÊñ∞ËÆæÁΩÆÁ¨¨‰∏ÄÊ≠•‰∏∫Ê¥ªË∑É
            updateStepIndicator(1);
            // ÈªòËÆ§Â±ïÁ§∫AÊñπÊ°àÂ∫ìÁ¥†Êùê
            document.getElementById('gallery-site').src = scenarios['A'].site;
            document.getElementById('gallery-drawing').src = scenarios['A'].drawing;
            document.getElementById('gallery-logo').src = scenarios['A'].logo;
        }

        // ÂàùÂßãÂåñ
        updateStepIndicator(1);
        // ÈªòËÆ§Ê®°Êùø‰∏éÁ¥†Êùê
        const selectedTemplateLabel = document.getElementById('selected-template-label');
        const templateImage1 = document.getElementById('template-image-1');
        const templateImage2 = document.getElementById('template-image-2');
        
        if (selectedTemplateLabel) selectedTemplateLabel.textContent = selectedTemplateName;
        if (templateImage1) templateImage1.src = scenarios['A'].effectImage;
        if (templateImage2) templateImage2.src = scenarios['B'].effectImage;

        /* ===== AI ‰∏™ÊÄßÂåñÈ¢ÑËßàÈÄªËæë ===== */
        const frontCanvas = document.getElementById('preview-front');
        const leftCanvas = document.getElementById('preview-left');
        const rightCanvas = document.getElementById('preview-right');
        
        // ÂàùÂßãÂåñCanvasÂ∞∫ÂØ∏
        function initCanvases() {
            [frontCanvas, leftCanvas, rightCanvas].forEach(canvas => {
                if (canvas) {
                    canvas.width = canvas.clientWidth || 300;
                    canvas.height = canvas.clientHeight || 200;
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#999';
                    ctx.font = '14px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('ÁÇπÂáª"AIÁîüÊàêÈ¢ÑËßà"Êü•ÁúãÊïàÊûú', canvas.width/2, canvas.height/2);
                }
            });
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        setTimeout(initCanvases, 500);

        /* ===== ËØ≠Ë®ÄÂàáÊç¢ ===== */
        function setLanguage(lang) {
            currentLanguage = lang;
            const isEn = lang === 'en';
            document.querySelectorAll('.zh').forEach(el => el.classList.toggle('hide', isEn));
            document.querySelectorAll('.en').forEach(el => el.classList.toggle('show', isEn));
            document.getElementById('lang-zh').classList.toggle('active', !isEn);
            document.getElementById('lang-en').classList.toggle('active', isEn);
            
            // Â¶ÇÊûúÊ®°ÊÄÅÊ°ÜÊâìÂºÄÔºåÊõ¥Êñ∞ÂÖ∂ÂÜÖÂÆπ
            if (document.getElementById('detail-modal').classList.contains('show')) {
                fillOptionalServices(isEn);
            }
            
            // Êõ¥Êñ∞ËÆ¢ÂçïÊëòË¶Å‰∏≠ÁöÑÂèØÈÄâÊúçÂä°ËØ≠Ë®Ä
            if (Object.keys(selectedOptionals).length > 0) {
                updateOrderOptionalsSummary();
            }
        }

        function loadBaseImage() {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.src = scenarios[currentScenario].effectImage;
                img.onload = () => resolve(img);
            });
        }

        function loadLogoImage() {
            return new Promise((resolve) => {
                const file = document.getElementById('logo-upload').files[0];
                if (!file) return resolve(null);
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function parsePrompt(prompt) {
            const cfg = { brightness: 1.0, saturate: 1.0, hue: 0, primary: null, position: null };
            const p = (prompt || '').toLowerCase();
            if (p.includes('Êòé‰∫Æ')) cfg.brightness = 1.15;
            if (p.includes('È≤úËâ≥') || p.includes('È•±Âíå')) cfg.saturate = 1.2;
            if (p.includes('ÁªøËâ≤')) cfg.primary = '#27ae60';
            if (p.includes('ËìùËâ≤')) cfg.primary = '#2980b9';
            if (p.includes('ÁßëÊäÄ')) cfg.hue = 20;
            if (p.includes('Ëá™ÁÑ∂')) cfg.hue = -10;
            if (p.includes('Â±Ö‰∏≠')) cfg.position = 'center';
            if (p.includes('Â∑¶‰∏ä')) cfg.position = 'top-left';
            if (p.includes('Âè≥‰∏ä')) cfg.position = 'top-right';
            if (p.includes('Â∑¶‰∏ã')) cfg.position = 'bottom-left';
            if (p.includes('Âè≥‰∏ã')) cfg.position = 'bottom-right';
            return cfg;
        }

        // Ê†πÊçÆÊèêÁ§∫ËØçÂÜÖÂÆπÂåπÈÖç‰∏çÂêåÁöÑÂú∫ÊôØÂõæÁâáÔºàÂßãÁªàËøîÂõû3Âº†ÂõæÁâáÔºâ
        function matchScenarioImages(prompt) {
            const p = (prompt || '').toLowerCase();
            
            // ‰∏âÂº†Âü∫Á°ÄÂõæÁâáÔºàÂßãÁªàÊòæÁ§∫ÊâÄÊúâ‰∏âÂº†Ôºâ
            const allImages = [
                'https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/Gemini_1.png',
                'https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/Gemini_2.png',
                'https://raw.githubusercontent.com/Raysu1008/AIGreenExhibition/main/ÁéØ‰øùÂ±ï‰ΩçÈó≠ÁéØËµÑÊñô251217/ÊñπÊ°à‰∫å/Gemini_3.png'
            ];
            
            // Ê†πÊçÆÊèêÁ§∫ËØçÂåπÈÖçÊ†áÈ¢ò
            let titles = ['Âü∫Á°ÄÊñπÊ°à', 'Êé•ÂæÖÂè∞ÊñπÊ°à', 'ÈôàÂàóÂè∞ÊñπÊ°à'];
            
            if (p.includes('Êé•ÂæÖÂè∞') && p.includes('ÈôàÂàóÂè∞')) {
                titles = ['Âü∫Á°ÄÂ±ï‰Ωç', 'Â∏¶Êé•ÂæÖÂè∞ÊïàÊûú', 'Â∏¶ÈôàÂàóÂè∞ÊïàÊûú'];
            } else if (p.includes('Êé•ÂæÖÂè∞')) {
                titles = ['ÂéüÂßãÊñπÊ°à', 'Êé•ÂæÖÂè∞ÊñπÊ°àÔºàÊé®ËçêÔºâ', 'ÂèØÈÄâÈôàÂàóÂè∞ÊñπÊ°à'];
            } else if (p.includes('ÈôàÂàóÂè∞')) {
                titles = ['ÂéüÂßãÊñπÊ°à', 'ÂèØÈÄâÊé•ÂæÖÂè∞ÊñπÊ°à', 'ÈôàÂàóÂè∞ÊñπÊ°àÔºàÊé®ËçêÔºâ'];
            } else if (p.includes('ÁÖßÊòé') || p.includes('ÁÅØÂÖâ')) {
                titles = ['Ê†áÂáÜÁÖßÊòé', 'Â¢ûÂº∫ÁÖßÊòéÊñπÊ°àA', 'Â¢ûÂº∫ÁÖßÊòéÊñπÊ°àB'];
            }
            
            console.log('AIÁîüÊàê: ÂßãÁªàËæìÂá∫3Âº†ÊïàÊûúÂõæ');
            console.log('ÂõæÁâáÊ†áÈ¢ò:', titles);
            
            // ÂßãÁªàËøîÂõûÊâÄÊúâ‰∏âÂº†ÂõæÁâá
            return {
                images: allImages,
                titles: titles
            };
        }

        // Â°´ÂÖÖÂø´Êç∑ÊèêÁ§∫ËØç
        function fillPrompt(type) {
            const prompts = {
                'Â¢ûÂä†Êé•ÂæÖÂè∞': 'Âú®‰∏çÊîπÂèòÂéüÊúâÂú∫ÊôØÁªìÊûÑÁöÑÂâçÊèê‰∏ãÔºåÊñ∞Â¢û‰∏Ä‰∏™Êé•ÂæÖÂè∞Ôºà‰Ωç‰∫éÂ±ï‰ΩçÂâç‰æßÔºå‰æø‰∫éÊé•ÂæÖËßÇ‰ºóÔºâÔºåË¶ÅÊ±ÇÔºöÈ£éÊ†º„ÄÅÊùêË¥®„ÄÅÈ¢úËâ≤‰∏éÊï¥‰ΩìÂ±ï‰ºöÁéØÂ¢ÉÁªü‰∏Ä„ÄÇ',
                'Â¢ûÂä†ÈôàÂàóÂè∞': 'Âú®‰∏çÊîπÂèòÂéüÊúâÂú∫ÊôØÁªìÊûÑÁöÑÂâçÊèê‰∏ãÔºåÊñ∞Â¢û‰∏Ä‰∏™ÈïøÊñπÂΩ¢„ÄÅ‰ΩéÁüÆÁöÑÈôàÂàóÂè∞ÔºàÈ´òÂ∫¶‰Ωé‰∫éÊé•ÂæÖÂè∞ÔºåÈÄ†ÂûãÁÆÄÊ¥ÅÔºâÔºåË¶ÅÊ±ÇÔºöÈ£éÊ†º„ÄÅÊùêË¥®„ÄÅÈ¢úËâ≤‰∏éÊï¥‰ΩìÂ±ï‰ºöÁéØÂ¢ÉÁªü‰∏Ä„ÄÇ',
                'ÂÆåÊï¥ÈÖçÁΩÆ': 'Âú®‰∏çÊîπÂèòÂéüÊúâÂú∫ÊôØÁªìÊûÑÁöÑÂâçÊèê‰∏ãÔºö\n1. Êñ∞Â¢û‰∏Ä‰∏™Êé•ÂæÖÂè∞Ôºà‰Ωç‰∫éÂ±ï‰ΩçÂâç‰æßÔºå‰æø‰∫éÊé•ÂæÖËßÇ‰ºóÔºâ\n2. Êñ∞Â¢û‰∏Ä‰∏™ÈïøÊñπÂΩ¢„ÄÅ‰ΩéÁüÆÁöÑÈôàÂàóÂè∞ÔºàÈ´òÂ∫¶‰Ωé‰∫éÊé•ÂæÖÂè∞ÔºåÈÄ†ÂûãÁÆÄÊ¥ÅÔºâ\nË¶ÅÊ±ÇÔºöÈ£éÊ†º„ÄÅÊùêË¥®„ÄÅÈ¢úËâ≤‰∏éÊï¥‰ΩìÂ±ï‰ºöÁéØÂ¢ÉÁªü‰∏Ä„ÄÇ',
                'Ë∞ÉÊï¥ÁÖßÊòé': 'ËØ∑Ê†πÊçÆÂΩìÂâçÁÖßÊòéÈÖçÁΩÆÔºàÂ∞ÑÁÅØ ' + document.getElementById('spotlight-count').value + ' ‰∏™ÔºåÁôΩÁÅØ ' + document.getElementById('whitelight-count').value + ' ‰∏™ÔºâÔºåÁîüÊàê‰ºòÂåñÂêéÁöÑÁÖßÊòéÊïàÊûúÊñπÊ°à„ÄÇ'
            };
            document.getElementById('prompt-text').value = prompts[type] || '';
        }
        
        // Ë∞ÉÊï¥ÁÖßÊòéÊï∞Èáè
        function adjustLighting(type, delta) {
            const inputId = type === 'spotlight' ? 'spotlight-count' : 'whitelight-count';
            const input = document.getElementById(inputId);
            const currentValue = parseInt(input.value) || 0;
            const newValue = Math.max(0, Math.min(12, currentValue + delta));
            input.value = newValue;
            console.log(`${type} Ë∞ÉÊï¥‰∏∫: ${newValue}`);
        }
        
        // LogoÈ¢úËâ≤ÂêåÊ≠•Âà∞ÈÖçËâ≤ÊñπÊ°à
        function syncLogoColors() {
            const file = document.getElementById('logo-upload').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    // ÂàõÂª∫‰∏¥Êó∂canvasÊèêÂèñ‰∏ªËâ≤
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    // ÁÆÄÂçïÊèêÂèñ‰∏≠ÂøÉÂå∫ÂüüÁöÑÈ¢úËâ≤‰Ωú‰∏∫‰∏ªËâ≤
                    const centerX = Math.floor(img.width / 2);
                    const centerY = Math.floor(img.height / 2);
                    const imageData = ctx.getImageData(centerX - 10, centerY - 10, 20, 20);
                    const data = imageData.data;
                    
                    // ËÆ°ÁÆóÂπ≥ÂùáÈ¢úËâ≤
                    let r = 0, g = 0, b = 0, count = 0;
                    for (let i = 0; i < data.length; i += 4) {
                        r += data[i];
                        g += data[i + 1];
                        b += data[i + 2];
                        count++;
                    }
                    r = Math.floor(r / count);
                    g = Math.floor(g / count);
                    b = Math.floor(b / count);
                    
                    // ËΩ¨Êç¢‰∏∫hexÊ†ºÂºè
                    const primaryColor = '#' + [r, g, b].map(x => {
                        const hex = x.toString(16);
                        return hex.length === 1 ? '0' + hex : hex;
                    }).join('');
                    
                    // ËÆæÁΩÆ‰∏ªËâ≤
                    document.getElementById('color-primary').value = primaryColor;
                    
                    console.log('Logo‰∏ªËâ≤Â∑≤ÊèêÂèñ:', primaryColor);
                    alert('Â∑≤Ê†πÊçÆLogoËá™Âä®ÊèêÂèñÈÖçËâ≤ÊñπÊ°àÔºÅ‰∏ªËâ≤: ' + primaryColor);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        async function applyCustomization(event) {
            console.log('üé¨ ÂºÄÂßãAIÁîüÊàêÈ¢ÑËßà...');
            
            // ÊòæÁ§∫Âä†ËΩΩÂä®Áîª
            const btnEle = event ? event.target : document.querySelector('button[onclick*="applyCustomization"]');
            if (!btnEle) {
                console.error('‚ùå Êâæ‰∏çÂà∞ÊåâÈíÆÂÖÉÁ¥†');
                return;
            }
            
            const originalText = btnEle.innerHTML;
            btnEle.disabled = true;
            btnEle.innerHTML = '<span class="loading-spinner"></span> ' + (currentLanguage === 'en' ? 'Generating...' : 'ÁîüÊàê‰∏≠...');

            try {
                // Ëé∑ÂèñÁî®Êà∑ËæìÂÖ•ÁöÑÊèêÁ§∫ËØç
                const prompt = document.getElementById('prompt-text').value;
                console.log('üìù Áî®Êà∑ÊèêÁ§∫ËØç:', prompt);

                // Ê†πÊçÆÊèêÁ§∫ËØçÂåπÈÖçÂú∫ÊôØÂõæÁâá
                const scenario = matchScenarioImages(prompt);
                const imagesToShow = scenario.images;
                const imageTitles = scenario.titles;
                
                // ‰øùÂ≠òÂà∞ÂÖ®Â±ÄÂèòÈáèÔºå‰æõÈ¢ÑËßàÂàáÊç¢‰ΩøÁî®
                currentGeminiImages = imagesToShow;

                console.log('üñºÔ∏è Â∞ÜÊòæÁ§∫ÂõæÁâáÊï∞Èáè:', imagesToShow.length);
                console.log('üè∑Ô∏è ÂõæÁâáÊ†áÈ¢ò:', imageTitles);

                const canvases = [frontCanvas, leftCanvas, rightCanvas];
                console.log('üé® CanvasÂÖÉÁ¥†:', canvases.map(c => c ? 'OK' : 'NULL'));

                // Âú® canvas ‰∏äÊòæÁ§∫ÊâÄÊúâ‰∏âÂº†ÂõæÁâá
                for (let idx = 0; idx < canvases.length; idx++) {
                    const canvas = canvases[idx];
                    if (!canvas) {
                        console.error(`‚ùå Canvas ${idx} ‰∏çÂ≠òÂú®`);
                        continue;
                    }
                    
                    const ctx = canvas.getContext('2d');
                    const w = canvas.width = canvas.clientWidth || 300;
                    const h = canvas.height = canvas.clientHeight || 200;
                    ctx.clearRect(0, 0, w, h);
                    
                    console.log(`üìê Canvas ${idx} Â∞∫ÂØ∏: ${w}x${h}`);

                    // ÂßãÁªàÊòæÁ§∫‰∏âÂº†ÂõæÁâá
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    await new Promise((resolve) => {
                        img.onload = () => {
                            console.log(`‚úÖ ÂõæÁâá ${idx} Âä†ËΩΩÊàêÂäü:`, imagesToShow[idx]);
                            // ËÆ°ÁÆóÈÄÇÈÖçÂ∞∫ÂØ∏
                            const scale = Math.min(w / img.width, h / img.height);
                            const dw = img.width * scale;
                            const dh = img.height * scale;
                            const x = (w - dw) / 2;
                            const y = (h - dh) / 2;
                            
                            // ÁªòÂà∂ÂõæÁâá
                            ctx.drawImage(img, x, y, dw, dh);
                            
                            // Ê∑ªÂä†Ê†áÈ¢ò
                            ctx.fillStyle = '#7c3aed';
                            ctx.font = 'bold 14px sans-serif';
                            ctx.textAlign = 'center';
                            ctx.globalAlpha = 0.9;
                            const title = imageTitles[idx] || `ÊñπÊ°à${idx + 1}`;
                            ctx.fillText(title, w/2, 25);
                            ctx.globalAlpha = 1.0;
                            
                            resolve();
                        };
                        img.onerror = (e) => {
                            console.error(`‚ùå ÂõæÁâá ${idx} Âä†ËΩΩÂ§±Ë¥•:`, imagesToShow[idx], e);
                            // ÊòæÁ§∫Âç†‰ΩçÁ¨¶
                            ctx.fillStyle = '#f8f9fa';
                            ctx.fillRect(0, 0, w, h);
                            ctx.fillStyle = '#7f8c8d';
                            ctx.font = '14px sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•', w/2, h/2 - 10);
                            ctx.fillText('ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', w/2, h/2 + 10);
                            resolve();
                        };
                        
                        console.log(`üîÑ ÂºÄÂßãÂä†ËΩΩÂõæÁâá ${idx}:`, imagesToShow[idx]);
                        img.src = imagesToShow[idx];
                    });
                }

                // ÊòæÁ§∫Á¨¨‰∏ÄÂº†ÂõæÁâá‰Ωú‰∏∫‰∏ªÊïàÊûúÂõæ
                const aiOutputImg = document.getElementById('ai-output-image');
                if (aiOutputImg && imagesToShow.length > 0) {
                    aiOutputImg.src = imagesToShow[0];
                    console.log('üéØ ËÆæÁΩÆ‰∏ªÊïàÊûúÂõæ:', imagesToShow[0]);
                    
                    const aiOutputSection = document.getElementById('ai-output-section');
                    if (aiOutputSection) {
                        aiOutputSection.style.display = 'block';
                        console.log('‚úÖ ÊòæÁ§∫AIËæìÂá∫Âå∫Âüü');
                        // ÊªöÂä®Âà∞AIËæìÂá∫Âå∫Âüü
                        setTimeout(() => {
                            aiOutputSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                } else {
                    console.error('‚ùå AIËæìÂá∫ÂõæÁâáÂÖÉÁ¥†‰∏çÂ≠òÂú®ÊàñÂõæÁâáÂàóË°®‰∏∫Á©∫');
                }
                
                console.log('üéâ AIÁîüÊàêÈ¢ÑËßàÂÆåÊàêÔºÅ');
                
                // ÂàùÂßãÂåñCanvasÁÇπÂáªÂàáÊç¢ÂäüËÉΩ
                setupCanvasPreviewSwitch();
                
            } catch (error) {
                console.error('‚ùå AIÁîüÊàêÈ¢ÑËßàÂá∫Èîô:', error);
                alert('ÁîüÊàêÈ¢ÑËßàÊó∂Âá∫ÈîôÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞Êó•Âøó');
            }

            // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
            setTimeout(() => {
                btnEle.disabled = false;
                btnEle.innerHTML = originalText;
                console.log('üîÑ ÊåâÈíÆÁä∂ÊÄÅÂ∑≤ÊÅ¢Â§ç');
            }, 1500);
            
            // log customization
            try {
                const primary = document.getElementById('color-primary').value;
                const secondary = document.getElementById('color-secondary').value;
                const userPrompt = document.getElementById('prompt-text').value;
                const spotlightCount = document.getElementById('spotlight-count').value;
                const whitelightCount = document.getElementById('whitelight-count').value;
                const materialGrade = document.getElementById('material-grade').value;
                
                customizationLogs.push({
                    time: new Date().toISOString(),
                    template: selectedTemplateName,
                    scenario: currentScenario,
                    colors: { primary, secondary },
                    logo: !!document.getElementById('logo-upload').files[0],
                    lighting: { spotlight: spotlightCount, whitelight: whitelightCount },
                    material: materialGrade,
                    prompt: userPrompt
                });
            } catch (logError) {
                console.error('Êó•ÂøóËÆ∞ÂΩïÂ§±Ë¥•:', logError);
            }
        }

        function saveSnapshot() {
            const snaps = [frontCanvas, leftCanvas, rightCanvas].map(c => c.toDataURL('image/png'));
            const titles = ['Ê≠£Èù¢È¢ÑËßà', 'Â∑¶ÂâçËßíÈ¢ÑËßà', 'Âè≥ÂâçËßíÈ¢ÑËßà'];
            snaps.forEach((dataUrl, idx) => artifactImages.push({ title: titles[idx], url: dataUrl }));
            renderArtifacts();
        }
        
        /* ===== CanvasÈ¢ÑËßàÂàáÊç¢ÂäüËÉΩ ===== */
        function setupCanvasPreviewSwitch() {
            const canvases = [frontCanvas, leftCanvas, rightCanvas];
            const previewCards = document.querySelectorAll('.preview-card');
            const aiOutputImage = document.getElementById('ai-output-image');
            const aiOutputSection = document.getElementById('ai-output-section');
            
            // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™
            if (previewCards.length > 0) {
                previewCards[0].classList.add('active');
            }
            
            canvases.forEach((canvas, index) => {
                if (!canvas) return;
                
                canvas.addEventListener('click', function() {
                    console.log(`üñºÔ∏è ÂàáÊç¢Âà∞È¢ÑËßà ${index + 1}`);
                    
                    // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
                    previewCards.forEach(card => card.classList.remove('active'));
                    
                    // Ê∑ªÂä†activeÁ±ªÂà∞ÂΩìÂâçÂç°Áâá
                    if (previewCards[index]) {
                        previewCards[index].classList.add('active');
                    }
                    
                    // ‰ΩøÁî®ÂéüÂßãÈ´òÊ∏ÖGeminiÂõæÁâáËÄå‰∏çÊòØCanvasÁöÑtoDataURL
                    try {
                        // ‰ºòÂÖà‰ΩøÁî®ÂÖ®Â±Ä‰øùÂ≠òÁöÑGeminiÂõæÁâáURLÔºàÈ´òÊ∏ÖÂéüÂõæÔºâ
                        const imageUrl = currentGeminiImages[index];
                        
                        if (aiOutputImage && imageUrl) {
                            aiOutputImage.src = imageUrl;
                            console.log('‚úÖ È¢ÑËßàÂõæÁâáÂ∑≤ÂàáÊç¢Âà∞È´òÊ∏ÖÂéüÂõæ:', imageUrl);
                            
                            // ÊòæÁ§∫AIËæìÂá∫Âå∫ÂüüÔºàÂ¶ÇÊûúËøòÊú™ÊòæÁ§∫Ôºâ
                            if (aiOutputSection) {
                                aiOutputSection.style.display = 'block';
                            }
                        } else {
                            // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî®CanvasÁöÑtoDataURL
                            console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞ÂéüÂõæURLÔºå‰ΩøÁî®CanvasÂØºÂá∫ÔºàÂèØËÉΩÊ∏ÖÊô∞Â∫¶ËæÉ‰ΩéÔºâ');
                            const dataUrl = canvas.toDataURL('image/png');
                            if (aiOutputImage && dataUrl) {
                                aiOutputImage.src = dataUrl;
                            }
                        }
                    } catch (error) {
                        console.error('‚ùå ÂàáÊç¢È¢ÑËßàÂõæÁâáÂ§±Ë¥•:', error);
                    }
                });
                
                // Ê∑ªÂä†ËßÜËßâÊèêÁ§∫
                canvas.style.cursor = 'pointer';
                canvas.title = 'ÁÇπÂáªÊü•ÁúãÂ§ßÂõæ';
            });
            
            console.log('‚úÖ CanvasÈ¢ÑËßàÂàáÊç¢ÂäüËÉΩÂ∑≤ÂàùÂßãÂåñ');
            console.log('üì∏ Â∑≤Âä†ËΩΩ', currentGeminiImages.length, 'Âº†È´òÊ∏ÖÂéüÂõæURL');
        }
        
        // Ê®°ÊùøÁ≠õÈÄâÂäüËÉΩ
        function filterTemplates() {
            const sizeFilter = document.getElementById('template-size').value;
            const styleFilter = document.getElementById('template-style').value;
            const cards = document.querySelectorAll('#template-gallery .template-card');
            
            let visibleCount = 0;
            
            cards.forEach(card => {
                const cardSize = card.getAttribute('data-size');
                const cardStyle = card.getAttribute('data-style');
                
                const sizeMatch = !sizeFilter || cardSize === sizeFilter;
                const styleMatch = !styleFilter || cardStyle === styleFilter;
                
                if (sizeMatch && styleMatch) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            const displayedElement = document.getElementById('displayed-booths');
            if (displayedElement) {
                displayedElement.textContent = visibleCount;
            }
            
            console.log(`Á≠õÈÄâÁªìÊûú: ${visibleCount} ‰∏™ÊñπÊ°àÁ¨¶ÂêàÊù°‰ª∂`);
            
            // Â¶ÇÊûúÊ≤°ÊúâÂåπÈÖçÁöÑÁªìÊûúÔºåÊòæÁ§∫ÊèêÁ§∫
            const gallery = document.getElementById('template-gallery');
            let noResultMsg = gallery.querySelector('.no-results-message');
            
            if (visibleCount === 0) {
                if (!noResultMsg) {
                    noResultMsg = document.createElement('div');
                    noResultMsg.className = 'no-results-message';
                    noResultMsg.style.cssText = 'grid-column: 1/-1; text-align: center; padding: 40px; color: #999;';
                    noResultMsg.innerHTML = '<i class="bi bi-search" style="font-size: 48px; display: block; margin-bottom: 16px;"></i><p>ÊöÇÊó†Á¨¶ÂêàÊù°‰ª∂ÁöÑÊñπÊ°àÔºåËØ∑Ë∞ÉÊï¥Á≠õÈÄâÊù°‰ª∂</p>';
                    gallery.appendChild(noResultMsg);
                }
                noResultMsg.style.display = 'block';
            } else if (noResultMsg) {
                noResultMsg.style.display = 'none';
            }
        }

        function renderArtifacts() {
            const list = document.getElementById('artifact-list');
            if (!list) return;
            list.innerHTML = artifactImages.map(a => `
                <div class="artifact-item">
                    <img src="${a.url}" alt="${a.title}">
                    <div style="font-size:12px; color:#7f8c8d; margin-top:4px;">${a.title}</div>
                </div>
            `).join('');
        }

        function renderConfirmArtifacts() {
            const list = document.getElementById('confirm-artifacts-list');
            if (!list) return;
            list.innerHTML = artifactImages.map(a => `
                <div class="artifact-item">
                    <img src="${a.url}" alt="${a.title}">
                    <div style="font-size:12px; color:#7f8c8d; margin-top:4px;">${a.title}</div>
                </div>
            `).join('');
        }

        function exportAdjustments() {
            const blob = new Blob([JSON.stringify({ logs: customizationLogs, artifacts: artifactImages }, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `customization_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Ê®°ÊÄÅÂØπËØùÊ°ÜÂäüËÉΩ
        const templateDetails = {
            T001: {
                name_zh: 'ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç',
                name_en: 'Simple Green Booth',
                description_zh: 'ÈááÁî®ÁéØ‰øùÈìùÂêàÈáëÊ°ÜÊû∂ÔºåËÆæËÆ°ÁÆÄÊ¥ÅÁé∞‰ª£ÔºåÈÄÇÂêà‰∏≠Â∞è‰ºÅ‰∏öÂ±ïÁ§∫Ê†∏ÂøÉ‰∫ßÂìÅ„ÄÇ',
                description_en: 'Features eco-friendly aluminum frame with clean modern design, ideal for small to medium enterprises to showcase core products.',
                specs_zh: ['Â∞∫ÂØ∏: 6m √ó 3m (18„é°)', 'ÊùêÊñô: ÈìùÂêàÈáëÊ°ÜÊû∂', 'ÂèØÂ§çÁî®Áéá: 92%', 'Âª∫ËÆæÂë®Êúü: 3-4Â§©'],
                specs_en: ['Size: 6m √ó 3m (18„é°)', 'Material: Aluminum frame', 'Reusability: 92%', 'Construction: 3-4 days'],
                basePrice: 18000
            },
            T002: {
                name_zh: 'ÁîüÊÄÅ‰∫íÂä®Â±ï‰Ωç',
                name_en: 'Eco-Interactive Booth',
                description_zh: 'ËûçÂêàÊú®Ë¥®Ê°ÜÊû∂ÂíåÁîüÊÄÅÂÖÉÁ¥†ÔºåÂàõÈÄ†Ê≤âÊµ∏Âºè‰ΩìÈ™åÔºåÈÄÇÂêàÂ±ïÁ§∫ÁéØ‰øùÁêÜÂøµÂíå‰∫ßÂìÅ‰∫íÂä®„ÄÇ',
                description_en: 'Combines wooden frame with ecological elements to create immersive experience, perfect for showcasing environmental concepts and interactive products.',
                specs_zh: ['Â∞∫ÂØ∏: 6m √ó 6m (36„é°)', 'ÊùêÊñô: Êú®Ë¥®Ê°ÜÊû∂', 'ÂèØÂ§çÁî®Áéá: 88%', 'Âª∫ËÆæÂë®Êúü: 4-5Â§©'],
                specs_en: ['Size: 6m √ó 6m (36„é°)', 'Material: Wood frame', 'Reusability: 88%', 'Construction: 4-5 days'],
                basePrice: 32000
            },
            T003: {
                name_zh: 'È´òÁ´ØÂìÅÁâåÂ±ï‰Ωç',
                name_en: 'Premium Brand Booth',
                description_zh: 'ÁªìÂêàÈìùÂêàÈáë‰∏éÊú®Ë¥®ÊùêÊñôÔºåËÆæËÆ°È´òÁ´ØÂ§ßÊ∞îÔºåÈÄÇÂêàÂìÅÁâåÂΩ¢Ë±°Â±ïÁ§∫ÂíåÈ´òÁ´ØÊ¥ΩË∞à„ÄÇ',
                description_en: 'Combines aluminum and wood materials with premium elegant design, ideal for brand image display and executive meetings.',
                specs_zh: ['Â∞∫ÂØ∏: 6m √ó 6m (36„é°)', 'ÊùêÊñô: ÈìùÂêàÈáë+Êú®Ë¥®', 'ÂèØÂ§çÁî®Áéá: 85%', 'Âª∫ËÆæÂë®Êúü: 5-6Â§©'],
                specs_en: ['Size: 6m √ó 6m (36„é°)', 'Material: Aluminum + Wood', 'Reusability: 85%', 'Construction: 5-6 days'],
                basePrice: 42000
            }
        };

        const optionalServices = {
            colors: [
                { id: 'c1', name_zh: 'Ê†áÂáÜÁªøËâ≤', name_en: 'Standard Green', price: 0, icon: 'üé®' },
                { id: 'c2', name_zh: 'Ê∑±Ëìù‰∏ªÈ¢ò', name_en: 'Deep Blue Theme', price: 2000, icon: 'üé®' },
                { id: 'c3', name_zh: 'ÂúüËâ≤Á≥ª', name_en: 'Earth Tones', price: 1500, icon: 'üé®' },
                { id: 'c4', name_zh: 'Áé∞‰ª£ÈªëÁôΩ', name_en: 'Modern B&W', price: 2500, icon: 'üé®' }
            ],
            lighting: [
                { id: 'l1', name_zh: 'Âü∫Á°ÄÁÖßÊòé', name_en: 'Basic Lighting', price: 0, icon: 'üí°' },
                { id: 'l2', name_zh: 'Âº∫ÂåñLEDÁÖßÊòé', name_en: 'Enhanced LED', price: 5000, icon: 'üí°' },
                { id: 'l3', name_zh: 'Âä®ÊÄÅÁÅØÂÖâÊïàÊûú', name_en: 'Dynamic Effects', price: 8000, icon: 'üí°' }
            ],
            materials: [
                { id: 'm1', name_zh: 'Ê†áÂáÜÊùêÊñô', name_en: 'Standard Materials', price: 0, icon: 'üì¶' },
                { id: 'm2', name_zh: 'Èò≤Ê∞¥ÂçáÁ∫ß', name_en: 'Waterproof Upgrade', price: 3000, icon: 'üì¶' },
                { id: 'm3', name_zh: 'Èò≤ÁÅ´ËÆ§ËØÅÊùêÊñô', name_en: 'Fire-Rated Materials', price: 4000, icon: 'üì¶' }
            ],
            services: [
                { id: 's1', name_zh: 'Ê†áÂáÜÂÆâË£Ö', name_en: 'Standard Setup', price: 0, icon: 'üë∑' },
                { id: 's2', name_zh: '24Â∞èÊó∂Âú®Á∫øÊîØÊåÅ', name_en: '24/7 Support', price: 2000, icon: 'üë∑' },
                { id: 's3', name_zh: '‰∏ì‰∏öËÆæËÆ°Âí®ËØ¢', name_en: 'Design Consultation', price: 3000, icon: 'üë∑' },
                { id: 's4', name_zh: 'Â±ï‰ΩçÊ∏ÖÊ¥ÅÊúçÂä°', name_en: 'Cleaning Service', price: 1500, icon: 'üë∑' }
            ]
        };

        let selectedOptionals = {};

        function openModal(templateId) {
            console.log('openModal called with templateId:', templateId);
            selectedOptionals = {}; // ÈáçÁΩÆÈÄâÊã©
            const modal = document.getElementById('detail-modal');
            console.log('Found modal element:', modal);
            
            const template = templateDetails[templateId];
            console.log('Found template:', template);
            
            if (!modal) {
                console.error('Modal element not found!');
                return;
            }
            
            if (!template) {
                console.error('Template not found for ID:', templateId);
                return;
            }
            
            const isEn = currentLanguage === 'en';

            // ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊ†áÈ¢òÂíåÊèèËø∞
            document.getElementById('modal-template-name').textContent = isEn ? template.name_en : template.name_zh;
            document.getElementById('modal-template-desc').textContent = isEn ? template.description_en : template.description_zh;

            // ËÆæÁΩÆËßÑÊ†º
            const specsList = document.getElementById('modal-specs-list');
            specsList.innerHTML = (isEn ? template.specs_en : template.specs_zh).map(spec => 
                `<li style="padding: 6px 0; color: #555;">‚úì ${spec}</li>`
            ).join('');

            // Â°´ÂÖÖÂèØÈÄâÊúçÂä°
            fillOptionalServices(isEn);

            // Êõ¥Êñ∞Âü∫Á°Ä‰ª∑Ê†º
            document.getElementById('modal-base-price').textContent = '¬•' + formatNumber(template.basePrice);
            updateModalTotalPrice();

            console.log('About to show modal');
            modal.classList.add('show');
            console.log('Modal classes after show:', modal.classList.toString());
        }

        function closeModal() {
            const modal = document.getElementById('detail-modal');
            modal.classList.remove('show');
        }

        function fillOptionalServices(isEn) {
            const categoriesOrder = ['colors', 'lighting', 'materials', 'services'];
            const categoryLabels = isEn 
                ? { colors: 'Color Schemes', lighting: 'Lighting Options', materials: 'Materials', services: 'Additional Services' }
                : { colors: 'ÈÖçËâ≤ÊñπÊ°à', lighting: 'ÁÖßÊòéÊñπÊ°à', materials: 'ÊùêÊñôÈÄâÈ°π', services: 'Â¢ûÂÄºÊúçÂä°' };

            const optionalsContainer = document.getElementById('modal-optionals');
            optionalsContainer.innerHTML = '';

            categoriesOrder.forEach(category => {
                const section = document.createElement('div');
                section.className = 'modal-section';

                const title = document.createElement('div');
                title.className = 'modal-section-title';
                title.innerHTML = `<i class="bi bi-${getCategoryIcon(category)}"></i> <span>${categoryLabels[category]}</span>`;

                const grid = document.createElement('div');
                grid.className = 'optional-grid';

                optionalServices[category].forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'optional-card';
                    card.id = `optional-${item.id}`;
                    card.innerHTML = `
                        <div class="optional-card-icon">${item.icon}</div>
                        <div class="optional-card-name">${isEn ? item.name_en : item.name_zh}</div>
                        ${item.price > 0 ? `<div class="optional-card-price">+¬•${formatNumber(item.price)}</div>` : '<div class="optional-card-price">ÂÖçË¥π / Free</div>'}
                    `;
                    card.onclick = (e) => {
                        e.stopPropagation();
                        toggleOptional(item.id, category, item.price);
                    };
                    grid.appendChild(card);
                });

                section.appendChild(title);
                section.appendChild(grid);
                optionalsContainer.appendChild(section);
            });
        }

        function getCategoryIcon(category) {
            const icons = {
                colors: 'palette',
                lighting: 'brightness-high',
                materials: 'box2',
                services: 'people-fill'
            };
            return icons[category] || 'gear';
        }

        function toggleOptional(itemId, category, price) {
            const cardId = `optional-${itemId}`;
            const card = document.getElementById(cardId);
            
            // ÂØπ‰∫éÈÖçËâ≤„ÄÅÁÖßÊòéÁ≠âÂçïÈÄâÈ°πÔºåÁßªÈô§ÂêåÂàÜÁ±ªÁöÑÂÖ∂‰ªñÈÄâÊã©
            if (['colors', 'lighting', 'materials'].includes(category)) {
                document.querySelectorAll(`#modal-optionals .optional-card.selected`).forEach(c => {
                    const cId = c.id.replace('optional-', '');
                    // Âè™ÁßªÈô§ÂêåÂàÜÁ±ªÁöÑ
                    if (optionalServices[category].some(item => item.id === cId)) {
                        c.classList.remove('selected');
                        delete selectedOptionals[cId];
                    }
                });
            }

            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                delete selectedOptionals[itemId];
            } else {
                card.classList.add('selected');
                selectedOptionals[itemId] = price;
            }

            updateModalTotalPrice();
        }

        function updateModalTotalPrice() {
            const basePrice = templateDetails[selectedTemplate]?.basePrice || 0;
            const optionalsCost = Object.values(selectedOptionals).reduce((a, b) => a + b, 0);
            const total = basePrice + optionalsCost;
            document.getElementById('modal-optionals-cost').textContent = formatNumber(optionalsCost);
            document.getElementById('modal-total-price').textContent = formatNumber(total);
        }

        function confirmModalSelection() {
            // ‰øùÂ≠òÈÄâÊã©Âà∞ÂÖ®Â±ÄÊï∞ÊçÆ‰∏≠ÔºåÂπ∂ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            customizationLogs.push({
                timestamp: new Date().toISOString(),
                action: 'ÈÄâÊã©ÂèØÈÄâÊúçÂä°',
                template: selectedTemplateName,
                optionals: Object.keys(selectedOptionals),
                cost: Object.values(selectedOptionals).reduce((a, b) => a + b, 0)
            });
            
            // Êõ¥Êñ∞ËÆ¢ÂçïÊëòË¶Å‰∏≠ÁöÑÂèØÈÄâÊúçÂä°ÊòæÁ§∫
            updateOrderOptionalsSummary();
            
            closeModal();
            // Êõ¥Êñ∞Êä•‰ª∑
            updateQuote();
        }

        function updateOrderOptionalsSummary() {
            const summaryDiv = document.getElementById('order-optionals-summary');
            const listDiv = document.getElementById('order-optionals-list');
            
            if (Object.keys(selectedOptionals).length === 0) {
                summaryDiv.style.display = 'none';
                return;
            }
            
            summaryDiv.style.display = 'block';
            const isEn = currentLanguage === 'en';
            const items = [];
            
            // Êî∂ÈõÜÊâÄÊúâÈÄâÊã©ÁöÑÈ°πÁõÆÂêçÁß∞
            Object.keys(selectedOptionals).forEach(itemId => {
                for (let category of Object.keys(optionalServices)) {
                    const item = optionalServices[category].find(i => i.id === itemId);
                    if (item) {
                        items.push({
                            name: isEn ? item.name_en : item.name_zh,
                            price: item.price
                        });
                        break;
                    }
                }
            });
            
            // Êõ¥Êñ∞ÂàóË°®ÊòæÁ§∫
            listDiv.innerHTML = items.map(item => 
                `<li style="color: #2c3e50; padding: 6px 0; border-bottom: 1px solid rgba(39,174,96,0.2);">
                    ‚úì ${item.name}${item.price > 0 ? ` <span style="float: right; color: #27ae60; font-weight: 600;">+¬•${formatNumber(item.price)}</span>` : ''}
                </li>`
            ).join('');
        }

        // ÁõëÂê¨ËØ≠Ë®ÄÂàáÊç¢Âπ∂Êõ¥Êñ∞Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπ
        window.addEventListener('languageChanged', function() {
            if (document.getElementById('detail-modal').classList.contains('show')) {
                fillOptionalServices(currentLanguage === 'en');
            }
        });

        // ====== AI ËÅäÂ§©ÂäüËÉΩ ======
        
        // AI ÂìçÂ∫îÊï∞ÊçÆÂ∫ìÔºà‰∏≠Ëã±ÊñáÂèåËØ≠Ôºâ
        const aiResponses = {
            step1: {
                keywords: {
                    'Ê®°Êùø': { zh: 'Êàë‰ª¨Êèê‰æõ3ÁßçÂ±ï‰ΩçÊ®°ÊùøÔºö\n\nüì¶ Âü∫Á°ÄÁâà - ÈÄÇÂêàÈ¢ÑÁÆóÊúâÈôêÁöÑ‰ºÅ‰∏öÔºå‰ª∑Ê†º¬•28,000-¬•36,000\n‚≠ê Ê†áÂáÜÁâà - ÊúÄÂèóÊ¨¢ËøéÁöÑÈÄâÊã©ÔºåÂèØÂ§çÁî®Áéá70%Ôºå‰ª∑Ê†º¬•38,000-¬•46,000\nüíé È´òÁ∫ßÁâà - ÂìÅÁâåÂΩ¢Ë±°Â±ïÁ§∫ÔºåÂèØÂ§çÁî®Áéá90%Ôºå‰ª∑Ê†º¬•58,000-¬•72,000\n\nÊÇ®ÂèØ‰ª•Ê†πÊçÆÈ¢ÑÁÆóÂíåÂìÅÁâåÂÆö‰ΩçÈÄâÊã©„ÄÇ', en: 'We offer 3 booth templates:\n\nüì¶ Basic - For budget-conscious companies, ¬•28,000-¬•36,000\n‚≠ê Standard - Most popular, 70% reusability, ¬•38,000-¬•46,000\nüíé Premium - Brand showcase, 90% reusability, ¬•58,000-¬•72,000' },
                    'Â∞∫ÂØ∏': { zh: 'Â±ï‰ΩçÂ∞∫ÂØ∏Âª∫ËÆÆÔºö\n\n‚Ä¢ 3m√ó3m (9„é°) - ÈÄÇÂêàÂàùÂàõ‰ºÅ‰∏ö\n‚Ä¢ 3m√ó4m (12„é°) - Â∞èÂûã‰ºÅ‰∏öÊ†áÈÖç\n‚Ä¢ 3m√ó6m (18„é°) - ‰∏≠Âûã‰ºÅ‰∏öÊé®Ëçê\n‚Ä¢ 6m√ó6m (36„é°) - Â§ßÂûã‰ºÅ‰∏öÂ±ïÁ§∫\n\nÂ∞∫ÂØ∏Ë∂äÂ§ßÔºåÂ±ïÁ§∫Á©∫Èó¥Ë∂äÂÖÖË∂≥Ôºå‰ΩÜÊàêÊú¨‰πüÁõ∏Â∫îÂ¢ûÂä†„ÄÇ', en: 'Booth size recommendations:\n\n‚Ä¢ 3m√ó3m (9„é°) - Startups\n‚Ä¢ 3m√ó4m (12„é°) - Small businesses\n‚Ä¢ 3m√ó6m (18„é°) - Mid-sized companies\n‚Ä¢ 6m√ó6m (36„é°) - Large enterprises' },
                    'ÂèØÂ§çÁî®': { zh: 'ÂèØÂ§çÁî®ÁéáÊòØÊåáÂ±ï‰ΩçÊê≠Âª∫ÊùêÊñôÂú®Â±ï‰ºöÁªìÊùüÂêéÂèØ‰ª•ÂÜçÊ¨°‰ΩøÁî®ÁöÑÊØî‰æã„ÄÇ\n\nüîÑ È´òÂèØÂ§çÁî®ÁéáÁöÑ‰ºòÂäøÔºö\n‚Ä¢ Èôç‰ΩéÈïøÊúüÊàêÊú¨\n‚Ä¢ ÁéØ‰øùÂèØÊåÅÁª≠\n‚Ä¢ Á¨¶ÂêàÂπø‰∫§‰ºöÁªøËâ≤ÁêÜÂøµ\n‚Ä¢ ‰∏ãÊ¨°ÂèÇÂ±ïÂèØÁõ¥Êé•Â§çÁî®\n\nÊàë‰ª¨ÁöÑÊ†áÂáÜÁâàÂèØÂ§çÁî®ÁéáËææ70%ÔºåÈ´òÁ∫ßÁâàÊõ¥È´òËææ90%ÔºÅ', en: 'Reusability rate refers to the percentage of booth materials that can be reused after the fair.\n\nüîÑ Benefits:\n‚Ä¢ Lower long-term costs\n‚Ä¢ Eco-friendly\n‚Ä¢ Aligns with Canton Fair green initiative\n‚Ä¢ Direct reuse for next exhibitions' },
                    'AI': { zh: 'ÂΩìÂâçAIÈ¢ÑËßàÂäüËÉΩÂèØ‰ª•‰∏∫ÊÇ®ÁîüÊàêÂ§öËßíÂ∫¶ÁöÑÂ±ï‰ΩçÊïàÊûúÂõæÔºÅ\n\nüé® ÂäüËÉΩÁâπÁÇπÔºö\n‚Ä¢ 3DËßÜËßíÊïàÊûúÈ¢ÑËßà\n‚Ä¢ ‰∏çÂêåÊùêË¥®Ê®°Êãü\n‚Ä¢ ÁÅØÂÖâÊïàÊûúÂ±ïÁ§∫\n‚Ä¢ ÂÆûÈôÖÊ°à‰æãÂèÇËÄÉ\n\nÁÇπÂáª"AIÁîüÊàêÈ¢ÑËßà"ÊåâÈíÆÂç≥ÂèØÊü•ÁúãÊÇ®ÈÄâÊã©ÁöÑÊ®°ÊùøÁöÑÂÆûÈôÖÊïàÊûúÔºÅ', en: 'Current AI preview can generate multi-angle booth renderings!\n\nüé® Features:\n‚Ä¢ 3D perspective views\n‚Ä¢ Material simulation\n‚Ä¢ Lighting effects\n‚Ä¢ Real case references\n\nClick "AI Preview" to see the actual effect!' },
                    '‰ª∑Ê†º': { zh: '‰∏çÂêåÂ∞∫ÂØ∏ÁöÑ‰ª∑Ê†ºÂ∑ÆÂºÇÔºö\n\nÊ†áÂáÜÁâà‰∏∫‰æãÔºö\n‚Ä¢ 3m√ó3m ‚Üí ¬•38,000\n‚Ä¢ 3m√ó4m ‚Üí ¬•42,000\n‚Ä¢ 3m√ó6m ‚Üí ¬•46,000\n‚Ä¢ 6m√ó6m ‚Üí ¬•68,000\n\n‰ª∑Ê†ºÂåÖÂê´ÔºöËÆæËÆ°„ÄÅÊùêÊñô„ÄÅÊê≠Âª∫„ÄÅÊãÜÂç∏„ÄÅÊ∏ÖËøê„ÄÇËøêËê•ÊúçÂä°Ë¥π7%ÔºåÂπ≥Âè∞ÊäÄÊúØË¥π3%Âè¶ËÆ°„ÄÇ', en: 'Price differences by size (Standard):\n\n‚Ä¢ 3m√ó3m ‚Üí ¬•38,000\n‚Ä¢ 3m√ó4m ‚Üí ¬•42,000\n‚Ä¢ 3m√ó6m ‚Üí ¬•46,000\n‚Ä¢ 6m√ó6m ‚Üí ¬•68,000\n\nIncludes: design, materials, installation, removal. Plus 7% operation fee and 3% platform fee.' }
                },
                default: { zh: 'ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÁêÜÔºå‰∏ìÈó®Â∏ÆÂä©ÊÇ®ÈÄâÊã©ÂêàÈÄÇÁöÑÂ±ï‰ΩçÊ®°Êùø„ÄÇ\n\nü§î ÊàëÂèØ‰ª•Â∏ÆÊÇ®Ôºö\n‚Ä¢ ‰∫ÜËß£‰∏çÂêåÊ®°ÊùøÁöÑÁâπÁÇπ\n‚Ä¢ ÊØîËæÉ‰ª∑Ê†ºÂíåÊÄß‰ª∑ÊØî\n‚Ä¢ ÈÄâÊã©ÂêàÈÄÇÁöÑÂ∞∫ÂØ∏\n‚Ä¢ Ëß£ÈáäÂèØÂ§çÁî®ÁéáÁöÑÊÑè‰πâ\n\nËØ∑ÈöèÊó∂ÂêëÊàëÊèêÈóÆÔºÅ', en: 'Hello! I\'m the AI assistant helping you choose the right booth template.\n\nü§î I can help with:\n‚Ä¢ Understanding template features\n‚Ä¢ Comparing prices and value\n‚Ä¢ Selecting the right size\n‚Ä¢ Explaining reusability\n\nFeel free to ask!' }
            },
            step2: {
                keywords: {
                    'ÂêàËßÑ': { zh: 'Âπø‰∫§‰ºöÂØπÂ±ï‰ΩçÊúâ‰∏•Ê†ºÁöÑÂêàËßÑË¶ÅÊ±ÇÔºö\n\n‚úÖ ÂøÖÈ°ªÈÄöËøáÁöÑÊ£ÄÊü•Ôºö\n‚Ä¢ Â∞∫ÂØ∏Á¨¶ÂêàÂ±ï‰ΩçËßÑÊ†º\n‚Ä¢ ÊùêÊñôËææÂà∞ÁéØ‰øùÊ†áÂáÜ\n‚Ä¢ Ê∂àÈò≤ÂÆâÂÖ®ÂêàËßÑ\n‚Ä¢ ÁªìÊûÑÁ®≥ÂÆöÊÄßËææÊ†á\n\nÂ¶ÇÊûúÊüêÈ°π‰∏çÈÄöËøáÔºåÊàë‰ºöÊèê‰æõÂÖ∑‰ΩìÁöÑ‰øÆÊîπÂª∫ËÆÆÔºåÂ∏ÆÊÇ®Âø´ÈÄüËß£ÂÜ≥ÈóÆÈ¢òÔºÅ', en: 'Canton Fair has strict compliance requirements:\n\n‚úÖ Mandatory checks:\n‚Ä¢ Size meets specifications\n‚Ä¢ Materials meet environmental standards\n‚Ä¢ Fire safety compliance\n‚Ä¢ Structural stability\n\nIf any item fails, I\'ll provide specific modification suggestions!' },
                    'Ê∂àÈò≤': { zh: 'Ê∂àÈò≤ÂÆâÂÖ®Ë¶ÅÊ±ÇÂåÖÊã¨Ôºö\n\nüî• ÂÖ≥ÈîÆÊ†áÂáÜÔºö\n‚Ä¢ ÁñèÊï£ÈÄöÈÅìÂÆΩÂ∫¶ ‚â• 1.2m\n‚Ä¢ ‰ΩøÁî®Èò≤ÁÅ´ÊùêÊñô\n‚Ä¢ Â∫îÊÄ•Âá∫Âè£Ê†áËØÜÊ∏ÖÊô∞\n‚Ä¢ ÁÅ≠ÁÅ´Âô®ÈÖçÁΩÆÂêàËßÑ\n‚Ä¢ ÁîµÊ∞îÁ∫øË∑ØÁ¨¶ÂêàËßÑËåÉ\n\nÊàë‰ª¨ÁöÑÊ†áÂáÜÊ®°ÊùøÂ∑≤ÂÖÖÂàÜËÄÉËôëËøô‰∫õË¶ÅÊ±ÇÔºåÈÄöËøáÁéáÈ´òËææ95%ÔºÅ', en: 'Fire safety requirements:\n\nüî• Key standards:\n‚Ä¢ Evacuation aisle ‚â• 1.2m\n‚Ä¢ Fire-resistant materials\n‚Ä¢ Clear emergency exit signs\n‚Ä¢ Fire extinguisher compliant\n‚Ä¢ Electrical wiring standards\n\nOur standard templates achieve 95% pass rate!' },
                    'ÊùêÊñô': { zh: 'ÁéØ‰øùÊùêÊñôËÆ§ËØÅË¶ÅÊ±ÇÔºö\n\n‚ôªÔ∏è ÂøÖÈ°ªËææÂà∞ÁöÑÊ†áÂáÜÔºö\n‚Ä¢ Áî≤ÈÜõÈáäÊîæÈáè ‚â§ E1Á∫ß\n‚Ä¢ VOCÂê´ÈáèÁ¨¶ÂêàÂõΩÊ†á\n‚Ä¢ ÂèØÂõûÊî∂ÊùêÊñô‰ºòÂÖà\n‚Ä¢ Ëé∑ÂæóÁªøËâ≤Âª∫ÊùêËÆ§ËØÅ\n\nÊàë‰ª¨ÊâÄÊúâÊ®°ÊùøÈÉΩ‰ΩøÁî®ÁªèËøáËÆ§ËØÅÁöÑÁéØ‰øùÊùêÊñôÔºå100%Á¨¶ÂêàÂπø‰∫§‰ºöÊ†áÂáÜÔºÅ', en: 'Environmental material certification:\n\n‚ôªÔ∏è Required standards:\n‚Ä¢ Formaldehyde ‚â§ E1 grade\n‚Ä¢ VOC meets national standards\n‚Ä¢ Recyclable materials preferred\n‚Ä¢ Green building material certified\n\nAll our templates use certified eco-friendly materials, 100% compliant!' },
                    'ÁñèÊï£': { zh: 'ÁñèÊï£ÈÄöÈÅìÊ†áÂáÜÔºö\n\nüö∂ ÈáçË¶ÅËßÑËåÉÔºö\n‚Ä¢ ‰∏ªÈÄöÈÅìÂÆΩÂ∫¶ ‚â• 1.2m\n‚Ä¢ Ê¨°ÈÄöÈÅìÂÆΩÂ∫¶ ‚â• 0.9m\n‚Ä¢ ÈÄöÈÅì‰∏çÂæóÂ†ÜÊîæÁâ©ÂìÅ\n‚Ä¢ ‰øùÊåÅÁïÖÈÄöÊó†Èòª\n‚Ä¢ ÊòéÁ°ÆÊ†áËØÜÂá∫Âè£ÊñπÂêë\n\nÂ¶ÇÊûúÂΩìÂâçÊñπÊ°àÈÄöÈÅìËøáÁ™ÑÔºåÊàëÂèØ‰ª•Âª∫ËÆÆË∞ÉÊï¥Â±ïÂìÅÂ∏ÉÁΩÆ‰ΩçÁΩÆ„ÄÇ', en: 'Evacuation aisle standards:\n\nüö∂ Key regulations:\n‚Ä¢ Main aisle ‚â• 1.2m\n‚Ä¢ Secondary aisle ‚â• 0.9m\n‚Ä¢ No obstructions\n‚Ä¢ Keep clear at all times\n‚Ä¢ Clear exit signage\n\nIf your current design is too narrow, I can suggest layout adjustments.' }
                },
                default: { zh: 'ÊàëÊ≠£Âú®‰∏∫ÊÇ®ËøõË°åÂ±ï‰ΩçÂêàËßÑÊ£ÄÊü•„ÄÇ\n\nüõ°Ô∏è ÂêàËßÑÊ†°È™åÂåÖÊã¨Ôºö\n‚Ä¢ Â∞∫ÂØ∏ËßÑÊ†ºÊ£ÄÊü•\n‚Ä¢ ÊùêÊñôÁéØ‰øùËÆ§ËØÅ\n‚Ä¢ Ê∂àÈò≤ÂÆâÂÖ®Ê†áÂáÜ\n‚Ä¢ ÁªìÊûÑÁ®≥ÂÆöÊÄßËØÑ‰º∞\n\nÂ¶ÇÊúâ‰ªª‰ΩïÈóÆÈ¢òÔºåËØ∑ÈöèÊó∂ËØ¢ÈóÆÔºÅ', en: 'I\'m conducting compliance checks for your booth.\n\nüõ°Ô∏è Checks include:\n‚Ä¢ Size specifications\n‚Ä¢ Material certifications\n‚Ä¢ Fire safety standards\n‚Ä¢ Structural stability\n\nFeel free to ask anything!' }
            },
            step3: {
                keywords: {
                    'ÊúçÂä°Ë¥π': { zh: 'Êä•‰ª∑ÂåÖÂê´‰∏§È°πÊúçÂä°Ë¥πÔºö\n\nüíº ËøêËê•ÊúçÂä°Ë¥π (7%)Ôºö\n‚Ä¢ ‰∏ì‰∏öÂõ¢ÈòüÁé∞Âú∫ÁÆ°ÁêÜ\n‚Ä¢ Êê≠Âª∫Ë¥®ÈáèÁõëÁù£\n‚Ä¢ ÈóÆÈ¢òÂ∫îÊÄ•Â§ÑÁêÜ\n‚Ä¢ Â±ïÊúüÁª¥Êä§ÊúçÂä°\n\n‚öôÔ∏è Âπ≥Âè∞ÊäÄÊúØË¥π (3%)Ôºö\n‚Ä¢ Âú®Á∫øËá™Âä©Á≥ªÁªüÁª¥Êä§\n‚Ä¢ AIËÆæËÆ°Â∑•ÂÖ∑ÊîØÊåÅ\n‚Ä¢ ËÆ¢ÂçïÁÆ°ÁêÜÁ≥ªÁªü\n‚Ä¢ ÂÆ¢Êà∑ÊúçÂä°Âπ≥Âè∞\n\nËøô‰∫õË¥πÁî®Á°Æ‰øùÊÇ®Ëé∑ÂæóÂÖ®Êñπ‰ΩçÁöÑ‰∏ì‰∏öÊúçÂä°ÔºÅ', en: 'The quote includes two service fees:\n\nüíº Operation Fee (7%):\n‚Ä¢ Professional on-site management\n‚Ä¢ Quality supervision\n‚Ä¢ Emergency handling\n‚Ä¢ Maintenance during exhibition\n\n‚öôÔ∏è Platform Fee (3%):\n‚Ä¢ Self-service system maintenance\n‚Ä¢ AI design tool support\n‚Ä¢ Order management\n‚Ä¢ Customer service platform' },
                    'Â¢ûÂÄº': { zh: 'ÊàëÊé®Ëçê‰ª•‰∏ãÂ¢ûÂÄºÊúçÂä°ÈÄâÈ°πÔºö\n\nüìã ËÆæËÆ°Âí®ËØ¢Á±ªÔºö\n‚Ä¢ Âπ≥Èù¢ËÆæËÆ°Âí®ËØ¢ÊúçÂä° (+¬•1,500) - ‰∏ì‰∏öËÆæËÆ°Â∏àÊåáÂØº\n‚Ä¢ Â±ï‰ΩçÂ∏ÉÂ±Ä‰ºòÂåñÂª∫ËÆÆ (+¬•800) - ÊèêÂçáÁ©∫Èó¥Âà©Áî®Áéá\n\nüßπ Áé∞Âú∫ÊúçÂä°Á±ªÔºö\n‚Ä¢ Â±ï‰ΩçÊ∏ÖÊ¥ÅÊúçÂä° (+¬•600/Â§©) - ‰øùÊåÅÂ±ï‰ΩçÊï¥Ê¥Å\n‚Ä¢ Â±ï‰ΩçÊùÇËΩØÊúçÂä° (+¬•400/Â§©) - Áé∞Âú∫Áª¥Êä§ÊîØÊåÅ\n\nüì∏ ‰∏ì‰∏öÊëÑÂΩ±Á±ªÔºö\n‚Ä¢ Â±ï‰ΩçÊëÑÂΩ±ÊúçÂä° (+¬•1,200) - ‰∏ì‰∏öÊëÑÂΩ±Â∏àÊãçÊëÑ\n‚Ä¢ Â±ï‰ΩçÊëÑÂÉèÊúçÂä° (+¬•1,800) - È´òÊ∏ÖËßÜÈ¢ëËÆ∞ÂΩï\n\nÊ†πÊçÆÊÇ®ÁöÑÈ¢ÑÁÆóÂíåÈúÄÊ±ÇÔºåÁÅµÊ¥ªÈÄâÊã©ÂêàÈÄÇÁöÑÊúçÂä°ÔºÅ', en: 'Recommended add-on services:\n\nüìã Design consulting:\n‚Ä¢ Graphic design consultation (+¬•1,500)\n‚Ä¢ Layout optimization (+¬•800)\n\nüßπ On-site services:\n‚Ä¢ Cleaning service (+¬•600/day)\n‚Ä¢ Maintenance support (+¬•400/day)\n\nüì∏ Professional photography:\n‚Ä¢ Photography service (+¬•1,200)\n‚Ä¢ Video recording (+¬•1,800)\n\nFlexible selection based on your needs!' },
                    '‰ºòÊÉ†': { zh: 'ÂΩìÂâç‰ºòÊÉ†ÊîøÁ≠ñÔºö\n\nüéÅ ‰ºòÊÉ†ÊñπÂºèÔºö\n‚Ä¢ Êó©È∏ü‰ºòÊÉ†ÔºöÊèêÂâç30Â§©È¢ÑËÆ¢‰∫´95Êäò\n‚Ä¢ ËÄÅÂÆ¢Êà∑ÔºöËøîÂ±ïÂÆ¢Êà∑‰∫´9Êäò\n‚Ä¢ Â§ßÂçï‰ºòÊÉ†Ôºö3‰∏™‰ª•‰∏äÂ±ï‰Ωç‰∫´È¢ùÂ§ñÊäòÊâ£\n‚Ä¢ Êé®ËçêÂ•ñÂä±ÔºöÊé®ËçêÊñ∞ÂÆ¢Êà∑Ëé∑¬•500‰ª£ÈáëÂà∏\n\nÊÇ®ÁõÆÂâçÂèØ‰∫´ÂèóÁöÑ‰ºòÊÉ†ÔºåÊàë‰ºöÂú®ËÆ¢ÂçïÁ°ÆËÆ§Êó∂Ëá™Âä®ËÆ°ÁÆóÔºÅ', en: 'Current promotional offers:\n\nüéÅ Discounts:\n‚Ä¢ Early bird: 5% off for 30-day advance booking\n‚Ä¢ Returning customers: 10% off\n‚Ä¢ Bulk orders: Extra discount for 3+ booths\n‚Ä¢ Referral reward: ¬•500 voucher\n\nEligible discounts will be automatically calculated!' },
                    'ÊàêÊú¨': { zh: 'Èôç‰ΩéÊàêÊú¨ÁöÑÂª∫ËÆÆÔºö\n\nüí° ÁúÅÈí±Á≠ñÁï•Ôºö\n‚Ä¢ ÈÄâÊã©Ê†áÂáÜÁâàËÄåÈùûÈ´òÁ∫ßÁâà\n‚Ä¢ ÈÄâÊã©ËæÉÂ∞èÂ∞∫ÂØ∏ÔºàÂ¶Ç3√ó4mËÄåÈùû3√ó6mÔºâ\n‚Ä¢ ÂáèÂ∞ëÂèØÈÄâÂ¢ûÂÄºÊúçÂä°\n‚Ä¢ ÊèêÈ´òÂèØÂ§çÁî®ÁéáÔºåÈôç‰ΩéÈïøÊúüÊàêÊú¨\n‚Ä¢ ÂèÇÂä†Êó©È∏ü‰ºòÊÉ†Ê¥ªÂä®\n\n‰ΩÜË¶ÅÊ≥®ÊÑèÂπ≥Ë°°ÊàêÊú¨ÂíåÂ±ïÁ§∫ÊïàÊûúÔºåÁ°Æ‰øùËææÂà∞Ëê•ÈîÄÁõÆÊ†áÔºÅ', en: 'Cost reduction suggestions:\n\nüí° Money-saving strategies:\n‚Ä¢ Choose Standard instead of Premium\n‚Ä¢ Select smaller size (3√ó4m vs 3√ó6m)\n‚Ä¢ Reduce optional add-ons\n‚Ä¢ Higher reusability = lower long-term costs\n‚Ä¢ Early bird discounts\n\nBalance cost with exhibition effectiveness!' }
                },
                default: { zh: 'ÊàëÂ∑≤‰∏∫ÊÇ®ÁîüÊàêËØ¶ÁªÜÁöÑÊä•‰ª∑ÂàÜÊûê„ÄÇ\n\nüí∞ Êä•‰ª∑ÂåÖÊã¨Ôºö\n‚Ä¢ Âü∫Á°ÄÊùêÊñôÂíå‰∫∫Â∑•ÊàêÊú¨\n‚Ä¢ ËøêËê•ÊúçÂä°Ë¥π (7%)\n‚Ä¢ Âπ≥Âè∞ÊäÄÊúØË¥π (3%)\n‚Ä¢ ÂèØÈÄâÂ¢ûÂÄºÊúçÂä°\n\nÊúâ‰ªª‰Ωï‰ª∑Ê†ºÈóÆÈ¢òÔºåËØ∑ÈöèÊó∂ÈóÆÊàëÔºÅ', en: 'I\'ve generated a detailed price quote.\n\nüí∞ Includes:\n‚Ä¢ Base materials and labor\n‚Ä¢ Operation fee (7%)\n‚Ä¢ Platform fee (3%)\n‚Ä¢ Optional add-ons\n\nAsk me any pricing questions!' }
            },
            step4: {
                keywords: {
                    'ÊîØ‰ªò': { zh: 'Êàë‰ª¨ÊîØÊåÅÂ§öÁßçÊîØ‰ªòÊñπÂºèÔºö\n\nüí≥ ÂèØÈÄâÊîØ‰ªòÔºö\n‚Ä¢ ÂæÆ‰ø°ÊîØ‰ªò - Âç≥Êó∂Âà∞Ë¥¶\n‚Ä¢ ÊîØ‰ªòÂÆù - ‰æøÊç∑ÂÆâÂÖ®\n‚Ä¢ Èì∂Ë°åËΩ¨Ë¥¶ - ÈÄÇÂêàÂ§ßÈ¢ùÊîØ‰ªò\n‚Ä¢ ÂºÄÁ•®ÂêéÊîØ‰ªò - ‰ºÅ‰∏öÂÆ¢Êà∑‰ºòÈÄâ\n\nÂª∫ËÆÆÈÄâÊã©ÊúÄÊñπ‰æøÁöÑÊîØ‰ªòÊñπÂºèÔºåÊâÄÊúâÊñπÂºèÂùáÂÆâÂÖ®ÂèØÈù†ÔºÅ', en: 'We support multiple payment methods:\n\nüí≥ Options:\n‚Ä¢ WeChat Pay - Instant\n‚Ä¢ Alipay - Convenient & secure\n‚Ä¢ Bank transfer - For large amounts\n‚Ä¢ Invoice payment - Preferred by enterprises\n\nAll methods are secure and reliable!' },
                    '‰∫§‰ªò': { zh: 'ËÆ¢ÂçïÁ°ÆËÆ§ÂêéÁöÑ‰∫§‰ªòÊµÅÁ®ãÔºö\n\nüìÖ ÂÆåÊï¥Êó∂Èó¥Á∫øÔºö\n‚Ä¢ ËÆ¢ÂçïÁ°ÆËÆ§Âêé24Â∞èÊó∂ÂÜÖËÅîÁ≥ªÊÇ®\n‚Ä¢ 3-5Â§©ÂÆåÊàêËÆæËÆ°‰ºòÂåñ\n‚Ä¢ Áîü‰∫ßÂë®ÊúüÁ∫¶10-15Â§©\n‚Ä¢ Â±ï‰ºöÂâç7Â§©ÂÆåÊàêÊê≠Âª∫\n‚Ä¢ Â±ï‰ºöÁªìÊùüÂêé2Â§©ÂÜÖÂÆåÊàêÊãÜÂç∏\n\nÊï¥‰∏™ÊµÅÁ®ãÊàë‰ª¨‰ºö‰øùÊåÅÂØÜÂàáÊ≤üÈÄöÔºåÁ°Æ‰øùÊåâÊó∂‰∫§‰ªòÔºÅ', en: 'Delivery process after order confirmation:\n\nüìÖ Complete timeline:\n‚Ä¢ Contact within 24 hours\n‚Ä¢ Design optimization in 3-5 days\n‚Ä¢ Production takes 10-15 days\n‚Ä¢ Installation 7 days before fair\n‚Ä¢ Removal within 2 days after fair\n\nClose communication throughout!' },
                    '‰øÆÊîπ': { zh: 'ËÆ¢Âçï‰øÆÊîπÊîøÁ≠ñÔºö\n\nüìù ÂèØ‰øÆÊîπÈò∂ÊÆµÔºö\n‚Ä¢ ËÆ¢ÂçïÁ°ÆËÆ§Âêé24Â∞èÊó∂ÂÜÖ - ÂÖçË¥π‰øÆÊîπ\n‚Ä¢ ËÆæËÆ°Èò∂ÊÆµ - ÂèØË∞ÉÊï¥ÁªÜËäÇ\n‚Ä¢ Áîü‰∫ßÂâç - ÂÖÅËÆ∏ÈáçÂ§ßË∞ÉÊï¥\n‚Ä¢ Áîü‰∫ßÂêé - ‰ªÖÈôêÂ∞èÂπÖ‰øÆÊîπ\n\nÂª∫ËÆÆÂú®ËÆæËÆ°Èò∂ÊÆµÁ°ÆËÆ§ÊâÄÊúâÁªÜËäÇÔºåÈÅøÂÖçÂêéÊúüË∞ÉÊï¥ÂΩ±Âìç‰∫§‰ªòÊó∂Èó¥„ÄÇ', en: 'Order modification policy:\n\nüìù Modifiable stages:\n‚Ä¢ Within 24 hours - Free modifications\n‚Ä¢ Design stage - Detail adjustments allowed\n‚Ä¢ Before production - Major changes possible\n‚Ä¢ After production - Minor changes only\n\nConfirm all details during design stage!' },
                    'ÂîÆÂêé': { zh: 'Êàë‰ª¨Êèê‰æõÂÖ®Êñπ‰ΩçÂîÆÂêéÊúçÂä°Ôºö\n\nüõ†Ô∏è ÂîÆÂêé‰øùÈöúÔºö\n‚Ä¢ Â±ïÊúüÁé∞Âú∫ÊîØÊåÅÂõ¢Èòü\n‚Ä¢ 24Â∞èÊó∂Â∫îÊÄ•ÁÉ≠Á∫ø\n‚Ä¢ ÂÖçË¥πÁª¥‰øÆÊúçÂä°\n‚Ä¢ Â±ïÂìÅË∞ÉÊï¥ÂçèÂä©\n‚Ä¢ ÊãÜÂç∏Ê∏ÖËøê‰øùÈöú\n\nÂ¶ÇÈÅá‰ªª‰ΩïÈóÆÈ¢òÔºåÊàë‰ª¨1Â∞èÊó∂ÂÜÖÂìçÂ∫îÔºåÁ°Æ‰øùÂ±ï‰ºöÈ°∫Âà©ËøõË°åÔºÅ', en: 'Comprehensive after-sales service:\n\nüõ†Ô∏è Support:\n‚Ä¢ On-site support team during exhibition\n‚Ä¢ 24-hour emergency hotline\n‚Ä¢ Free repair service\n‚Ä¢ Display adjustment assistance\n‚Ä¢ Removal guarantee\n\n1-hour response time for any issues!' }
                },
                default: { zh: 'ÊÇ®Â∑≤ÂÆåÊàêÊâÄÊúâÈÖçÁΩÆÊ≠•È™§ÔºÅ\n\n‚úÖ ÊúÄÂêéÁ°ÆËÆ§Ôºö\n‚Ä¢ Â°´ÂÜôÂÆåÊï¥ÁöÑ‰ºÅ‰∏ö‰ø°ÊÅØ\n‚Ä¢ ÈÄâÊã©ÊîØ‰ªòÊñπÂºè\n‚Ä¢ ÂêåÊÑèÊúçÂä°Êù°Ê¨æ\n‚Ä¢ Êèê‰∫§ËÆ¢Âçï\n\nÊúâ‰ªª‰ΩïÊúÄÂêéÁöÑÈóÆÈ¢òÔºåËØ∑ÈöèÊó∂ÈóÆÊàëÔºÅ', en: 'You\'ve completed all configuration steps!\n\n‚úÖ Final confirmation:\n‚Ä¢ Complete company information\n‚Ä¢ Select payment method\n‚Ä¢ Agree to terms\n‚Ä¢ Submit order\n\nAny final questions, ask me!' }
            }
        };

        // ÂàáÊç¢AIËÅäÂ§©ÁïåÈù¢
        function toggleAIChat(stepId) {
            const chatDiv = document.getElementById(stepId + '-chat');
            const inputDiv = document.getElementById(stepId + '-input');
            const quickDiv = document.getElementById(stepId + '-quick');
            const summaryDiv = document.getElementById(stepId + '-summary');
            
            // ÂÆâÂÖ®Ê£ÄÊü•ÔºöÁ°Æ‰øùÂÖÉÁ¥†Â≠òÂú®
            if (!chatDiv || !inputDiv || !quickDiv) {
                console.error('AI Chat ÂÖÉÁ¥†Êú™ÊâæÂà∞:', stepId);
                return;
            }
            
            if (chatDiv.style.display === 'none' || chatDiv.style.display === '') {
                // ÊòæÁ§∫ËÅäÂ§©ÁïåÈù¢
                chatDiv.style.display = 'block';
                inputDiv.style.display = 'flex';
                quickDiv.style.display = 'flex';
                if (summaryDiv) summaryDiv.style.display = 'none';
                
                // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÊâìÂºÄÔºåÊ∑ªÂä†Ê¨¢ËøéÊ∂àÊÅØ
                const messagesDiv = document.getElementById(stepId + '-messages');
                if (messagesDiv && messagesDiv.children.length === 0) {
                    const welcomeMsg = getWelcomeMessage(stepId);
                    addAIMessage(stepId, welcomeMsg, false);
                }
                
                // ÊªöÂä®Âà∞Â∫ïÈÉ®
                setTimeout(() => {
                    if (chatDiv) chatDiv.scrollTop = chatDiv.scrollHeight;
                }, 100);
            } else {
                // ÈöêËóèËÅäÂ§©ÁïåÈù¢
                chatDiv.style.display = 'none';
                inputDiv.style.display = 'none';
                quickDiv.style.display = 'none';
                summaryDiv.style.display = 'block';
            }
        }

        // Ëé∑ÂèñÊ¨¢ËøéÊ∂àÊÅØ
        function getWelcomeMessage(stepId) {
            const isEn = currentLanguage === 'en';
            const responses = aiResponses[stepId];
            return responses.default[isEn ? 'en' : 'zh'];
        }

        // ÂèëÈÄÅAIÊ∂àÊÅØ
        function sendAIMessage(stepId) {
            const inputField = document.getElementById(stepId + '-input-field');
            const message = inputField.value.trim();
            
            if (!message) return;
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addUserMessage(stepId, message);
            
            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            inputField.value = '';
            
            // ÊòæÁ§∫ËæìÂÖ•ÊåáÁ§∫Âô®
            const typingDiv = document.getElementById(stepId + '-typing');
            typingDiv.style.display = 'block';
            
            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            const chatDiv = document.getElementById(stepId + '-chat');
            chatDiv.scrollTop = chatDiv.scrollHeight;
            
            // Ê®°ÊãüAIÊÄùËÄÉÔºå1.5ÁßíÂêéÂõûÂ§ç
            setTimeout(() => {
                typingDiv.style.display = 'none';
                const response = getAIResponse(stepId, message);
                addAIMessage(stepId, response, true);
                chatDiv.scrollTop = chatDiv.scrollHeight;
            }, 1500);
        }

        // Âø´Êç∑Ê∂àÊÅØ
        function sendQuickMessage(stepId, message) {
            const inputField = document.getElementById(stepId + '-input-field');
            inputField.value = message;
            sendAIMessage(stepId);
        }

        // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
        function addUserMessage(stepId, message) {
            const messagesDiv = document.getElementById(stepId + '-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message user';
            messageDiv.innerHTML = `
                <div class="ai-message-avatar">üë§</div>
                <div class="ai-message-content">${message}</div>
            `;
            messagesDiv.appendChild(messageDiv);
        }

        // Ê∑ªÂä†AIÊ∂àÊÅØ
        function addAIMessage(stepId, message, animate) {
            const messagesDiv = document.getElementById(stepId + '-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message assistant' + (animate ? ' fade-in-up' : '');
            messageDiv.innerHTML = `
                <div class="ai-message-avatar">ü§ñ</div>
                <div class="ai-message-content">${message.replace(/\n/g, '<br>')}</div>
            `;
            messagesDiv.appendChild(messageDiv);
        }

        // Ëé∑ÂèñAIÂìçÂ∫î
        function getAIResponse(stepId, userMessage) {
            const isEn = currentLanguage === 'en';
            const responses = aiResponses[stepId];
            
            // ÂÖ≥ÈîÆËØçÂåπÈÖç
            for (const keyword in responses.keywords) {
                if (userMessage.includes(keyword) || userMessage.toLowerCase().includes(keyword.toLowerCase())) {
                    return responses.keywords[keyword][isEn ? 'en' : 'zh'];
                }
            }
            
            // ÈªòËÆ§ÂìçÂ∫î
            return responses.default[isEn ? 'en' : 'zh'];
        }

        // ÊîØÊåÅÂõûËΩ¶ÈîÆÂèëÈÄÅ
        document.addEventListener('DOMContentLoaded', function() {
            ['step1', 'step2', 'step3', 'step4'].forEach(stepId => {
            // Á°Æ‰øùÊªöÂä®ÂßãÁªàÂèØÁî®
            document.body.style.overflow = 'auto';
            document.documentElement.style.overflow = 'auto';
                const inputField = document.getElementById(stepId + '-input-field');
                if (inputField) {
                    inputField.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            sendAIMessage(stepId);
                        }
                    });
                }
            });
        });

        // ====== ÂõæÁâáÊîæÂ§ßÈ¢ÑËßàÂäüËÉΩ ======
        
        let current3DRotation = 0; // ÂΩìÂâç3DÊóãËΩ¨ËßíÂ∫¶
        let autoRotateInterval = null; // Ëá™Âä®ÊóãËΩ¨ÂÆöÊó∂Âô®
        let currentTemplateId = null; // ÂΩìÂâçÂ±ï‰ΩçID
        
        function previewImage(imageSrc, caption) {
            const modal = document.getElementById('image-preview-modal');
            const modalImg = document.getElementById('preview-image');
            const captionText = document.getElementById('preview-caption');
            
            modal.classList.add('show');
            modalImg.src = imageSrc;
            captionText.textContent = caption || '';
            
            // ‰ªécaption‰∏≠ÊèêÂèñÂ±ï‰ΩçID (‰æãÂ¶Ç: "T001")
            if (caption) {
                const match = caption.match(/T\d{3}/);
                if (match) {
                    currentTemplateId = match[0];
                    console.log('üì∏ ÂΩìÂâçÂ±ï‰Ωç:', currentTemplateId);
                }
            }
            
            // Èò≤Ê≠¢ËÉåÊôØÊªöÂä®
            document.body.style.overflow = 'hidden';
            
            // ÈáçÁΩÆ3DËßÜÂõæ
            toggle3DView(false);
        }
        
        function closeImagePreview() {
            const modal = document.getElementById('image-preview-modal');
            modal.classList.remove('show');
            
            // ÂÅúÊ≠¢Ëá™Âä®ÊóãËΩ¨
            stopAutoRotate();
            
            // ÊÅ¢Â§çËÉåÊôØÊªöÂä®
            document.body.style.overflow = 'auto';
            
            // ÈáçÁΩÆÂΩìÂâçÂ±ï‰ΩçID
            currentTemplateId = null;
        }
        
        // ====== 3DËßÜÂõæÂäüËÉΩ ======
        
        function toggle3DView(show) {
            const view2D = document.getElementById('preview-2d-view');
            const view3D = document.getElementById('preview-3d-container');
            
            if (show) {
                // ÊòæÁ§∫3DËßÜÂõæ
                view2D.style.display = 'none';
                view3D.classList.add('active');
                
                // Âä†ËΩΩ3‰∏™ËßÜËßíÁöÑÂõæÁâá
                load3DImages();
                
                // ÈáçÁΩÆÊóãËΩ¨ËßíÂ∫¶
                current3DRotation = 0;
                updateCardRotation();
                updateControlButtons();
                
                console.log('üé® Â∑≤ÂàáÊç¢Âà∞3DËßÜÂõæ');
            } else {
                // ÊòæÁ§∫2DËßÜÂõæ
                view2D.style.display = 'block';
                view3D.classList.remove('active');
                
                // ÂÅúÊ≠¢Ëá™Âä®ÊóãËΩ¨
                stopAutoRotate();
                
                console.log('üñºÔ∏è Â∑≤ÂàáÊç¢Âà∞2DËßÜÂõæ');
            }
        }
        
        function load3DImages() {
            // Ëé∑ÂèñÂΩìÂâç2DÂõæÁâáÁöÑË∑ØÂæÑ
            const currentImage = document.getElementById('preview-image').src;
            
            // Â¶ÇÊûúÊòØÂ±ï‰ΩçÊ®°ÊùøÂõæÁâáÔºåÂ∞ùËØïÂä†ËΩΩÂØπÂ∫îÁöÑ3‰∏™ËßÜËßí
            if (currentTemplateId) {
                const basePath = currentImage.substring(0, currentImage.lastIndexOf('/') + 1);
                
                // ÂÅáËÆæÂõæÁâáÂëΩÂêçËßÑÂàôÔºö
                // page_XXX.png (Ê≠£Èù¢)
                // Â¶ÇÊûúÊ≤°Êúâ‰∏ìÈó®ÁöÑ3ËßÜËßíÂõæÔºå‰ΩøÁî®Âêå‰∏ÄÂº†ÂõæÁâá
                document.getElementById('preview-3d-front').src = currentImage;
                document.getElementById('preview-3d-left').src = currentImage;
                document.getElementById('preview-3d-right').src = currentImage;
                
                console.log('üì∏ Â∑≤Âä†ËΩΩ3DËßÜËßíÂõæÁâá');
            } else {
                // ‰ΩøÁî®ÂΩìÂâçÂõæÁâá‰Ωú‰∏∫ÊâÄÊúâËßÜËßí
                document.getElementById('preview-3d-front').src = currentImage;
                document.getElementById('preview-3d-left').src = currentImage;
                document.getElementById('preview-3d-right').src = currentImage;
            }
        }
        
        function rotate3DCard(viewIndex) {
            // ÂÅúÊ≠¢Ëá™Âä®ÊóãËΩ¨
            stopAutoRotate();
            
            // ËÆæÁΩÆÊóãËΩ¨ËßíÂ∫¶
            // 0: Ê≠£Èù¢ (0¬∞)
            // 1: Â∑¶ËßÜËßí (120¬∞)
            // 2: Âè≥ËßÜËßí (-120¬∞)
            const angles = [0, 120, -120];
            current3DRotation = angles[viewIndex];
            
            updateCardRotation();
            updateControlButtons();
            
            console.log(`üîÑ ÊóãËΩ¨Âà∞ËßÜËßí ${viewIndex}: ${current3DRotation}¬∞`);
        }
        
        function updateCardRotation() {
            const card = document.getElementById('preview-3d-card');
            card.style.transform = `rotateY(${current3DRotation}deg)`;
        }
        
        function updateControlButtons() {
            const buttons = document.querySelectorAll('.preview-3d-control-btn');
            buttons.forEach((btn, index) => {
                if (index < 3) { // Âè™Â§ÑÁêÜÂâç3‰∏™ÊåâÈíÆÔºàÊ≠£Èù¢/Â∑¶/Âè≥Ôºâ
                    const angles = [0, 120, -120];
                    if (angles[index] === current3DRotation) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                }
            });
        }
        
        function toggleAutoRotate() {
            const btn = event.target.closest('.preview-3d-control-btn');
            const text = document.getElementById('auto-rotate-text');
            
            if (autoRotateInterval) {
                // ÂÅúÊ≠¢Ëá™Âä®ÊóãËΩ¨
                stopAutoRotate();
                text.textContent = 'Ëá™Âä®ÊóãËΩ¨';
                btn.classList.remove('active');
                console.log('‚è∏Ô∏è ÂÅúÊ≠¢Ëá™Âä®ÊóãËΩ¨');
            } else {
                // ÂºÄÂßãËá™Âä®ÊóãËΩ¨
                btn.classList.add('active');
                text.textContent = 'ÂÅúÊ≠¢ÊóãËΩ¨';
                autoRotateInterval = setInterval(() => {
                    current3DRotation += 1; // ÊØèÊ¨°ÊóãËΩ¨1Â∫¶
                    updateCardRotation();
                }, 30); // 30msÊõ¥Êñ∞‰∏ÄÊ¨°ÔºåÂÆûÁé∞ÊµÅÁïÖÊóãËΩ¨
                console.log('‚ñ∂Ô∏è ÂºÄÂßãËá™Âä®ÊóãËΩ¨');
            }
        }
        
        function stopAutoRotate() {
            if (autoRotateInterval) {
                clearInterval(autoRotateInterval);
                autoRotateInterval = null;
                
                const text = document.getElementById('auto-rotate-text');
                const btn = document.querySelector('.preview-3d-control-btn:last-child');
                if (text) text.textContent = 'Ëá™Âä®ÊóãËΩ¨';
                if (btn) btn.classList.remove('active');
            }
        }
        
        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜËÉåÊôØÂÖ≥Èó≠
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('image-preview-modal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeImagePreview();
                    }
                });
            }
            
            // ESCÈîÆÂÖ≥Èó≠
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeImagePreview();
                }
            });
            
            // Êõ¥Êñ∞ÊÇ¨ÊµÆËÅäÂ§©Èù¢ÊùøÁöÑÊ≠•È™§‰ø°ÊÅØ
            updateFloatingChatStep(currentStep);
        });

        // ============= ÂµåÂÖ•ÂºèËÅäÂ§©Èù¢ÊùøÂäüËÉΩ =============
        function toggleEmbeddedChat(forceRightAlign = false) {
            console.log('toggleEmbeddedChat called, current state:', embeddedChatOpen, 'forceRightAlign:', forceRightAlign);
            const panel = document.getElementById('embedded-chat-panel');
            const container = document.querySelector('.process-container');
            console.log('Panel element:', panel);
            
            if (forceRightAlign && !embeddedChatOpen) {
                // Áî®Êà∑ÁÇπÂáªChat AIÊåâÈíÆÔºåÈúÄË¶ÅÂè≥ÂØπÈΩê
                embeddedChatOpen = true;
                chatRightAligned = true;
                panel.classList.add('active', 'right-aligned');
                container.classList.add('chat-right-mode');
                console.log('Opened chat in right-aligned mode');
            } else {
                embeddedChatOpen = !embeddedChatOpen;
                console.log('New state:', embeddedChatOpen);
                
                if (embeddedChatOpen) {
                    // ÈªòËÆ§ÂÜÖÂµåÊ®°Âºè
                    panel.classList.add('active');
                    panel.classList.remove('right-aligned');
                    container.classList.remove('chat-right-mode');
                    chatRightAligned = false;
                    console.log('Added active class to panel (embedded mode)');
                } else {
                    // ÂÖ≥Èó≠
                    panel.classList.remove('active', 'right-aligned');
                    container.classList.remove('chat-right-mode');
                    chatRightAligned = false;
                    console.log('Removed active class from panel');
                }
            }
            
            if (embeddedChatOpen) {
                // ÊªöÂä®Âà∞Â∫ïÈÉ®
                setTimeout(() => {
                    const body = document.getElementById('floating-chat-body');
                    console.log('Chat body element:', body);
                    if (body) {
                        body.scrollTop = body.scrollHeight;
                    }
                    // Â¶ÇÊûú‰∏çÊòØÂè≥ÂØπÈΩêÊ®°ÂºèÔºåÊâçÊªöÂä®Âà∞ËÅäÂ§©Èù¢Êùø
                    if (!chatRightAligned) {
                        panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        }

        // ‰øùÁïôÊóßÂáΩÊï∞Âêç‰ª•ÂÖºÂÆπ
        function toggleFloatingChat() {
            toggleEmbeddedChat();
        }
        
        function updateFloatingChatStep(step) {
            const stepInfo = document.getElementById('chat-step-info');
            const isEn = currentLanguage === 'en';
            
            const stepTexts = {
                1: { zh: 'Á¨¨1Ê≠•ÔºöÈÄâÊã©Â±ï‰ΩçÊ®°Êùø', en: 'Step 1: Select Booth Template' },
                2: { zh: 'Á¨¨2Ê≠•ÔºöÂêàËßÑÊ†°È™å', en: 'Step 2: Compliance Check' },
                3: { zh: 'Á¨¨3Ê≠•ÔºöÊä•‰ª∑‰∏éBOM', en: 'Step 3: Quote & BOM' },
                4: { zh: 'Á¨¨4Ê≠•ÔºöÁ°ÆËÆ§Êèê‰∫§', en: 'Step 4: Confirm & Submit' }
            };
            
            const text = stepTexts[step] || stepTexts[1];
            stepInfo.innerHTML = `<span class="zh">${text.zh}</span><span class="en">${text.en}</span>`;
            
            // Êõ¥Êñ∞Âø´Êç∑ÊåâÈíÆ
            updateFloatingQuickActions(step);
        }
        
        function updateFloatingQuickActions(step) {
            const quickActions = document.getElementById('floating-quick-actions');
            const isEn = currentLanguage === 'en';
            
            const actionsByStep = {
                1: [
                    { zh: '‰ªãÁªçÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç', en: 'About Green Booth', msg: '‰ªãÁªç‰∏Ä‰∏ãÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç' },
                    { zh: 'Â¶Ç‰ΩïÈÄâÂ∞∫ÂØ∏Ôºü', en: 'Size Guide', msg: 'Â¶Ç‰ΩïÈÄâÊã©ÂêàÈÄÇÁöÑÂ∞∫ÂØ∏Ôºü' },
                    { zh: 'ÂèØÂ§çÁî®ÁéáÔºü', en: 'Reusability?', msg: 'ÂèØÂ§çÁî®ÁéáÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü' }
                ],
                2: [
                    { zh: 'ÂêàËßÑË¶ÅÊ±Ç', en: 'Requirements', msg: 'Âπø‰∫§‰ºöÊúâÂì™‰∫õÂêàËßÑË¶ÅÊ±ÇÔºü' },
                    { zh: 'ÊùêÊñôÊ†áÂáÜ', en: 'Materials', msg: 'ÊùêÊñôÈúÄË¶ÅÊª°Ë∂≥‰ªÄ‰πàÊ†áÂáÜÔºü' },
                    { zh: 'ÂÆ°Ê†∏ÊµÅÁ®ã', en: 'Review Process', msg: 'ÂÆ°Ê†∏ÊµÅÁ®ãÊòØÊÄéÊ†∑ÁöÑÔºü' }
                ],
                3: [
                    { zh: 'Êä•‰ª∑ÊòéÁªÜ', en: 'Quote Details', msg: 'Êä•‰ª∑ÂåÖÂê´Âì™‰∫õÂÜÖÂÆπÔºü' },
                    { zh: 'ÊúçÂä°ËØ¥Êòé', en: 'Services', msg: 'ÂèØÈÄâÊúçÂä°ÊúâÂì™‰∫õÔºü' },
                    { zh: 'ËäÇÁúÅÊàêÊú¨', en: 'Save Costs', msg: 'Â¶Ç‰ΩïËäÇÁúÅÊàêÊú¨Ôºü' }
                ],
                4: [
                    { zh: 'ËÆ¢ÂçïËØ¶ÊÉÖ', en: 'Order Details', msg: 'Á°ÆËÆ§ËÆ¢ÂçïÂÜÖÂÆπ' },
                    { zh: '‰∫§‰ªòÊó∂Èó¥', en: 'Delivery', msg: '‰∫§‰ªòÊó∂Èó¥ÊòØÂ§ö‰πÖÔºü' },
                    { zh: 'ÊîØ‰ªòÊñπÂºè', en: 'Payment', msg: 'ÊîØÊåÅÂì™‰∫õÊîØ‰ªòÊñπÂºèÔºü' }
                ]
            };
            
            const actions = actionsByStep[step] || actionsByStep[1];
            quickActions.innerHTML = actions.map(action => 
                `<button class="floating-quick-btn" onclick="sendFloatingQuickMessage('${action.msg}')">
                    <span class="zh">${action.zh}</span><span class="en">${action.en}</span>
                </button>`
            ).join('');
        }
        
        function sendFloatingMessage() {
            const input = document.getElementById('floating-chat-input');
            const message = input ? input.value.trim() : '';
            
            console.log('sendFloatingMessage called', { input, message });
            
            if (!input) {
                console.error('Input element not found!');
                return;
            }
            
            if (!message) {
                console.log('Empty message, returning');
                return;
            }
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addFloatingMessage('user', message);
            input.value = '';
            
            // ÊòæÁ§∫ËæìÂÖ•‰∏≠ÊèêÁ§∫
            const typingEl = document.getElementById('floating-typing');
            if (typingEl) {
                typingEl.style.display = 'block';
            }
            scrollFloatingChatToBottom();
            
            // Ê®°ÊãüAIÂõûÂ§ç
            setTimeout(() => {
                if (typingEl) {
                    typingEl.style.display = 'none';
                }
                const reply = getFloatingAIReply(message, currentStep);
                addFloatingMessage('assistant', reply);
                scrollFloatingChatToBottom();
            }, 1000 + Math.random() * 1000);
        }
        
        function sendFloatingQuickMessage(message) {
            console.log('sendFloatingQuickMessage called with:', message);
            const input = document.getElementById('floating-chat-input');
            if (input) {
                input.value = message;
                sendFloatingMessage();
            } else {
                console.error('Input element not found in sendFloatingQuickMessage!');
            }
        }
        
        function addFloatingMessage(role, content) {
            console.log('addFloatingMessage called', { role, content });
            const messagesContainer = document.getElementById('floating-chat-messages');
            console.log('Messages container:', messagesContainer);
            
            if (!messagesContainer) {
                console.error('Messages container not found!');
                return;
            }
            
            const isEn = currentLanguage === 'en';
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `floating-chat-message ${role}`;
            
            const avatarIcon = role === 'assistant' ? 'bi-robot' : 'bi-person-fill';
            
            messageDiv.innerHTML = `
                <div class="floating-message-avatar">
                    <i class="bi ${avatarIcon}"></i>
                </div>
                <div class="floating-message-content">
                    ${content.replace(/\n/g, '<br>')}
                </div>
            `;
            
            console.log('Appending message div:', messageDiv);
            messagesContainer.appendChild(messageDiv);
            console.log('Message appended. Total messages:', messagesContainer.children.length);
        }
        
        function scrollFloatingChatToBottom() {
            console.log('scrollFloatingChatToBottom called');
            const body = document.getElementById('floating-chat-body');
            console.log('Chat body element:', body);
            
            if (!body) {
                console.error('Chat body not found!');
                return;
            }
            
            setTimeout(() => {
                body.scrollTop = body.scrollHeight;
                console.log('Scrolled to bottom:', body.scrollTop, '/', body.scrollHeight);
            }, 100);
        }
        
        function getFloatingAIReply(message, step) {
            const isEn = currentLanguage === 'en';
            message = message.toLowerCase();
            
            // Ê†πÊçÆÊ≠•È™§ÂíåÊ∂àÊÅØÂÜÖÂÆπËøîÂõû‰∏çÂêåÁöÑÂõûÂ§ç
            const replies = {
                1: {
                    'ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰Ωç|ÁªøËâ≤Â±ï‰Ωç': {
                        zh: 'ÁÆÄÊ¥ÅÁªøËâ≤Â±ï‰ΩçÊòØÊàë‰ª¨ÊúÄÂèóÊ¨¢ËøéÁöÑÊñπÊ°à‰πã‰∏ÄÔºÅ\n\n‚ú® ‰∏ªË¶ÅÁâπÁÇπÔºö\n‚Ä¢ Â∞∫ÂØ∏Ôºö6m √ó 3mÔºåÈÄÇÂêàÂ§ßÂ§öÊï∞Â±ï‰Ωç\n‚Ä¢ ÊùêÊñôÔºöÈìùÂêàÈáëÊ°ÜÊû∂ÔºåËΩª‰æøËÄêÁî®\n‚Ä¢ ÂèØÂ§çÁî®ÁéáÔºöÈ´òËææ92%\n‚Ä¢ ‰ª∑Ê†ºÔºö¬•12,000Ëµ∑\n\nËøô‰∏™ÊñπÊ°àÁâπÂà´ÈÄÇÂêàÊ≥®ÈáçÁéØ‰øùÂíåÊàêÊú¨ÊïàÁõäÁöÑÂ±ïÂïÜ„ÄÇÊÇ®ÊÉ≥‰∫ÜËß£Êõ¥Â§öÂÖ∑‰Ωì‰ø°ÊÅØÂêóÔºü',
                        en: 'The Simple Green Booth is one of our most popular solutions!\n\n‚ú® Key Features:\n‚Ä¢ Size: 6m √ó 3m, suitable for most booths\n‚Ä¢ Material: Aluminum frame, lightweight and durable\n‚Ä¢ Reusability: Up to 92%\n‚Ä¢ Price: From ¬•12,000\n\nThis solution is perfect for exhibitors who value sustainability and cost-effectiveness. Would you like to know more?'
                    },
                    'Â∞∫ÂØ∏|ÈÄâÊã©Â∞∫ÂØ∏|Â§ßÂ∞è': {
                        zh: 'ÈÄâÊã©ÂêàÈÄÇÁöÑÂ∞∫ÂØ∏ÂæàÈáçË¶ÅÔºÅÂª∫ËÆÆËÄÉËôëÔºö\n\nüìè 6m √ó 3mÔºö\n‚Ä¢ ÈÄÇÂêàÂ∞èÂûãÂ±ïÁ§∫\n‚Ä¢ È¢ÑÁÆóÂèãÂ•Ω\n‚Ä¢ ÈÄÇÂêà2-3‰∫∫Âõ¢Èòü\n\nüìè 6m √ó 6mÔºö\n‚Ä¢ ‰∏≠Á≠âËßÑÊ®°Â±ïÁ§∫\n‚Ä¢ Êõ¥Â§öÂ±ïÁ§∫Á©∫Èó¥\n‚Ä¢ ÈÄÇÂêà4-6‰∫∫Âõ¢Èòü\n\nÊÇ®ÁöÑÂ±ï‰ΩçÂè∑ÊòØÂ§öÂ§ßÔºüÊàëÂèØ‰ª•Â∏ÆÊÇ®Êé®ËçêÊúÄÂêàÈÄÇÁöÑÊñπÊ°à„ÄÇ',
                        en: 'Choosing the right size is important!\n\nüìè 6m √ó 3m:\n‚Ä¢ Suitable for small displays\n‚Ä¢ Budget-friendly\n‚Ä¢ Good for 2-3 person team\n\nüìè 6m √ó 6m:\n‚Ä¢ Medium-scale display\n‚Ä¢ More exhibition space\n‚Ä¢ Good for 4-6 person team\n\nWhat\'s your booth size? I can recommend the best solution.'
                    },
                    'ÂèØÂ§çÁî®Áéá|Â§çÁî®|ÈáçÂ§ç‰ΩøÁî®': {
                        zh: 'ÂèØÂ§çÁî®ÁéáÊòØÊåáÂ±ï‰ΩçÊùêÊñôÂú®Â±ï‰ºöÂêéÂèØ‰ª•ÈáçÂ§ç‰ΩøÁî®ÁöÑÊØî‰æã„ÄÇ\n\n‚ôªÔ∏è È´òÂèØÂ§çÁî®ÁéáÁöÑÂ•ΩÂ§ÑÔºö\n‚Ä¢ Èôç‰ΩéÈïøÊúüÊàêÊú¨\n‚Ä¢ ÂáèÂ∞ëÊµ™Ë¥πÔºåÊõ¥ÁéØ‰øù\n‚Ä¢ Á¨¶ÂêàÂπø‰∫§‰ºöÁªøËâ≤Â±ï‰ºöÁêÜÂøµ\n\nÊàë‰ª¨ÁöÑÊñπÊ°àÂèØÂ§çÁî®ÁéáÂú®85%-92%‰πãÈó¥ÔºåËøôÊÑèÂë≥ÁùÄÂ§ßÈÉ®ÂàÜÊùêÊñôÈÉΩÂèØ‰ª•Âú®‰∏ãÊ¨°Â±ï‰ºöÁªßÁª≠‰ΩøÁî®ÔºÅ',
                        en: 'Reusability rate refers to the percentage of booth materials that can be reused after the exhibition.\n\n‚ôªÔ∏è Benefits of high reusability:\n‚Ä¢ Lower long-term costs\n‚Ä¢ Less waste, more eco-friendly\n‚Ä¢ Aligns with Canton Fair green initiatives\n\nOur solutions have 85%-92% reusability, meaning most materials can be used again!'
                    },
                    'default': {
                        zh: 'ÊàëÁêÜËß£ÊÇ®ÁöÑÈóÆÈ¢ò„ÄÇÂÖ≥‰∫éÊ®°ÊùøÈÄâÊã©ÔºåÊàëÂª∫ËÆÆÔºö\n\n1Ô∏è‚É£ ÂÖàÁ°ÆÂÆöÊÇ®ÁöÑÂ±ï‰ΩçÂ∞∫ÂØ∏\n2Ô∏è‚É£ ËÄÉËôëÊÇ®ÁöÑÈ¢ÑÁÆóËåÉÂõ¥\n3Ô∏è‚É£ ÊÉ≥ÊÉ≥ÊÇ®ÁöÑÂìÅÁâåÈ£éÊ†º\n\nÊÇ®ÂèØ‰ª•ÁÇπÂáª‰∏ãÊñπÁöÑÊ®°ÊùøÂç°ÁâáÊü•ÁúãËØ¶ÊÉÖÔºåÊàñËÄÖÂëäËØâÊàëÊÇ®ÁöÑÂÖ∑‰ΩìÈúÄÊ±ÇÔºåÊàë‰ºö‰∏∫ÊÇ®Êé®ËçêÊúÄÂêàÈÄÇÁöÑÊñπÊ°àÔºÅ',
                        en: 'I understand your question. For template selection, I suggest:\n\n1Ô∏è‚É£ Confirm your booth size first\n2Ô∏è‚É£ Consider your budget range\n3Ô∏è‚É£ Think about your brand style\n\nClick the template cards below for details, or tell me your specific needs!'
                    }
                },
                2: {
                    'ÂêàËßÑ|Ë¶ÅÊ±Ç|Ê†áÂáÜ': {
                        zh: 'Âπø‰∫§‰ºöÂØπÂ±ï‰ΩçÊúâ‰∏•Ê†ºÁöÑÂêàËßÑË¶ÅÊ±ÇÔºö\n\n‚úÖ ÂøÖÈ°ªÊª°Ë∂≥Ôºö\n‚Ä¢ ÊùêÊñôÈò≤ÁÅ´Á≠âÁ∫ßÔºöB1Á∫ß\n‚Ä¢ ÁªìÊûÑÂÆâÂÖ®Ê†áÂáÜ\n‚Ä¢ ÁéØ‰øùÊùêÊñôËÆ§ËØÅ\n‚Ä¢ Â∞∫ÂØ∏‰∏çË∂ÖÊ†á\n\nÊàë‰ª¨ÁöÑÊñπÊ°àÂ∑≤ÁªèËøáÈ¢ÑÂÆ°ÔºåÁ¨¶ÂêàÊâÄÊúâÊ†áÂáÜ„ÄÇÊÇ®Âè™ÈúÄÂ°´ÂÜôÂü∫Êú¨‰ø°ÊÅØÂç≥ÂèØÔºÅ',
                        en: 'Canton Fair has strict compliance requirements:\n\n‚úÖ Must meet:\n‚Ä¢ Fire rating: B1 level\n‚Ä¢ Structural safety standards\n‚Ä¢ Eco-material certification\n‚Ä¢ Size within limits\n\nOur solutions are pre-approved and meet all standards!'
                    },
                    'default': {
                        zh: 'ÂÖ≥‰∫éÂêàËßÑÈóÆÈ¢òÔºåÊàë‰ª¨ÁöÑÁ≥ªÁªü‰ºöËá™Âä®Ê£ÄÊü•ÊâÄÊúâË¶ÅÊ±Ç„ÄÇÊÇ®Âè™ÈúÄÔºö\n\n1Ô∏è‚É£ Â°´ÂÜôÂ±ï‰Ωç‰ø°ÊÅØ\n2Ô∏è‚É£ Á°ÆËÆ§ÊùêÊñôÈÄâÊã©\n3Ô∏è‚É£ Êü•ÁúãËá™Âä®ÁîüÊàêÁöÑÂêàËßÑÊä•Âëä\n\nÊúâ‰ªª‰ΩïÁñëÈóÆÔºåÈöèÊó∂ÈóÆÊàëÔºÅ',
                        en: 'For compliance, our system automatically checks all requirements. You just need to:\n\n1Ô∏è‚É£ Fill in booth info\n2Ô∏è‚É£ Confirm material choices\n3Ô∏è‚É£ Review auto-generated report\n\nAsk me if you have questions!'
                    }
                },
                3: {
                    'Êä•‰ª∑|‰ª∑Ê†º|Ë¥πÁî®': {
                        zh: 'Êä•‰ª∑ÂåÖÂê´‰ª•‰∏ãÂÜÖÂÆπÔºö\n\nüí∞ Âü∫Á°ÄÊä•‰ª∑Ôºö\n‚Ä¢ Â±ï‰ΩçÊê≠Âª∫ÊùêÊñô\n‚Ä¢ Âü∫Á°ÄÊñΩÂ∑•ÊúçÂä°\n‚Ä¢ Ê†áÂáÜÁÖßÊòé\n\nüíé ÂèØÈÄâÊúçÂä°Ôºö\n‚Ä¢ Â§öÂ™í‰ΩìËÆæÂ§á\n‚Ä¢ ÂìÅÁâåÂÆöÂà∂\n‚Ä¢ È¢ùÂ§ñÁÖßÊòé\n‚Ä¢ Â±ïÂêéÊãÜÈô§ÂõûÊî∂\n\nÊÇ®ÂèØ‰ª•Ê†πÊçÆÈúÄÊ±ÇÈÄâÊã©ÔºåÁ≥ªÁªü‰ºöÂÆûÊó∂Êõ¥Êñ∞ÊÄª‰ª∑ÔºÅ',
                        en: 'Quote includes:\n\nüí∞ Base Quote:\n‚Ä¢ Booth materials\n‚Ä¢ Basic construction\n‚Ä¢ Standard lighting\n\nüíé Optional:\n‚Ä¢ Multimedia equipment\n‚Ä¢ Brand customization\n‚Ä¢ Extra lighting\n‚Ä¢ Post-event removal\n\nChoose as needed, price updates in real-time!'
                    },
                    'default': {
                        zh: 'ÂÖ≥‰∫éÊä•‰ª∑ÔºåÊÇ®ÂèØ‰ª•Ôºö\n\nüìä Êü•ÁúãÊùêÊñôÊ∏ÖÂçï(BOM)\nüí° ÈÄâÊã©ÂèØÈÄâÊúçÂä°\nüí∞ ÂØπÊØî‰∏çÂêåÊñπÊ°à\n\nÁ≥ªÁªü‰ºöËá™Âä®ËÆ°ÁÆóÊÄª‰ª∑ÔºåÂåÖÊã¨ÁéØ‰øùÂõûÊî∂‰ºòÊÉ†„ÄÇÈúÄË¶ÅËØ¶ÁªÜËØ¥ÊòéÂêóÔºü',
                        en: 'About pricing, you can:\n\nüìä View BOM\nüí° Select optional services\nüí∞ Compare solutions\n\nSystem calculates total automatically with eco-discount. Need details?'
                    }
                },
                4: {
                    'default': {
                        zh: 'ÊÇ®Â∑≤Âà∞ËææÊúÄÂêé‰∏ÄÊ≠•ÔºÅ\n\n‚úÖ ËØ∑Á°ÆËÆ§Ôºö\n‚Ä¢ Ê®°ÊùøÈÄâÊã©\n‚Ä¢ ‰∏™ÊÄßÂåñËÆæÁΩÆ\n‚Ä¢ ÂèØÈÄâÊúçÂä°\n‚Ä¢ ÊÄª‰ª∑\n\nÁ°ÆËÆ§Êó†ËØØÂêéÂç≥ÂèØÊèê‰∫§ËÆ¢Âçï„ÄÇÊúâ‰ªª‰ΩïÈóÆÈ¢òÈÉΩÂèØ‰ª•ÈóÆÊàëÔºÅ',
                        en: 'You\'ve reached the final step!\n\n‚úÖ Please confirm:\n‚Ä¢ Template selection\n‚Ä¢ Customization\n‚Ä¢ Optional services\n‚Ä¢ Total price\n\nSubmit when ready. Ask me anything!'
                    }
                }
            };
            
            // Êü•ÊâæÂåπÈÖçÁöÑÂõûÂ§ç
            const stepReplies = replies[step] || replies[1];
            for (let key in stepReplies) {
                if (key !== 'default') {
                    const keywords = key.split('|');
                    if (keywords.some(keyword => message.includes(keyword))) {
                        return isEn ? stepReplies[key].en : stepReplies[key].zh;
                    }
                }
            }
            
            return isEn ? stepReplies.default.en : stepReplies.default.zh;
        }

        // ============= Á°Æ‰øùÂáΩÊï∞Êö¥Èú≤Âà∞ÂÖ®Â±Ä‰ΩúÁî®Âüü =============
        console.log('üîß ÂàùÂßãÂåñÂÖ®Â±ÄÂáΩÊï∞...');
        
        // Â∞ÜÂÖ≥ÈîÆÂáΩÊï∞Êö¥Èú≤Âà∞windowÂØπË±°
        window.setLanguage = setLanguage;
        window.toggleEmbeddedChat = toggleEmbeddedChat;
        window.applyCustomization = applyCustomization;
        window.setupCanvasPreviewSwitch = setupCanvasPreviewSwitch;
        window.toggleAIChat = toggleAIChat;
        window.filterTemplates = filterTemplates;
        window.selectTemplate = selectTemplate;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.previewImage = previewImage;
        window.closeImagePreview = closeImagePreview;
        window.toggle3DView = toggle3DView;
        window.rotate3DCard = rotate3DCard;
        window.toggleAutoRotate = toggleAutoRotate;
        
        console.log('‚úÖ ÂÖ®Â±ÄÂáΩÊï∞Â∑≤Êö¥Èú≤:');
        console.log('  - setLanguage:', typeof window.setLanguage);
        console.log('  - toggleEmbeddedChat:', typeof window.toggleEmbeddedChat);
        console.log('  - applyCustomization:', typeof window.applyCustomization);
        console.log('  - toggleAIChat:', typeof window.toggleAIChat);
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOMContentLoaded - È°µÈù¢Âä†ËΩΩÂÆåÊàê');
            console.log('‚úÖ Ê£ÄÊü•ÂÖ≥ÈîÆÂÖÉÁ¥†:');
            console.log('  - lang-zh button:', document.getElementById('lang-zh') ? '‚úÖ' : '‚ùå');
            console.log('  - lang-en button:', document.getElementById('lang-en') ? '‚úÖ' : '‚ùå');
            console.log('  - embedded-chat-panel:', document.getElementById('embedded-chat-panel') ? '‚úÖ' : '‚ùå');
            console.log('  - preview-front canvas:', document.getElementById('preview-front') ? '‚úÖ' : '‚ùå');
        });

    </script>

    <!-- ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-template-name">Ê®°ÊùøÂêçÁß∞</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>

            <p id="modal-template-desc" style="color: #555; line-height: 1.6; margin-bottom: 20px;">Ê®°ÊùøÊèèËø∞</p>

            <div class="modal-section">
                <div class="modal-section-title"><i class="bi bi-info-circle"></i> <span class="zh">ËßÑÊ†ºÂèÇÊï∞</span><span class="en show">Specifications</span></div>
                <ul id="modal-specs-list" style="list-style: none; padding: 0; margin: 0;">
                    <li style="padding: 6px 0;">ËßÑÊ†ºÂä†ËΩΩ‰∏≠...</li>
                </ul>
            </div>

            <div id="modal-optionals">
                <!-- ÂèØÈÄâÊúçÂä°Âä®ÊÄÅÁîüÊàê -->
            </div>

            <div class="modal-section" style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span><span class="zh">Âü∫Á°Ä‰ª∑Ê†ºÔºö</span><span class="en show">Base Price:</span></span>
                    <span style="font-weight: 700; color: #27ae60;" id="modal-base-price">¬•18,000</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span><span class="zh">ÂèØÈÄâÊúçÂä°Ë¥πÁî®Ôºö</span><span class="en show">Add-ons Cost:</span></span>
                    <span style="font-weight: 600; color: #e74c3c;" id="modal-optionals-cost">¬•0</span>
                </div>
                <div style="display: flex; justify-content: space-between; border-top: 2px solid #ddd; padding-top: 10px; font-size: 16px;">
                    <span style="font-weight: 700;"><span class="zh">ÂêàËÆ°Ôºö</span><span class="en show">Total:</span></span>
                    <span style="font-weight: 700; color: #27ae60; font-size: 18px;" id="modal-total-price">¬•18,000</span>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal()"><span class="zh">ÂèñÊ∂à</span><span class="en show">Cancel</span></button>
                <button class="btn-primary" onclick="confirmModalSelection()"><span class="zh">Á°ÆËÆ§ÈÄâÊã©</span><span class="en show">Confirm</span></button>
            </div>
        </div>
    </div>

    <!-- ÂõæÁâáÊîæÂ§ßÈ¢ÑËßàÊµÆÁ™ó -->
    <div id="image-preview-modal" class="image-preview-modal">
        <div class="image-preview-content">
            <button class="image-preview-close" onclick="closeImagePreview()" title="ÂÖ≥Èó≠ÊµÆÁ™ó (ESC)">&times;</button>
            
            <!-- 2DÂõæÁâáËßÜÂõæ -->
            <div id="preview-2d-view">
                <img id="preview-image" src="" alt="È¢ÑËßàÂõæÁâá" style="cursor: default;">
                <div id="preview-caption" class="image-preview-caption"></div>
                
                <!-- 3DËßÜÂõæÊåâÈíÆ -->
                <button class="view-3d-button" onclick="toggle3DView(true)" title="Êü•Áúã3DÊïàÊûú">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    <span>3DËßÜÂõæ</span>
                </button>
            </div>
            
            <!-- 3DËßÜÂõæÂÆπÂô® -->
            <div id="preview-3d-container" class="preview-3d-container">
                <button class="preview-3d-exit-btn" onclick="toggle3DView(false)">
                    ‚Üê ËøîÂõû2DËßÜÂõæ
                </button>
                
                <div id="preview-3d-card" class="preview-3d-card">
                    <!-- Ê≠£Èù¢ -->
                    <div class="preview-3d-face front">
                        <img id="preview-3d-front" src="" alt="Ê≠£Èù¢ËßÜÂõæ">
                    </div>
                    <!-- Â∑¶ÂâçËßí -->
                    <div class="preview-3d-face left">
                        <img id="preview-3d-left" src="" alt="Â∑¶ÂâçËßíËßÜÂõæ">
                    </div>
                    <!-- Âè≥ÂâçËßí -->
                    <div class="preview-3d-face right">
                        <img id="preview-3d-right" src="" alt="Âè≥ÂâçËßíËßÜÂõæ">
                    </div>
                </div>
                
                <!-- ÊéßÂà∂ÊåâÈíÆ -->
                <div class="preview-3d-controls">
                    <button class="preview-3d-control-btn active" onclick="rotate3DCard(0)">Ê≠£Èù¢</button>
                    <button class="preview-3d-control-btn" onclick="rotate3DCard(1)">Â∑¶ËßÜËßí</button>
                    <button class="preview-3d-control-btn" onclick="rotate3DCard(2)">Âè≥ËßÜËßí</button>
                    <button class="preview-3d-control-btn" onclick="toggleAutoRotate()">
                        <span id="auto-rotate-text">Ëá™Âä®ÊóãËΩ¨</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- ÁªìÊùü main-app -->



</body>
</html>
